{"remainingRequest":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/qiang/work/hytx/hytx-rebuild/src/module/spread/manger/index.vue?vue&type=style&index=0&id=5020f4cf&lang=scss&scoped=true&","dependencies":[{"path":"/Users/qiang/work/hytx/hytx-rebuild/src/module/spread/manger/index.vue","mtime":1546400167097},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/sass-loader/lib/loader.js","mtime":1533139052000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.spread-manger {\n  width: 100%;\n  overflow: hidden;\n  min-height: 100vh;\n  background: #f2f2f2;\n  &.white {\n    background: #fff;\n  }\n}\n.ad-item {\n  width: 100%;\n  height: 460px;\n  padding: 30px;\n  overflow: hidden;\n  margin-top: 30px;\n  background: #fff;\n  box-sizing: border-box;\n}\n.ad-date {\n  width: 100%;\n  font-size: 28px;\n  color: #333333;\n  line-height: 28px;\n  margin-bottom: 30px;\n  font-family: 'PingFang SC Medium';\n  .iconfont {\n    float: right;\n  }\n}\n.ad-dateil,\n.ad-info {\n  width: 626px;\n  height: 188px;\n  margin: 0 auto;\n  overflow: hidden;\n  position: relative;\n  background: #f5f5f5;\n  box-sizing: border-box;\n  padding: 20px 30px 20px 20px;\n  .ad-poster {\n    float: left;\n    width: 114px;\n    height: 150px;\n    margin-right: 30px;\n    border-radius: 4px;\n    background-size: cover;\n    background-position: center;\n  }\n  /* img {\n    width: 100%;\n  } */\n  .ad-title {\n    float: left;\n    width: 414px;\n    height: 150px;\n    font-size: 28px;\n    overflow: hidden;\n    line-height: 48px;\n    padding-top: 34px;\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    box-sizing: border-box;\n    -webkit-box-orient: vertical;\n    font-family: 'PingFang SC Medium';\n  }\n}\n.ad-info {\n  padding: 0;\n  height: unset;\n  font-size: 24px;\n  overflow: hidden;\n  color: #333333;\n  background: #fff;\n  box-sizing: border-box;\n  font-family: 'PingFang SC Medium';\n  p {\n    margin-top: 30px;\n  }\n  .status_0,\n  .status_2,\n  .status_4 {\n    color: #299cff;\n  }\n  .status_1 {\n    color: #ff2d2d;\n  }\n  .status_3 {\n    color: #999999;\n  }\n  .operate {\n    right: 0;\n    top: 45px;\n    width: 106px;\n    height: 48px;\n    color: #299cff;\n    line-height: 48px;\n    position: absolute;\n    text-align: center;\n    border-radius: 24px;\n    box-sizing: border-box;\n    border: 2px solid #299cff;\n  }\n  .remark {\n    float: right;\n  }\n}\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/module/spread/manger","sourcesContent":["<template>\n  <div class=\"spread-manger\" :class=\"{'white': !list.length}\">\n    <div class=\"none\">\n      <img v-if=\"!list.length\" src=\"./none.jpg\" style=\"width: 100%;\" alt=\"\">\n    </div>\n    <div class=\"ad-item\" v-for=\"(item, index) in list\" :key=\"index\">\n      <div class=\"ad-date\">\n        <p>\n          <span>{{item.created_at | timeFormt('YYYY-MM-DD')}}</span>\n          <!-- 未通过(1)、已下架(3)、保存状态(4)可删除 -->\n          <span class=\"iconfont icon-cha\" v-if=\"item.status === 1 || item.status === 3 || item.status === 4\" @click=\"deleteAD(index)\"></span>\n        </p>\n      </div>\n      <div class=\"ad-dateil\" @click=\"goDetail(index)\">\n        <div class=\"ad-poster\" :style=\"{'background-image': 'url('+item.cover+')'}\">\n        </div>\n        <div class=\"ad-title\" v-text=\"item.title\"></div>\n      </div>\n      <div class=\"ad-info\">\n        <p>脉宝发布总数: <span v-text=\"item.maibao_num\"></span></p>\n        <p>脉宝当前剩余: <span v-text=\"item.maibao_num_surplus || item.maibao_num\"></span></p>\n        <p>发布状态: <span :class=\"'status_'+item.status\">{{item.status | statusText}}</span><span class=\"remark status_1\" v-text=\"item.remarks\"></span></p>\n        <!-- 未通过(1)、已下架(3)、保存状态(4)可修改 -->\n        <span class=\"operate\" v-if=\"item.status === 1 || item.status === 3 || item.status === 4\" @click=\"edit(index)\">修改</span>\n        <!-- 保存状态可发布(4) -->\n        <span class=\"operate\" v-if=\"item.status === 4\" @click=\"publish(index)\" style=\"top: 1.4rem;\">发布</span>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport spread from '../../../api/spread'\nimport { mapState, mapActions } from 'vuex'\nimport dialogService from '../../../service/dialogService'\nexport default {\n  name: 'spreadManger',\n  data() {\n    return {\n      page: 1,\n      list: [],\n      allPage: null,\n      loading: false\n    }\n  },\n  beforeMount() {\n    this.init()\n  },\n  mounted() {\n    window.addEventListener('scroll', this.loadMore, false)\n  },\n  destroyed() {\n    window.removeEventListener('scroll', this.loadMore, false)\n  },\n  methods: {\n    ...mapActions(['spread/updateSpreadAD', 'spread/updateEditSpread']),\n    async init() {\n      try {\n        let res = await spread.getPublishList(1)\n        if (res.status !== 0) throw new Error(res.message)\n        this.list = res.data.data\n        this.page = res.data.current_page\n        this.allPage = Math.ceil(res.data.total / res.data.per_page)\n      } catch (err) {\n        dialogService.alert(err.message)\n      }\n    },\n    async loadMore() {\n      if (this.loading) return\n      if (this.page === this.allPage || !this.allPage) return\n      try {\n        this.loading = true\n        let res = await spread.getPublishList(this.page + 1)\n        if (res.status !== 0) throw new Error(res.message)\n        this.loading = false\n        this.page = res.data.current_page\n        this.list = this.list.concat(res.data.data)\n      } catch (err) {\n        dialogService.alert(err.message)\n      }\n    },\n    // 广告预览\n    goDetail(index) {\n      this['spread/updateSpreadAD'](this.list[index])\n      this.$router.push({ path: '/spread/detail' })\n    },\n    // 删除广告\n    deleteAD(index) {\n      try {\n        let _self = this\n        this.$createDialog({\n          title: '提示',\n          type: 'confirm',\n          icon: 'icon-tips-alert',\n          content: '你确定要删除!?',\n          onConfirm: async () => {\n            let res = await spread.deleteAD(this.list[index].id)\n            if (res.status !== 0) throw new Error(err.message)\n            dialogService.alert('删除成功', function() {\n              _self.list.splice(index, 1)\n            })\n          }\n        }).show()\n      } catch (err) {\n        dialogService.alert(err.message)\n      }\n    },\n    // 编辑广告\n    edit(index) {\n      this['spread/updateEditSpread'](this.list[index])\n      this.$router.push({\n        path: `/spread/edit`\n      })\n    },\n    // 下架广告\n    async down(index) {\n      try {\n        let _self = this\n        let newAD = JSON.parse(JSON.stringify(this.list[index]))\n        newAD.status = 3\n        let res = await spread.editAD(this.list[index].id, newAD)\n        if (res.status !== 0) throw new Error(res.message)\n        dialogService.alert('操作成功', function() {\n          _self.$set(_self.list[index], 'status', 3)\n        })\n      } catch (err) {\n        dialogService.alert(err.message)\n      }\n    },\n    // 发布广告\n    async publish(index) {\n      let _self = this\n      try {\n        let newAD = JSON.parse(JSON.stringify(this.list[index]))\n        newAD.status = 0\n        let res = await spread.editAD(this.list[index].id, newAD)\n        if (res.status !== 0) throw new Error(res.message)\n        dialogService.alert('操作成功', function() {\n          _self.$set(_self.list[index], 'status', 0)\n        })\n      } catch (err) {\n        this.$createDialog({\n          title: '提示',\n          type: 'confirm',\n          icon: 'icon-tips-alert',\n          content: '脉宝余额不足,去充值!',\n          onConfirm: () => {\n            _self.$router.push({\n              path: '/user/veinCoin/recharge'\n            })\n          }\n        }).show()\n      }\n    }\n  },\n  filters: {\n    statusText: function(input) {\n      switch (input) {\n        case 0:\n          return '待审核'\n        case 1:\n          return '未通过'\n        case 2:\n          return '已上架'\n        case 3:\n          return '已下架'\n        case 4:\n          return '保存'\n      }\n    }\n  },\n  watch: {\n    $route(to, from) {\n      if (/^\\/spread\\/edit/.test(from.path)) {\n        this.init()\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.spread-manger {\n  width: 100%;\n  overflow: hidden;\n  min-height: 100vh;\n  background: #f2f2f2;\n  &.white {\n    background: #fff;\n  }\n}\n.ad-item {\n  width: 100%;\n  height: 460px;\n  padding: 30px;\n  overflow: hidden;\n  margin-top: 30px;\n  background: #fff;\n  box-sizing: border-box;\n}\n.ad-date {\n  width: 100%;\n  font-size: 28px;\n  color: #333333;\n  line-height: 28px;\n  margin-bottom: 30px;\n  font-family: 'PingFang SC Medium';\n  .iconfont {\n    float: right;\n  }\n}\n.ad-dateil,\n.ad-info {\n  width: 626px;\n  height: 188px;\n  margin: 0 auto;\n  overflow: hidden;\n  position: relative;\n  background: #f5f5f5;\n  box-sizing: border-box;\n  padding: 20px 30px 20px 20px;\n  .ad-poster {\n    float: left;\n    width: 114px;\n    height: 150px;\n    margin-right: 30px;\n    border-radius: 4px;\n    background-size: cover;\n    background-position: center;\n  }\n  /* img {\n    width: 100%;\n  } */\n  .ad-title {\n    float: left;\n    width: 414px;\n    height: 150px;\n    font-size: 28px;\n    overflow: hidden;\n    line-height: 48px;\n    padding-top: 34px;\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    box-sizing: border-box;\n    -webkit-box-orient: vertical;\n    font-family: 'PingFang SC Medium';\n  }\n}\n.ad-info {\n  padding: 0;\n  height: unset;\n  font-size: 24px;\n  overflow: hidden;\n  color: #333333;\n  background: #fff;\n  box-sizing: border-box;\n  font-family: 'PingFang SC Medium';\n  p {\n    margin-top: 30px;\n  }\n  .status_0,\n  .status_2,\n  .status_4 {\n    color: #299cff;\n  }\n  .status_1 {\n    color: #ff2d2d;\n  }\n  .status_3 {\n    color: #999999;\n  }\n  .operate {\n    right: 0;\n    top: 45px;\n    width: 106px;\n    height: 48px;\n    color: #299cff;\n    line-height: 48px;\n    position: absolute;\n    text-align: center;\n    border-radius: 24px;\n    box-sizing: border-box;\n    border: 2px solid #299cff;\n  }\n  .remark {\n    float: right;\n  }\n}\n</style>\n"]}]}
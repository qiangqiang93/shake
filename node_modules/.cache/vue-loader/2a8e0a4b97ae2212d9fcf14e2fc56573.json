{"remainingRequest":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/qiang/work/hytx/hytx-rebuild/src/module/article/index/index.vue?vue&type=style&index=0&id=364b6b6e&lang=scss&scoped=true&","dependencies":[{"path":"/Users/qiang/work/hytx/hytx-rebuild/src/module/article/index/index.vue","mtime":1547618571855},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/sass-loader/lib/loader.js","mtime":1533139052000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n@import './index.scss';\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyXA","file":"index.vue","sourceRoot":"src/module/article/index","sourcesContent":["<template>\n  <Wrapper class=\"article\" ref=\"warp\" @scrolling=\"scrollHandler\" :paddingTop=\"paddingTop\" :class=\"[followUser.length?'bg':'',isShowPop?'m-h':'']\">\n    <div ref=\"header\" class=\"header-warp\" style=\"z-index:2;width:100%\">\n      <AppHeader title=\"文库\" iconColor=\"#fff\" fontColor=\"#fff\" background=\"#000\" v-if=\"this.platform!=='wechat'\"></AppHeader>\n      <div class=\"header\">\n        <ul class=\"tab-list\">\n          <li v-for=\"(item,index) in categories\" :key=\"index\" :class=\"categorieId==item.id?'active':''\" @click=\"selectCategory(item)\">{{item.title}}</li>\n        </ul>\n        <div class=\"mask\"></div>\n        <router-link tag=\"div\" class=\"operate\" to=\"/article/classify\">\n          <i class=\"iconfont icon-list\"></i>\n        </router-link>\n      </div>\n    </div>\n    <!-- 关注页面 -->\n    <template v-if=\"categorieId == 9999\">\n      <div class=\"loading-warp\" v-if=\"firstFollow\">\n        <AppLoading v-if=\"firstFollow\"></AppLoading>\n      </div>\n      <div class=\"follow\" v-else-if=\"!followUser.length\">\n        <div class=\"img-warp\">\n          <img src=\"./noNoticer3X.png\" alt=\"\">\n          <p>关注的人更新的动态会在这里出现</p>\n        </div>\n        <div class=\"btn\" @click=\"goRecommend\">关注感兴趣的人</div>\n      </div>\n      <div class=\"follow\" v-else>\n        <ul class=\"follow-list\">\n          <li v-for=\"(item,index) in followUser\" :key=\"index\" @click=\"goUser(item.id)\">\n            <div class=\"avatar\">\n              <img :src=\"item.avatar\" alt=\"\">\n              <img src=\"./more3x.png\" alt=\"\" class=\"level\" v-if=\"false\">\n            </div>\n            <div class=\"name\">{{item.account}}</div>\n          </li>\n        </ul>\n        <ul>\n          <li v-for=\"(item,index) in article\" :key=\"index\">\n            <FollowItem :item=\"item\"></FollowItem>\n          </li>\n        </ul>\n\n      </div>\n    </template>\n    <!-- 非关注页面 -->\n    <template v-else>\n      <div class=\"loading-warp\" v-if=\"isRequest&&!article.length\">\n        <AppLoading v-if=\"true\"></AppLoading>\n      </div>\n      <ul>\n        <li v-for=\"(item,index) in article\" :key=\"index\">\n          <ArticleAd v-if=\"item.is_ad\" :item=\"item\"></ArticleAd>\n          <ArticleItem :item=\"item\" @click.native=\"gotoDetail(item.id,index)\"></ArticleItem>\n        </li>\n        <li class=\"no-more\" v-if=\"this.article.length >6&&this.page === this.total&&this.categorieId!==9998&&!isRequest\">亲，没有更多了哟</li>\n      </ul>\n      <AppLoading v-if=\"isRequest&&article.length>6\" :type=\"'list'\"></AppLoading>\n    </template>\n    <!-- 关注详情 -->\n    <FollowDetail :show=\"isShowPop\" :followUser=\"followUser\" :id=\"followId\">\n      <i class=\"iconfont icon-cuo3\" @click=\"isShowPop=false\"></i>\n    </FollowDetail>\n  </Wrapper>\n</template>\n\n<script>\nimport Wrapper from '../../../components/Wrapper'\nimport Aritcle from '../../../api/article'\nimport { mapState, mapActions } from 'vuex'\nimport ArticleItem from '../../../components/ArticleItem'\nimport AppHeader from '../../../components/AppHeader'\nimport ArticleAd from '../../../components/ArticleAd'\nimport dialogService from '../../../service/dialogService.js'\nimport FollowItem from '../../../components/FollowItem'\nimport AppLoading from '../../../components/AppLoading'\nimport FollowDetail from '../../../components/FollowDetail'\nimport Swiper from 'swiper'\nimport 'swiper/dist/css/swiper.min.css'\nimport guideService from '../../../service/guideService'\nexport default {\n  name: 'articleIndex',\n  data() {\n    return {\n      defalutCategories: [\n        {\n          id: 9999,\n          title: '关注',\n          is_modify: 0\n        },\n        {\n          id: 9998,\n          title: '推荐',\n          is_modify: 0\n        }\n      ], // 默认必须加的标签\n      categories: [], // 标签列表\n      categorieId: 9998, // 默认推荐\n      article: [], //文章\n      followUser: [], // 关注作者\n      followId: null, //作者id\n      followArticle: [], // 关注作者发的文章\n      windowHeight: null, // 可见区域高度\n      page: 1, // 默认第一页\n      total: 1, // 总页数\n      isRequest: false, //是否正在请求\n      firstFollow: true, // 是否第一次请求关注 false 不是 true 是\n      isShowPop: false // 是否显示弹窗\n    }\n  },\n  async mounted() {\n    if (!this.user) this.firstFollow = false\n    this.windowHeight = document.documentElement.clientHeight\n    this.init()\n  },\n  methods: {\n    ...mapActions([\n      'articles/setSelectedCategory',\n      'articles/setUnSelectedCategory',\n      'articles/setCategorysId',\n      'system/updateRouter',\n      'articles/updateArticleList'\n    ]),\n    // 关注作者详情\n    goUser(id) {\n      this.followId = id\n      this.isShowPop = true\n    },\n    // 前往详情\n    gotoDetail(id, index) {\n      if (index < 15) {\n        let obj = Object.assign({}, this.articles.articleList)\n        obj[this.categorieId][index].pageviews += 1\n        this['articles/updateArticleList'](obj)\n      } else {\n        this.$set(\n          this.article[index],\n          'pageviews',\n          this.article[index].pageviews + 1\n        )\n      }\n      this.$router.push(`/article/detail/${id}`)\n    },\n    // 监听滚动翻页\n    async scrollHandler(scrolled, scrollHeight) {\n      if (this.isRequest) return false\n      let scrollBottom = this.windowHeight + scrolled > scrollHeight - 100\n      if (!scrollBottom) return false\n      if (this.categorieId === 9998) {\n        this.getRecommend()\n        return false\n      }\n      if (this.page < this.total) {\n        this.page += 1\n        // 关注\n        if (this.categorieId === 9999) {\n          this.getFollowArticle()\n        } else {\n          this.getArticle()\n        }\n      }\n    },\n    async init() {\n      try {\n        // 是否登录\n        if (this.user) {\n          this.getUserCategories()\n        } else {\n          this.getCategories()\n        }\n        this.categorieId = this.articles.categorysId\n          ? this.articles.categorysId\n          : this.categorieId\n        // this.article = []\n        this.article = this.articles.articleList[this.categorieId]\n          ? this.articles.articleList[this.categorieId]\n          : []\n        this.requestInterface()\n      } catch (error) {\n        dialogService.toast(error.message)\n      }\n    },\n    // 根据id判断请求什么接口\n    async requestInterface() {\n      if (this.categorieId === 9999) {\n        if (this.user) await this.getFollow()\n      } else if (this.categorieId === 9998) {\n        await this.getRecommend('refresh')\n      } else {\n        await this.getArticle('refresh')\n      }\n      let obj = Object.assign({}, this.articles.articleList)\n      obj[this.categorieId] = this.article\n      this['articles/updateArticleList'](obj)\n    },\n    // 没登录获取默认标签\n    async getCategories() {\n      // 判断是否有缓存\n      if (this.articles.selectedCategory.length) {\n        this.categories = this.articles.selectedCategory\n      } else {\n        let res = await Aritcle.getCategories()\n        if (res.status !== 0) {\n          throw new Error(res.message)\n        }\n        this.categories = this.defalutCategories.concat(res.data)\n        this['articles/setSelectedCategory'](this.categories)\n      }\n    },\n    // 登录后获取自己的标签\n    async getUserCategories() {\n      if (this.articles.selectedCategory.length) {\n        this.categories = this.articles.selectedCategory\n      } else {\n        let res = await Aritcle.userCategory()\n        if (res.status !== 0) {\n          throw new Error(res.message)\n        }\n        res.data.unset.map(item => {\n          if (item.is_modify === undefined) {\n            item.is_modify = 1\n          }\n          return item\n        })\n        this.categories = this.defalutCategories.concat(res.data.set)\n        this['articles/setSelectedCategory'](this.categories)\n        this['articles/setUnSelectedCategory'](res.data.unset)\n      }\n    },\n    // 选择列表\n    async selectCategory(item) {\n      try {\n        this.page = 1\n        this.total = 1\n        this.categorieId = item.id\n        this['articles/setCategorysId'](item.id)\n        this.article = this.articles.articleList[item.id]\n          ? this.articles.articleList[item.id]\n          : []\n        document.documentElement.scrollTop = 0\n        this.requestInterface()\n      } catch (error) {\n        dialogService.toast(error.message)\n      }\n    },\n    // 获取推荐分类\n    async getRecommend(type) {\n      this.isRequest = true\n      let res = await Aritcle.getRecommend()\n      this.isRequest = false\n      if (res.status !== 0) {\n        throw new Error(res.message)\n      }\n      this.article = type ? res.data.data : this.article.concat(res.data.data)\n    },\n    // 获取文章\n    async getArticle(type) {\n      this.isRequest = true\n      let res = await Aritcle.getArticles(this.page, this.categorieId)\n      this.isRequest = false\n      if (res.status !== 0) {\n        throw new Error(res.message)\n      }\n      this.article = type ? res.data.data : this.article.concat(res.data.data)\n      this.page = res.data.current_page\n      this.total = res.data.last_page\n    },\n    // 获取关注文章\n    async getFollowArticle(type) {\n      try {\n        this.isRequest = true\n        let ress = await Aritcle.getFollowArticle(this.page)\n        this.isRequest = false\n        if (ress.status !== 0) {\n          throw new Error(ress.message)\n        }\n        this.article = type\n          ? ress.data.data\n          : this.article.concat(ress.data.data)\n        this.page = ress.data.current_page\n        this.total = ress.data.last_page\n      } catch (error) {\n        dialogService.toast(error.message)\n      }\n    },\n    // 得到关注信息\n    async getFollow() {\n      try {\n        let res = await Aritcle.getFollowUser()\n        await this.getFollowArticle('refresh')\n        if (res.status !== 0) {\n          throw new Error(res.message)\n        }\n        this.firstFollow = false\n        this.followUser = res.data\n        // 作者\n      } catch (error) {\n        dialogService.toast(error.message)\n      }\n    },\n    // 前往推荐\n    goRecommend() {\n      if (!this.user) {\n        guideService.login()\n        return false\n      }\n      try {\n        this.categorieId = 9998\n        this['articles/setCategorysId'](9998)\n        this.getRecommend('refresh')\n      } catch (error) {\n        dialogService.toast(error.message)\n      }\n    }\n  },\n  beforeRouteLeave(to, from, next) {\n    if (!/^\\/article/.test(to.path)) {\n      this['system/updateRouter']({\n        type: 'del',\n        data: 'articleIndex'\n      })\n    }\n    // this.categorieId = 9998\n    this['articles/setCategorysId'](9998)\n    next(true)\n  },\n  computed: {\n    ...mapState({\n      user: state => state.user.userInfo,\n      articles: state => state.articles,\n      platform: state => state.system.platform\n    }),\n    paddingTop: function() {\n      return this.platform !== 'wechat' ? '162px' : '82px'\n    }\n  },\n  components: {\n    Wrapper,\n    ArticleItem,\n    AppHeader,\n    ArticleAd,\n    FollowItem,\n    AppLoading,\n    FollowDetail\n  },\n  watch: {\n    $route(to, from) {\n      // 选择标签后，选择的标签取消后应默认推荐\n      if (from.path === '/article/classify') {\n        this.categories = this.articles.selectedCategory\n        let flag = this.articles.selectedCategory.some(item => {\n          return item.id == this.categorieId\n        })\n        if (flag) return false\n        this.categorieId = 9998\n        this.article = this.articles.articleList[this.categorieId]\n          ? this.articles.articleList[this.categorieId].splice(0, 0)\n          : []\n        this.goRecommend()\n      }\n      // 当跳出文章板块后再次进入默认推荐\n      // if (to.path.indexOf('/article') === -1) {\n      //   if (to.path === '/login') {\n      //     this.firstFollow = false\n      //     return false;\n      //   }\n      //   this.isShowPop = false\n      //   this['articles/setCategorysId'](9998)\n      //   this.article = []\n      //   // this.article = this.articles.articleList[9998] ?\n      //   //   this.articles.articleList[9998].splice(0, 0) : []\n      //   this.goRecommend();\n      // }\n    }\n  }\n}\n</script>\n<style lang=\"scss\" scoped>\n@import './index.scss';\n</style>"]}]}
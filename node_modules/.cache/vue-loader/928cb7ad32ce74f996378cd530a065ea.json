{"remainingRequest":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/qiang/work/hytx/hytx-rebuild/src/module/article/detail/index.vue?vue&type=style&index=0&id=d85c254a&lang=scss&scoped=true&","dependencies":[{"path":"/Users/qiang/work/hytx/hytx-rebuild/src/module/article/detail/index.vue","mtime":1547541582295},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/sass-loader/lib/loader.js","mtime":1533139052000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n@import './index.scss';\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAueA","file":"index.vue","sourceRoot":"src/module/article/detail","sourcesContent":["<template>\n  <div v-if=\"isShowArticleDetai\" style=\"position:fixed;width:100%;height:100%\">\n    <AppLoading v-if=\"isShowArticleDetai\"></AppLoading>\n  </div>\n  <Wrapper @scrolling=\"scrolling\" ref=\"wraper\" paddingTop=\"0\" v-else>\n    <AppHeader :title=\"'文章详情'\"></AppHeader>\n    <ArticleHeader v-show=\"searchBarFixed\" ref=\"header\" :input=\"shareMan||user\" :isAuthor=\"false\" :style=\"{'top': platform === 'wechat' ? '0px' : '90px'}\"></ArticleHeader>\n    <div class=\"comment-to-top\" ref=\"articleDetail\">\n      <div class=\"comment-top\">\n        <header class=\"header\">\n          {{article.title}}\n        </header>\n        <!-- 作者信息 -->\n        <ArticleHeader :input=\"author\" :isAuthor=\"true\"></ArticleHeader>\n        <div class=\"article-content\">\n          <div class=\"content\" v-html=\"article.content\">\n          </div>\n          <p>\n            版权声明:感谢作者的辛苦创作，如转载涉及版权等问题，请与我们联系处理！\n          </p>\n          <ul>\n            <li><span>阅读量{{article.pageviews||0}}</span>&nbsp;&nbsp;&nbsp;<span @click.stop=\"dianzan\"><i class=\"iconfont\" :class=\"article.is_thumb?'icon-dianzan2':'icon-dianzan1'\"></i>{{article.thumb || 0}}</span></li>\n            <li @click=\"goComplaint()\">投诉纠错</li>\n          </ul>\n        </div>\n\n        <template v-if=\"shareMan\">\n          <div class=\"title-line\">\n            <i></i>\n            <div class=\"title-font\">汇营名片</div>\n          </div>\n          <div class=\"visiting-card\" @click=\"goCard()\">\n            <div class=\"visiting-card-content\" :class=\"isActive?'active':''\">\n              <div class=\"icon\">\n                <img :src=\"shareMan ? shareMan.portrait : ''\" alt=\"\">\n              </div>\n              <div class=\"content\">\n                <h2 class=\"name\">{{shareMan ? shareMan.name : ''}}</h2>\n                <p class=\"info\">{{shareMan.profession||'其他'}}<span style=\"padding:0 20px\">|</span>{{shareMan.industry||'其他'}}</p>\n                <div class=\"desc\">{{shareMan.company || '信息未完善'}}</div>\n                <div v-if=\"(shareMan ? shareMan.id : '') !== (user ? user.id : '')\" @click.stop=\"focus(shareMan)\" class=\"button-wrapper\">\n                  <div class=\"button\" :class=\"shareMan.has_holder?'off':''\">{{shareMan.has_holder? '已收藏':'收藏'}}</div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </template>\n        <template v-if=\"!shareMan&&user\">\n          <div class=\"title-line\">\n            <i></i>\n            <div class=\"title-font\">汇营名片</div>\n          </div>\n          <div class=\"visiting-card\" @click=\"goCard()\">\n            <div class=\"visiting-card-content\" :class=\"isActive?'active':''\">\n              <div class=\"icon\">\n                <img :src=\"user.portrait\" alt=\"\">\n              </div>\n              <div class=\"content\">\n                <h2 class=\"name\">{{user.name}}</h2>\n                <p class=\"info\">{{user.profession||'其他'}}<span style=\"padding:0 20px\">|</span>{{user.industry||'其他'}}</p>\n                <div class=\"desc\">{{user.company || '信息未完善'}}</div>\n              </div>\n            </div>\n          </div>\n        </template>\n        <div class=\"title-line comment-title\">\n          <i></i>\n          <div class=\"title-font\">推荐文章</div>\n        </div>\n        <!-- 广告 -->\n        <ArticleAd v-if=\"article.ad\" :item=\"article.ad\"></ArticleAd>\n        <ul class=\"more-article\">\n          <router-link tag=\"li\" v-for=\"(item, index) in recommand\" :key=\"index\" :to=\"{path:`/article/detail/${item.id}`}\">\n            <ArticleItem :item=\"item\"></ArticleItem>\n          </router-link>\n        </ul>\n      </div>\n      <div id=\"comment\" ref=\"commentHot\" class=\"title-line comment-title\">\n        <i></i>\n        <div class=\"title-font\">热门评论</div>\n      </div>\n      <ul>\n        <li v-for=\"(item, index) in comments\" :key=\"index\" class=\"comment\">\n          <div class=\"avatar\">\n            <img :src=\"item.user.portrait||'/static/logo.png'\" alt=\"\">\n          </div>\n          <div class=\"comment-right\">\n            <div class=\"like\" @click=\"commentary(item,index)\">\n              <i class=\"iconfont\" :class=\"item.is_thumb?'icon-dianzan2':'icon-dianzan1'\"></i>{{item.thumb}}\n            </div>\n            <div class=\"name\">\n              {{item.user.name}}\n            </div>\n            <p class=\"detail\">\n              {{item.content}}\n            </p>\n            <div class=\"date\">\n              {{item.created_at}}\n            </div>\n          </div>\n        </li>\n      </ul>\n      <div @click=\"getComment(true)\" :class=\"loadMore?'more':'no-more'\" v-text=\"loadMore?'更多评论':'没有更多评论了'\">\n      </div>\n      <div class=\"copyright\">\n        汇脉宝营销平台提供技术支持\n      </div>\n    </div>\n    <div v-if=\"user\" class=\"submit-comment\" ref=\"footer\">\n      <div class=\"content\">\n        <div class=\"details\">\n          <!-- <p class=\"mask\" v-if=\"!user\" @click=\"verify()\"></p> -->\n          <input ref=\"myinput\" v-model=\"comment\" @blur=\"closeSubmit()\" @focus=\"showInput()\" placeholder=\"发表评论\" type=\"text\">\n        </div>\n        <div v-if=\"submit\" @click=\"sendComment()\" class=\"send\">发表</div>\n        <div v-if=\"!submit\" class=\"operate\">\n          <div class=\"icon\" @click=\"toggleToComment()\">\n            <i class=\"iconfont icon-message\"></i>\n            <span v-if=\"commentNum\" class=\"comment-num\" v-text=\"commentNum\"></span>\n          </div>\n          <div @click=\"collect()\" class=\"icon\">\n            <i class=\"iconfont icon-shoucang\" v-if=\"!article.is_favorite\"></i>\n            <i class=\"iconfont icon-shoucang1\" v-else></i>\n          </div>\n          <div class=\"icon\" @click=\"showShareGuide()\">\n            <i class=\"iconfont icon-fanhui1\"></i>\n          </div>\n        </div>\n      </div>\n    </div>\n    <RegisterGuid v-else ref=\"footer\" guidType=\"article\"></RegisterGuid>\n  </Wrapper>\n</template>\n<script>\nimport card from '../../../api/card'\nimport circle from '../../../api/circle'\nimport { mapState, mapActions } from 'vuex'\nimport Wrapper from '../../../components/Wrapper'\nimport Article from '../../../api/article/index'\nimport ArticleAd from '../../../components/ArticleAd'\nimport httpService from '../../../service/httpService'\nimport ArticleItem from '../../../components/ArticleItem'\nimport RegisterGuid from '../../../components/RegisterGuid'\nimport guideService from '../../../service/guideService.js'\nimport shareService from '../../../service/shareService.js'\nimport ArticleHeader from '../../../components/ArticleHeader'\nimport AppLoading from '../../../components/AppLoading'\nimport AppHeader from '../../../components/AppHeader'\nimport dialogService from '../../../service/dialogService'\nimport { getArticleCover, getParamsFromUrl } from '../../../utils'\nimport sdkService from '../../../service/sdkService'\n\nexport default {\n  data() {\n    return {\n      author: null, //作者信息\n      article: [], //文章内容\n      shareMan: null, //分享人\n      isActive: false,\n      recommand: [], // 推荐文章\n      comments: [], // 评论\n      commentNum: null, // 评论总数\n      loadMore: true, // 加载更多\n      submit: false, // 是否提交\n      comment: '', // 评论内容\n      page: 1,\n      scrollStatus: 1, // 1表示滚动到评论区   0表示滚动道顶部\n      searchBarFixed: false,\n      isShowArticleDetai: true,\n      scrollLength: null, // 滚动长度\n      windowHeight: null, // 可见内容高度\n      shareOptions: null // 分享配置参数\n    }\n  },\n  mounted() {\n    this.windowHeight = document.documentElement.clientHeight\n    this.init()\n  },\n  methods: {\n    async init() {\n      let self = this\n      this.isShowArticleDetai = true\n      this.scrollStatus = 1 // 1表示滚动到评论区   0表示滚动道顶部\n      try {\n        this.dataInit()\n        document.documentElement.scrollTop = 0\n        this.getComment()\n        await this.getArticleDetail()\n        this.getRecommand()\n        this.getCardByUserId()\n      } catch (err) {\n        dialogService.toast(err.message)\n      }\n    },\n    // 数据初始化\n    dataInit() {\n      this.page = 1\n      this.comment = ''\n      this.article = {}\n      this.comments = []\n      this.submit = false\n      this.loadMore = true\n      this.shareMan = null\n      this.commentNum = null\n      this.searchBarFixed = false\n    },\n    // 获取文章详情\n    async getArticleDetail() {\n      let res = await Article.getArticleById(this.$route.params.id)\n      if (res.status !== 0) {\n        throw new Error(res.message)\n      }\n      this.isShowArticleDetai = false\n      this.author = res.data.author\n      delete res.data.author\n      this.article = res.data\n      // 分享配置\n      let shareId = this.$route.params.shareId\n      this.shareOptions = sdkService.articleConfig(this.article, shareId)\n      sdkService.share(this.shareOptions)\n    },\n    // 获取推荐文章\n    async getRecommand() {\n      let res = await Article.getRecommand(this.article.article_category_uuid)\n      if (res.status !== 0) {\n        throw new Error(res.message)\n      }\n      this.recommand = res.data\n      this.recommand.forEach(item => {\n        if (item.cover.indexOf('[') > -1) {\n          item.cover_path = JSON.parse(item.cover)[0]\n        }\n      })\n    },\n    // 获取名片信息\n    async getCardByUserId() {\n      if (!this.$route.params.shareId) return false\n      let res = await card.getCardByUserId(this.$route.params.shareId)\n      if (res.status !== 0) {\n        throw new Error(res.message)\n      }\n      this.shareMan = res.data\n    },\n    //  获取评论列表 next是否翻页\n    async getComment(next) {\n      let loading = next === undefined ? false : true\n      if (!this.loadMore) return false\n      if (next) this.page++\n      let res = await Article.getComment(this.$route.params.id, this.page)\n      if (res.status !== 0) {\n        throw new Error(res.message)\n      }\n      this.commentNum = res.data.total\n      this.comments = this.comments.concat(res.data.data)\n      this.loadMore = this.comments.length !== res.data.total\n      this.isShowComment = false\n    },\n    // input变长\n    showInput() {\n      this.submit = true\n      setTimeout(() => {\n        this.$refs.myinput.scrollIntoView(true)\n      }, 100)\n    },\n    // input变小\n    closeSubmit() {\n      this.submit = false\n    },\n    //  发表评论\n    sendComment() {\n      if (this.user) {\n        let _self = this\n        let comment = this.comment.trim()\n        if (!comment) {\n          dialogService.toast('评论内容不能为空')\n          return false\n        } else {\n          this.comment = ''\n          Article.addcomment(this.$route.params.id, comment)\n            .then(res => {\n              if (res.status === 0) {\n                _self.refreshComments(res.data)\n              } else {\n                throw new Error(res.message)\n              }\n            })\n            .catch(err => {\n              dialogService.toast(err.message)\n            })\n        }\n      } else {\n        guideService.login()\n      }\n    },\n    //  发表评论后刷新评论\n    async refreshComments(item) {\n      this.loadMore = true\n      let page = this.page\n      this.page = 1\n      this.comments.unshift(item)\n      this.comment = ''\n    },\n    //  滚动到评论区/顶部\n    toggleToComment() {\n      let scrollY =\n        document\n          .getElementsByClassName('comment-top')[0]\n          .getBoundingClientRect().height -\n        this.windowHeight * 0.65\n      let end = null\n      // 热门评论出现在视野中就需要向上滚动 1表示滚动到评论区   0表示滚动道顶部\n      if (this.scrollLength + this.windowHeight > scrollY) {\n        this.scrollStatus = 0\n        end = 0 - this.scrollLength\n      } else {\n        this.scrollStatus = 1\n        end = scrollY - this.scrollLength\n      }\n      let step = parseInt(end / 400) //步长\n      let num = 0 // 累计步长\n      let timer = setInterval(() => {\n        if (Math.abs(num) < Math.abs(end)) {\n          window.scrollBy(0, step)\n          num += step\n        } else {\n          this.scrollStatus\n            ? window.scrollTo(0, scrollY)\n            : window.scrollTo(0, 0)\n          clearInterval(timer)\n        }\n      }, 1)\n    },\n    //  文章收藏/取消收藏\n    async collect() {\n      if (this.user) {\n        let isCollect = !this.article.is_favorite\n        try {\n          let res = await Article.collect(this.article.uuid, isCollect)\n          if (res.status !== 0) {\n            throw new Error(res.message)\n          }\n          this.article.is_favorite = isCollect\n          dialogService.toast(isCollect ? '收藏成功' : '取消收藏')\n        } catch (err) {\n          dialogService.toast(err.message)\n        }\n      } else {\n        guideService.login()\n      }\n    },\n    // 评论点赞\n    async commentary(item, index) {\n      try {\n        if (this.user) {\n          let res = null\n          if (!item.is_thumb) {\n            res = await Article.thumb(item.id)\n          } else {\n            res = await Article.unthumb(item.id)\n          }\n          if (res.status !== 0) {\n            throw new Error(res.message)\n          }\n          let obj = this.comments[index]\n          if (item.is_thumb) {\n            obj.thumb = obj.thumb - 1\n          } else {\n            obj.thumb = obj.thumb + 1\n          }\n          obj.is_thumb = !obj.is_thumb\n          this.$set(this.comments, index, obj)\n        } else {\n          guideService.login()\n        }\n      } catch (err) {\n        dialogService.toast(err.message)\n      }\n    },\n    // 文章点赞\n    async dianzan() {\n      try {\n        if (this.user) {\n          let res = null\n          let self = this\n          if (!this.article.is_thumb) {\n            res = await Article.thumbArticle(self.article.uuid)\n          } else {\n            res = await Article.unthumbArticle(self.article.uuid)\n          }\n          if (res.status !== 0) {\n            throw new Error(res.message)\n          }\n          let num = this.article.is_thumb\n            ? Number(this.article.thumb) - 1\n            : Number(this.article.thumb) + 1\n          this.$set(this.article, 'thumb', num)\n          this.$set(this.article, 'is_thumb', !this.article.is_thumb)\n        } else {\n          guideService.login()\n        }\n      } catch (err) {\n        dialogService.alert(err.message)\n      }\n    },\n    //  关注名片\n    async focus(shareMan) {\n      let _self = this\n      if (!shareMan || shareMan.has_holder) return\n      let shareManId = shareMan.card_id\n      let userId = this.user ? this.user.id : ''\n      if (!userId) {\n        guideService.login()\n      } else if (!shareManId) {\n        dialogService.alert('该用户还未添加信息')\n      } else {\n        try {\n          let res = await Article.collectCard(shareManId)\n          if (res.status !== 0) {\n            throw new Error(res.message)\n          }\n          _self.shareMan.has_holder = true\n        } catch (err) {\n          dialogService.toast(err.message)\n        }\n      }\n    }, // 投诉\n    goComplaint() {\n      if (!this.user) {\n        guideService.login()\n      } else {\n        this.$router.push({\n          path: '/article/complain',\n          query: {\n            id: this.article.uuid\n          }\n        })\n      }\n    },\n    //  跳转到名片\n    goCard() {\n      let id = this.$route.params.shareId || this.user.id\n      this.isActive = true\n      setTimeout(() => {\n        let self = this\n        this.$router.push({\n          path: `/card/detail/${id}`\n        })\n      }, 200)\n    },\n    // 显示分享引导\n    showShareGuide() {\n      shareService(this.shareOptions)\n    },\n    scrolling(e) {\n      this.scrollLength = e\n      if (e > 88) {\n        this.searchBarFixed = true\n      } else {\n        this.searchBarFixed = false\n      }\n    }\n  },\n  components: {\n    Wrapper,\n    ArticleAd,\n    ArticleItem,\n    ArticleHeader,\n    AppLoading,\n    RegisterGuid,\n    AppHeader\n  },\n  computed: {\n    ...mapState({\n      user: state => state.user.userInfo,\n      platform: state => state.system.platform\n    })\n  },\n  watch: {\n    $route(to, from) {\n      if (to.params.id !== from.params.id) {\n        this.init()\n      }\n    }\n  }\n}\n</script>\n<style lang=\"scss\" scoped>\n@import './index.scss';\n</style>"]}]}
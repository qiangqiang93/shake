{"remainingRequest":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/qiang/work/hytx/hytx-rebuild/src/module/activity/invite/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/qiang/work/hytx/hytx-rebuild/src/module/activity/invite/index.vue","mtime":1548378818728},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { mapState, mapActions } from 'vuex'\n\nimport card from '../../../api/card'\nimport Login from '../../../api/login'\nimport System from '../../../api/system'\n\nimport validate from '../../../utils/validate'\nimport { isIos, getParamsFromUrl } from '../../../utils'\n\nimport Wrapper from '../../../components/Wrapper'\n\nimport sdkService from '../../../service/sdkService'\nimport dialogService from '../../../service/dialogService'\nimport User from '../../../api/user'\n\nexport default {\n  name: 'mine-invite',\n  data() {\n    return {\n      code: '', // 验证码\n      phone: '', // 电话\n      timer: '', // 计时器\n      isIos: '', //是否是ios\n      open_id: '', // 用户标识\n      active: true, // 是否可点击验证码\n      shareInfo: {}, //分享人信息\n      shareId: null, // 分享人ID\n      subscribe: null, // 是否关注微信公众号0 未关注 1 关注\n      tips: '获取验证码', // 获取验证码\n      isRegister: false, // 是否注册了\n      oldUsers: false // 是否是老用户\n    }\n  },\n  mounted() {\n    this.init()\n  },\n  methods: {\n    // ...mapActions(['system/shareGuide']),\n    // 初始化\n    async init() {\n      let _self = this\n      this.isIos = isIos()\n      this.shareId = getParamsFromUrl('user_id')\n      this.open_id = getParamsFromUrl('open_id')\n      this.subscribe = getParamsFromUrl('subscribe')\n      this.open_id = this.open_id ? this.open_id.trim() : ''\n      let userId = this.userInfo ? this.userInfo.id : null\n      if (userId) {\n        dialogService.alert('您已登录，即将跳转到首页', function() {\n          _self.$router.push('/index')\n        })\n        return false\n      }\n      if (!this.shareId) {\n        _self.$router.push('/login')\n        return false\n      }\n\n      try {\n        let res = await card.getCardByUserId(this.shareId)\n        if (res.status !== 0) throw new Error(res.message)\n        this.shareInfo = res.data\n        this.shareConfig()\n      } catch (error) {\n        // let redirect = 'redirect=' + encodeURIComponent('/activity/invite')\n        // location.href = `${window.api}/front/oauth?user_id=&${redirect}`\n      }\n    },\n    // 分享配置\n    shareConfig() {\n      let redirect = 'redirect=' + encodeURIComponent('/activity/invite')\n      let query = `user_id=${this.shareId}&${redirect}&poster=1`\n      let url = `${window.api}/front/oauth?${query}`\n      let options = {\n        link: url,\n        desc: `汇脉宝—共享流量，专注营销`,\n        imgUrl: `${window.host}/static/hongbao.jpg`,\n        title: `我是${this.shareInfo.name}邀请您参加互推，一起瓜分1200W`,\n        success: function() {}\n      }\n      sdkService.share(options)\n    },\n    //  验证手机号是否已注册\n    async validatePhone() {\n      if (this.phone.length !== 11) {\n        this.oldUsers = false\n        return false\n      }\n      try {\n        let ress = await Login.phoneExist(this.phone)\n        if (ress.status !== 0) throw new Error(ress.message)\n        if (ress.data.is_exist) this.oldUsers = true\n      } catch (err) {\n        dialogService.toast(err.message)\n      }\n    },\n    // 倒计时\n    countdown() {\n      let second = 60\n      this.active = false\n      this.tips = second + 's'\n      this.timer = setInterval(() => {\n        second--\n        this.tips = second + 's'\n        if (second === 0) {\n          clearInterval(this.timer)\n          this.active = true\n          this.tips = '获取验证码'\n        }\n      }, 1000)\n    },\n    // 获取验证码 type发送验证码 1登录 2注册 3改密 4换绑 5设置支付密码\n    async getCode() {\n      if (!this.active || this.oldUsers) return\n      let check = validate.phone(this.phone)\n      if (!check.status) {\n        dialogService.toast(check.msg)\n        return false\n      }\n      try {\n        let res = await System.sendValidateCode(this.phone, 2)\n        if (res.status !== 0) throw new Error(res.message)\n        dialogService.toast('验证码发送成功,请注意查收')\n        this.countdown()\n      } catch (err) {\n        dialogService.toast(err.message)\n      }\n    },\n    // 通过手机号注册\n    async submit() {\n      let check = validate.phone(this.phone)\n      if (!check.status) {\n        dialogService.toast(check.msg)\n        return false\n      }\n      try {\n        let res = await Login.register({\n          code: this.code,\n          phone: this.phone,\n          open_id: this.open_id,\n          user_id: this.shareId\n        })\n        if (res.status == -1) throw new Error(res.message)\n        dialogService.toast('注册成功')\n        this.isRegister = true\n        User.getProfile()\n      } catch (error) {\n        dialogService.toast(error.message)\n      }\n    },\n    // 跳转到首页\n    goHome() {\n      this.$router.replace('/information')\n    }\n  },\n  computed: {\n    ...mapState({\n      userInfo: state => state.user.userInfo,\n      redirect: state => state.system.redirect\n    })\n  },\n  components: {\n    Wrapper\n  }\n}\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/module/activity/invite","sourcesContent":["<template>\n  <Wrapper class=\"activity-invite\">\n    <div class=\"activity-invite-main\">\n      <div class=\"activity-invite-inviter\">\n        <img class=\"activity-invite-avatar\" :src=\"shareInfo.portrait\" />\n        <span class=\"activity-invite-name\">{{shareInfo.name||'小脉宝'}}</span>\n      </div>\n      <div class=\"activity-invite-box\">\n        <p class=\"activity-invite-title\">立即领取1元</p>\n        <div class=\"activity-invite-input-wrap\">\n          <input class=\"activity-invite-input\" maxlength=\"11\" @input=\"validatePhone\" placeholder=\"输入手机号\" type=\"number\" v-model=\"phone\" />\n          <span class=\"activity-invite-input-code activity-invite-input-info\" v-if=\"phone.length==11&&oldUsers\">手机号已注册</span>\n        </div>\n        <div class=\"activity-invite-input-wrap\">\n          <input class=\"activity-invite-input\" placeholder=\"输入验证码\" type=\"number\" v-model=\"code\" />\n          <span class=\"activity-invite-input-code\" @click=\"getCode\">{{tips}}</span>\n        </div>\n        <div class=\"activity-invite-button-box\">\n          <button class=\"activity-invite-button button-active\" :disabled=\"!(phone&&code)\" @click=\"submit\">注册领取</button>\n        </div>\n      </div>\n    </div>\n    <div ref=\"footer\" class=\"activity-invite-footer\" v-show=\"isRegister\">\n      <template v-if=\"isIos\">\n        <p class=\"activity-invite-download button-active\" @click=\"goHome\">进入汇脉宝首页</p>\n      </template>\n      <template v-else>\n        <router-link tag=\"p\" to=\"/app/download\" class=\"activity-invite-download button-active\">下载汇脉宝APP</router-link>\n        <!-- <a class=\"activity-invite-download button-active\" href=\"http://weixin.yuhongrocky.top/hmb.apk\">下载汇脉宝APP</a> -->\n        <p class=\"activity-invite-index button-active\" @click=\"goHome\">进入首页</p>\n      </template>\n    </div>\n  </Wrapper>\n</template>\n<script>\nimport { mapState, mapActions } from 'vuex'\n\nimport card from '../../../api/card'\nimport Login from '../../../api/login'\nimport System from '../../../api/system'\n\nimport validate from '../../../utils/validate'\nimport { isIos, getParamsFromUrl } from '../../../utils'\n\nimport Wrapper from '../../../components/Wrapper'\n\nimport sdkService from '../../../service/sdkService'\nimport dialogService from '../../../service/dialogService'\nimport User from '../../../api/user'\n\nexport default {\n  name: 'mine-invite',\n  data() {\n    return {\n      code: '', // 验证码\n      phone: '', // 电话\n      timer: '', // 计时器\n      isIos: '', //是否是ios\n      open_id: '', // 用户标识\n      active: true, // 是否可点击验证码\n      shareInfo: {}, //分享人信息\n      shareId: null, // 分享人ID\n      subscribe: null, // 是否关注微信公众号0 未关注 1 关注\n      tips: '获取验证码', // 获取验证码\n      isRegister: false, // 是否注册了\n      oldUsers: false // 是否是老用户\n    }\n  },\n  mounted() {\n    this.init()\n  },\n  methods: {\n    // ...mapActions(['system/shareGuide']),\n    // 初始化\n    async init() {\n      let _self = this\n      this.isIos = isIos()\n      this.shareId = getParamsFromUrl('user_id')\n      this.open_id = getParamsFromUrl('open_id')\n      this.subscribe = getParamsFromUrl('subscribe')\n      this.open_id = this.open_id ? this.open_id.trim() : ''\n      let userId = this.userInfo ? this.userInfo.id : null\n      if (userId) {\n        dialogService.alert('您已登录，即将跳转到首页', function() {\n          _self.$router.push('/index')\n        })\n        return false\n      }\n      if (!this.shareId) {\n        _self.$router.push('/login')\n        return false\n      }\n\n      try {\n        let res = await card.getCardByUserId(this.shareId)\n        if (res.status !== 0) throw new Error(res.message)\n        this.shareInfo = res.data\n        this.shareConfig()\n      } catch (error) {\n        // let redirect = 'redirect=' + encodeURIComponent('/activity/invite')\n        // location.href = `${window.api}/front/oauth?user_id=&${redirect}`\n      }\n    },\n    // 分享配置\n    shareConfig() {\n      let redirect = 'redirect=' + encodeURIComponent('/activity/invite')\n      let query = `user_id=${this.shareId}&${redirect}&poster=1`\n      let url = `${window.api}/front/oauth?${query}`\n      let options = {\n        link: url,\n        desc: `汇脉宝—共享流量，专注营销`,\n        imgUrl: `${window.host}/static/hongbao.jpg`,\n        title: `我是${this.shareInfo.name}邀请您参加互推，一起瓜分1200W`,\n        success: function() {}\n      }\n      sdkService.share(options)\n    },\n    //  验证手机号是否已注册\n    async validatePhone() {\n      if (this.phone.length !== 11) {\n        this.oldUsers = false\n        return false\n      }\n      try {\n        let ress = await Login.phoneExist(this.phone)\n        if (ress.status !== 0) throw new Error(ress.message)\n        if (ress.data.is_exist) this.oldUsers = true\n      } catch (err) {\n        dialogService.toast(err.message)\n      }\n    },\n    // 倒计时\n    countdown() {\n      let second = 60\n      this.active = false\n      this.tips = second + 's'\n      this.timer = setInterval(() => {\n        second--\n        this.tips = second + 's'\n        if (second === 0) {\n          clearInterval(this.timer)\n          this.active = true\n          this.tips = '获取验证码'\n        }\n      }, 1000)\n    },\n    // 获取验证码 type发送验证码 1登录 2注册 3改密 4换绑 5设置支付密码\n    async getCode() {\n      if (!this.active || this.oldUsers) return\n      let check = validate.phone(this.phone)\n      if (!check.status) {\n        dialogService.toast(check.msg)\n        return false\n      }\n      try {\n        let res = await System.sendValidateCode(this.phone, 2)\n        if (res.status !== 0) throw new Error(res.message)\n        dialogService.toast('验证码发送成功,请注意查收')\n        this.countdown()\n      } catch (err) {\n        dialogService.toast(err.message)\n      }\n    },\n    // 通过手机号注册\n    async submit() {\n      let check = validate.phone(this.phone)\n      if (!check.status) {\n        dialogService.toast(check.msg)\n        return false\n      }\n      try {\n        let res = await Login.register({\n          code: this.code,\n          phone: this.phone,\n          open_id: this.open_id,\n          user_id: this.shareId\n        })\n        if (res.status == -1) throw new Error(res.message)\n        dialogService.toast('注册成功')\n        this.isRegister = true\n        User.getProfile()\n      } catch (error) {\n        dialogService.toast(error.message)\n      }\n    },\n    // 跳转到首页\n    goHome() {\n      this.$router.replace('/information')\n    }\n  },\n  computed: {\n    ...mapState({\n      userInfo: state => state.user.userInfo,\n      redirect: state => state.system.redirect\n    })\n  },\n  components: {\n    Wrapper\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.activity-invite {\n  display: flex;\n  overflow: hidden;\n  background: #ffffff;\n  flex-direction: column;\n}\n.activity-invite-main {\n  width: 100%;\n  height: 3223px;\n  overflow: hidden;\n  position: relative;\n  box-sizing: border-box;\n  background-size: 100% 100%;\n  background-repeat: no-repeat;\n  background-image: url('./bg.jpg');\n}\n.activity-invite-inviter {\n  left: 27%;\n  top: 292px;\n  position: absolute;\n  .activity-invite-avatar {\n    width: 40px;\n    float: left;\n    height: 40px;\n    border-radius: 50%;\n    margin-right: 11px;\n  }\n  .activity-invite-name {\n    float: left;\n    font-size: 24px;\n    color: #ffffff;\n    line-height: 40px;\n  }\n}\n.activity-invite-box {\n  left: 50%;\n  top: 862px;\n  width: 710px;\n  height: 400px;\n  background: #fff;\n  position: absolute;\n  border-radius: 10px;\n  transform: translateX(-50%);\n  .activity-invite-title {\n    font-size: 32px;\n    color: #000000;\n    padding-top: 28px;\n    text-align: center;\n    margin-bottom: 35px;\n  }\n  .activity-invite-input-wrap {\n    width: 630px;\n    overflow: hidden;\n    margin: 45px auto 0;\n    padding-bottom: 14px;\n    border-bottom: 1px solid #d3d3d3;\n  }\n  .activity-invite-input {\n    width: 460px;\n    outline: none;\n    font-size: 28px;\n  }\n  .activity-invite-input-code {\n    font-size: 26px;\n    color: #274ff3;\n    float: right;\n  }\n  .activity-invite-input-info {\n    color: red;\n  }\n  .activity-invite-button-box {\n    display: flex;\n  }\n  .activity-invite-button {\n    height: 70px;\n    width: 279px;\n    color: #fff;\n    outline: none;\n    font-size: 32px;\n    line-height: 70px;\n    text-align: center;\n    margin: 45px auto 0;\n    border-radius: 10px;\n    background: #466afa;\n    &:disabled {\n      background: #999;\n    }\n  }\n}\n.activity-invite-footer {\n  left: 0;\n  bottom: 0;\n  width: 100%;\n  height: 128px;\n  display: flex;\n  padding: 0 20px;\n  position: fixed;\n  font-size: 32px;\n  overflow: hidden;\n  background: #fff;\n  align-items: center;\n  box-sizing: border-box;\n  justify-content: space-between;\n  .activity-invite-download {\n    flex: 1;\n    width: 345px;\n    height: 88px;\n    color: #fff;\n    line-height: 88px;\n    text-align: center;\n    border-radius: 8px;\n    background-color: #274ff3;\n    box-shadow: 0px 0px 3px 0px rgba(0, 0, 0, 0.1);\n  }\n  .activity-invite-index {\n    flex: 1;\n    height: 88px;\n    color: #274ff3;\n    margin-left: 20px;\n    line-height: 88px;\n    text-align: center;\n    border-radius: 8px;\n    border: solid 1px #274ff3;\n    box-shadow: 0px 0px 3px 0px rgba(0, 0, 0, 0.1);\n  }\n}\n</style>"]}]}
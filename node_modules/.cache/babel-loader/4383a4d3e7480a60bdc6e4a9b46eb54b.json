{"remainingRequest":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/babel-loader/lib/index.js!/Users/qiang/work/hytx/hytx-rebuild/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/qiang/work/hytx/hytx-rebuild/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/qiang/work/hytx/hytx-rebuild/src/module/spread/create/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/qiang/work/hytx/hytx-rebuild/src/module/spread/create/index.vue","mtime":1548296329463},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _regeneratorRuntime from \"/Users/qiang/work/hytx/hytx-rebuild/node_modules/@babel/runtime/regenerator\";\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport coin from '@/api/coin';\nimport province from './province.json';\nimport { mapActions, mapState } from 'vuex';\nimport eventBus from '../../../utils/eventBus';\nimport Picker from '../../../components/Pickers';\nimport Wrapper from '../../../components/Wrapper';\nimport SlideShow from '../../../components/SlideShow';\nimport httpService from '../../../service/httpService';\nimport dialogService from '../../../service/dialogService';\nexport default {\n  name: 'spreadCreate',\n  data: function data() {\n    return {\n      img: null,\n      index: 0,\n      graphics: [],\n      // 图文内容副本\n      isSave: false,\n      // 是否更改和保存\n      isInsert: true,\n      // 是否插入名片\n      marketings: [],\n      // 营销网页列表\n      province: province,\n      // 地区\n      scrollHeight: null,\n      // 滚动高度\n      myCoins: '获取中...',\n      // 所有脉宝\n      areaText: '全国',\n      // 推广地区名称\n      selectedProvince: null,\n      // 当前选择的地区\n      selectedMarketing: null,\n      // 当前选中的营销网页\n      showMarketings: false,\n      // 是否显示营销网页选择\n      showProvinces: false,\n      // 是否显示地区选择\n      myAD: {\n        title: '',\n        // 广告标题\n        cover: '',\n        // 广告封面\n        card_id: '',\n        // 名片id\n        content: '',\n        // 图文内容\n        maibao_num: '',\n        // 脉宝总数\n        province_id: '',\n        // 推广省的id\n        user_marketing_id: '',\n        // 营销网页id\n        maibao_spend_num: '' // 每次分享花费脉宝数\n\n      }\n    };\n  },\n  beforeMount: function beforeMount() {\n    try {\n      if (this.spreadAD) this.myAD = Object.assign({}, this.spreadAD);\n      this.graphics = JSON.parse(this.spreadAD.content);\n    } catch (err) {\n      this.graphics = [];\n    }\n  },\n  mounted: function () {\n    var _mounted = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              this.getCoins();\n              this.getMarketings();\n              this.$set(this.myAD, 'card_id', this.user.card_id);\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this);\n    }));\n\n    function mounted() {\n      return _mounted.apply(this, arguments);\n    }\n\n    return mounted;\n  }(),\n  methods: _objectSpread({}, mapActions(['spread/updateSpreadAD']), {\n    donothing: function donothing() {// nothing\n    },\n    // 获取脉宝余额\n    getCoins: function () {\n      var _getCoins = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2() {\n        var res;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.prev = 0;\n                _context2.next = 3;\n                return coin.getBalance();\n\n              case 3:\n                res = _context2.sent;\n\n                if (!(res.status !== 0)) {\n                  _context2.next = 6;\n                  break;\n                }\n\n                throw new Error(res.message);\n\n              case 6:\n                this.myCoins = res.data.maibao;\n                _context2.next = 12;\n                break;\n\n              case 9:\n                _context2.prev = 9;\n                _context2.t0 = _context2[\"catch\"](0);\n                dialogService.alert(_context2.t0.message);\n\n              case 12:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[0, 9]]);\n      }));\n\n      function getCoins() {\n        return _getCoins.apply(this, arguments);\n      }\n\n      return getCoins;\n    }(),\n    // 获取营销网页列表\n    getMarketings: function () {\n      var _getMarketings = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3() {\n        var res;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.prev = 0;\n                _context3.next = 3;\n                return httpService.get('/front/user-marketing');\n\n              case 3:\n                res = _context3.sent;\n\n                if (!(res.status !== 0)) {\n                  _context3.next = 6;\n                  break;\n                }\n\n                throw new Error(res.message);\n\n              case 6:\n                this.marketings = res.data.data;\n                _context3.next = 12;\n                break;\n\n              case 9:\n                _context3.prev = 9;\n                _context3.t0 = _context3[\"catch\"](0);\n                dialogService.alert(_context3.t0.message);\n\n              case 12:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this, [[0, 9]]);\n      }));\n\n      function getMarketings() {\n        return _getMarketings.apply(this, arguments);\n      }\n\n      return getMarketings;\n    }(),\n    // slideTo\n    slideTo: function slideTo(index) {\n      this.index = index;\n    },\n    // 输入的脉宝总数和单次花费\n    inputHandler: function inputHandler(type) {\n      if (type === 'maibao_num') {\n        var val = parseInt(Math.abs(this.myAD.maibao_num));\n        if (isNaN(val) || val === 0) val = '';\n        this.myAD.maibao_num = val < this.myCoins ? val : this.myCoins;\n      } else {\n        var _val = parseInt(Math.abs(this.myAD.maibao_spend_num));\n\n        if (isNaN(_val) || _val === 0) _val = '';\n        this.myAD.maibao_spend_num = _val < 3 ? _val : 3;\n      }\n    },\n    // 插入营销网页\n    showMarketing: function showMarketing() {\n      if (!this.marketings.length) {\n        dialogService.alert('您还没有制作营销网页哦');\n        console.error('跳转去添加营销网页是最优处理');\n        return false;\n      }\n\n      this.showMarketings = true;\n    },\n    // 选择营销网页\n    selectMarketing: function selectMarketing(index) {\n      var _this = this;\n\n      this.marketings = this.marketings.map(function (item, _index) {\n        item.selected = index === _index;\n\n        if (item.selected) {\n          _this.selectedMarketing = item;\n        }\n\n        return item;\n      });\n    },\n    // 确认营销网页\n    submitMarketing: function submitMarketing() {\n      this.$set(this.myAD, 'user_marketing_id', this.selectedMarketing.id || '');\n      this.showMarketings = false;\n    },\n    closeMarketing: function closeMarketing() {\n      this.showMarketings = false;\n    },\n    showAreaPicker: function showAreaPicker() {\n      this.showProvinces = true;\n    },\n    // 确认推广地区\n    submitProvince: function submitProvince() {\n      this.areaText = this.selectedProvince.name;\n      this.$set(this.myAD, 'province_id', this.selectedProvince.id || '');\n      this.showProvinces = false;\n    },\n    closeProvince: function closeProvince() {\n      this.showProvinces = false;\n    },\n    // 选择推广地区\n    selectProvince: function selectProvince(index) {\n      var _this2 = this;\n\n      this.province = this.province.map(function (item, _index) {\n        item.selected = index === _index;\n\n        if (item.selected) {\n          _this2.selectedProvince = item;\n        }\n\n        return item;\n      });\n    },\n    // 删除营销网页\n    deleteMarketing: function deleteMarketing() {\n      this.selectedMarketing = null;\n      this.marketings = this.marketings.map(function (item, _index) {\n        item.selected = false;\n        return item;\n      });\n      this.$set(this.myAD, 'user_marketing_id', '');\n    },\n    // 是否插入名片\n    insertCard: function insertCard(input) {\n      if (input === this.isInsert) return;\n      this.isInsert = input;\n      this.$set(this.myAD, 'card_id', input ? this.user.card_id : '');\n    },\n    // 预览\n    preview: function preview() {\n      this._saveTemp();\n\n      this.$router.push({\n        path: '/spread/preview'\n      });\n    },\n    // 保存[保存4,发布0]\n    save: function () {\n      var _save = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4(type) {\n        var res;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                if (!this._validate()) {\n                  _context4.next = 16;\n                  break;\n                }\n\n                this.isSave = true;\n                this.myAD.status = type;\n                _context4.prev = 3;\n                _context4.next = 6;\n                return httpService.post('/front/spread', this.myAD);\n\n              case 6:\n                res = _context4.sent;\n\n                if (!(res.status !== 0)) {\n                  _context4.next = 9;\n                  break;\n                }\n\n                throw new Error(res.message);\n\n              case 9:\n                // 发布、保存成功,删除暂存的广告并跳转到发布管理\n                this['spread/updateSpreadAD'](null);\n                this.$router.replace({\n                  path: '/spread/manger'\n                });\n                _context4.next = 16;\n                break;\n\n              case 13:\n                _context4.prev = 13;\n                _context4.t0 = _context4[\"catch\"](3);\n                dialogService.alert(_context4.t0.message);\n\n              case 16:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this, [[3, 13]]);\n      }));\n\n      function save(_x) {\n        return _save.apply(this, arguments);\n      }\n\n      return save;\n    }(),\n    // 预览、充值时先将内容保存\n    _saveTemp: function _saveTemp() {\n      this.$set(this.myAD, 'cover', this.graphics[0].img);\n      var tempGraphics = this.graphics.filter(function (item) {\n        return item.img || item.txt;\n      });\n      this.$set(this.myAD, 'content', JSON.stringify(tempGraphics));\n      this['spread/updateSpreadAD'](this.myAD);\n    },\n    // 数据校验\n    _validate: function _validate() {\n      // 验证图文是否通过\n      var tempGraphics = this.graphics.filter(function (item) {\n        return !!(item.img || item.txt);\n      });\n\n      for (var i = 0; i < tempGraphics.length; i++) {\n        if (!tempGraphics[i].img) {\n          dialogService.alert(\"\\u56FE\\u6587\\u4E2D\\u7B2C\".concat(i + 1, \"\\u9879\\u7684\\u56FE\\u7247\\u8FD8\\u672A\\u4E0A\\u4F20\"));\n          return false;\n        }\n\n        if (!tempGraphics[i].txt) {\n          dialogService.alert(\"\\u56FE\\u6587\\u4E2D\\u7B2C\".concat(i + 1, \"\\u9879\\u7684\\u6587\\u672C\\u8FD8\\u672A\\u586B\\u5199\"));\n          return false;\n        }\n      } // 如果没有任何图文\n\n\n      if (!tempGraphics.length) {\n        dialogService.alert(\"\\u60A8\\u8FD8\\u6CA1\\u6709\\u586B\\u5199\\u4EFB\\u4F55\\u56FE\\u6587\\u5185\\u5BB9\");\n        return false;\n      } // 总脉宝数\n\n\n      if (!this.myAD.maibao_num) {\n        dialogService.alert(\"\\u60A8\\u8FD8\\u6CA1\\u6709\\u586B\\u5199\\u672C\\u6B21\\u63A8\\u5E7F\\u7684\\u603B\\u8109\\u5B9D\\u6570\");\n        return false;\n      } // 总脉宝数至少300\n\n\n      if (parseInt(this.myAD.maibao_num) < 300) {\n        dialogService.alert(\"\\u63A8\\u5E7F\\u8109\\u5B9D\\u603B\\u6570\\u6700\\u5C11\\u4E0D\\u80FD\\u5C11\\u4E8E300\");\n        return false;\n      } // 单次花费的脉宝数\n\n\n      if (!this.myAD.maibao_num) {\n        dialogService.alert(\"\\u60A8\\u8FD8\\u6CA1\\u6709\\u586B\\u5199\\u5355\\u6B21\\u5206\\u4EAB\\u5E7F\\u544A\\u7684\\u8109\\u5B9D\\u5956\\u52B1\");\n        return false;\n      }\n\n      if (this.myAD.maibao_num % this.myAD.maibao_num !== 0) {\n        dialogService.alert(\"\\u6BCF\\u6B21\\u5206\\u4EAB\\u8109\\u5B9D\\u4E2A\\u6570\\u5206\\u914D\\u4E0D\\u5747\\uFF01\\u8BF7\\u91CD\\u65B0\\u5206\\u914D\");\n        return false;\n      } // 验证标题是否填写\n\n\n      if (!this.myAD.title) {\n        dialogService.alert(\"\\u5E7F\\u544A\\u6807\\u9898\\u8FD8\\u672A\\u586B\\u5199\");\n        return false;\n      }\n\n      this.$set(this.myAD, 'cover', tempGraphics[0].img);\n      this.$set(this.myAD, 'content', JSON.stringify(tempGraphics));\n      return true;\n    }\n  }),\n  components: {\n    Wrapper: Wrapper,\n    SlideShow: SlideShow\n  },\n  computed: _objectSpread({}, mapState({\n    user: function user(state) {\n      return state.user.userInfo;\n    },\n    spreadAD: function spreadAD(state) {\n      return state.spread.spreadAD;\n    },\n    platform: function platform(state) {\n      return state.system.platform;\n    }\n  }), {\n    paddingTop: function paddingTop() {\n      return this.platform === 'wechat' ? '0px' : '100px';\n    }\n  }),\n  beforeRouteLeave: function beforeRouteLeave(to, from, next) {\n    var isEdit = false;\n\n    for (var key in this.myAD) {\n      if (key !== 'card_id') {\n        if (key === 'content') {\n          if (this.myAD[key] !== '[]' && this.myAD[key] !== '') {\n            isEdit = true;\n            break;\n          }\n        } else if (this.myAD[key]) {\n          isEdit = true;\n          break;\n        }\n      }\n    }\n\n    var confirmLeave = function confirmLeave() {\n      dialogService.confirm('您还没保存，确定要离开？', function (val) {\n        if (val) next();\n      });\n    };\n\n    switch (to.path) {\n      // 预览\n      case '/spread/preview':\n        if (!isEdit) {\n          next(false);\n          dialogService.alert('您还没有编辑任何内容!');\n        } else {\n          next();\n        }\n\n        break;\n      // 全民推广首页\n\n      case '/spread/index':\n        // 判断是否为返回\n        if (isEdit) {\n          next(false);\n          confirmLeave();\n        } else {\n          next();\n        }\n\n        break;\n      // 脉宝充值\n\n      case '/user/veinCoin/recharge':\n        this._saveTemp();\n\n        next();\n        break;\n      // 图片裁剪\n\n      case '/cropper':\n        next();\n        break;\n\n      default:\n        if (isEdit && !this.isSave) {\n          next(false);\n          confirmLeave();\n        } else {\n          next();\n        }\n\n    }\n  }\n};",{"version":3,"sources":["index.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <Wrapper class=\"spread-ad\" :paddingTop=\"paddingTop\">\n    <!-- 图片 -->\n    <h3>封面</h3>\n    <div class=\"spread-imgs\">\n      <SlideShow :isEdit=\"true\" :input=\"graphics\" :index=\"index\" :slideTo=\"slideTo\"></SlideShow>\n    </div>\n    <!-- 内容设置 -->\n    <h3>内容设置</h3>\n    <div class=\"my-coin\">\n      <i class=\"iconfont\"></i>\n      <span>我的脉宝：</span>\n      <span v-text=\"myCoins + '个'\"></span>\n      <router-link to=\"/user/veinCoin/recharge\" tag=\"span\" class=\"coin-charge\">充值</router-link>\n    </div>\n    <div class=\"row\">\n      <label>脉宝总数：</label>\n      <input type=\"number\" v-model=\"myAD.maibao_num\" @input=\"inputHandler('maibao_num')\">\n      <span>个</span>\n      <small>总数不低于300</small>\n    </div>\n    <div class=\"row\">\n      <label>每次分享花费：</label>\n      <input type=\"number\" v-model=\"myAD.maibao_spend_num\" @input=\"inputHandler('maibao_spend_num')\">\n      <span>个</span>\n      <small>不超过3个</small>\n    </div>\n    <div class=\"spread-title\">\n      <label>标题：</label>\n      <textarea placeholder=\"请输入本次推广的标题\" maxlength=\"20\" v-model=\"myAD.title\"></textarea>\n      <p class=\"tip\">限20字</p>\n    </div>\n    <!-- 营销网页设置 -->\n    <div class=\"marketing\">\n      <span>插入营销网页：</span>\n      <span class=\"chosePage\" @click=\"showMarketing()\">选择营销网页</span>\n    </div>\n    <div class=\"spread-page\" v-if=\"selectedMarketing\">\n      <p class=\"marketing-title\" v-text=\"selectedMarketing.title\"></p>\n      <p class=\"marketing-date\">{{selectedMarketing.created_at | timeFormt('YYYY-MM-DD')}}</p>\n      <span class=\"delete iconfont icon-shanchuguanbicha\" @click=\"deleteMarketing()\"></span>\n    </div>\n    <div class=\"spread-area\">\n      <label>选择推广区域：</label>\n      <span class=\"area\" @click=\"showAreaPicker()\" v-text=\"areaText\">全国</span>\n    </div>\n    <div class=\"spread-card\">\n      <label for=\"\">是否插入自己的名片:</label>\n      <span :class=\"{'active': isInsert}\" @click=\"insertCard(true)\">是</span>\n      <span :class=\"{'active': !isInsert}\" @click=\"insertCard(false)\">否</span>\n    </div>\n    <div class=\"spread-foot\" ref=\"footer\">\n      <a href=\"javascript:void(0)\" @click=\"preview()\">预览</a>\n      <a class=\"hasborder\" href=\"javascript:void(0)\" @click=\"save(4)\">保存</a>\n      <a class=\"publish\" href=\"javascript:void(0)\" @click=\"save(0)\">发布</a>\n    </div>\n    <!-- 选择营销网页 -->\n    <div class=\"marketing-cover\" :class=\"{'show': showMarketings}\" @touchmove.prevent=\"donothing()\" @click=\"closeMarketing()\">\n      <div class=\"marketing-wrapper\" :class=\"{'show': showMarketings}\" @click.stop=\"donothing()\">\n        <div class=\"marketing-header\">\n          <span class=\"cancle\" @click=\"closeMarketing()\">取消</span>\n          <span class=\"title\">营销网页</span>\n          <span class=\"submit\" @click=\"submitMarketing()\">确定</span>\n        </div>\n        <div class=\"marketing-container\">\n          <div class=\"marketing-item\" v-for=\"(item, index) in marketings\" :key=\"index\" @click=\"selectMarketing(index)\">\n            <p class=\"marketing-title\" v-text=\"item.title\"></p>\n            <p class=\"marketing-date\">{{item.created_at | timeFormt('YYYY-MM-DD')}}</p>\n            <span :class=\"{'active': item.selected}\"></span>\n          </div>\n        </div>\n      </div>\n    </div>\n    <!-- 选择推广地区 -->\n    <div class=\"marketing-cover\" :class=\"{'show': showProvinces}\" @touchmove.prevent=\"donothing()\" @click=\"closeProvince()\">\n      <div class=\"marketing-wrapper\" :class=\"{'show': showProvinces}\" @click.stop=\"donothing()\">\n        <div class=\"marketing-header\">\n          <span class=\"cancle\" @click=\"closeProvince()\">取消</span>\n          <span class=\"title\">推广地区</span>\n          <span class=\"submit\" @click=\"submitProvince()\">确定</span>\n        </div>\n        <div class=\"marketing-container\">\n          <div class=\"marketing-item\" v-for=\"(item, index) in province\" :key=\"index\" @click=\"selectProvince(index)\">\n            <p class=\"marketing-title\" v-text=\"item.name\"></p>\n            <span :class=\"{'active': item.selected}\"></span>\n          </div>\n        </div>\n      </div>\n    </div>\n  </Wrapper>\n</template>\n\n<script>\nimport coin from '@/api/coin'\nimport province from './province.json'\nimport { mapActions, mapState } from 'vuex'\nimport eventBus from '../../../utils/eventBus'\nimport Picker from '../../../components/Pickers'\nimport Wrapper from '../../../components/Wrapper'\nimport SlideShow from '../../../components/SlideShow'\nimport httpService from '../../../service/httpService'\nimport dialogService from '../../../service/dialogService'\nexport default {\n  name: 'spreadCreate',\n  data() {\n    return {\n      img: null,\n      index: 0,\n      graphics: [], // 图文内容副本\n      isSave: false, // 是否更改和保存\n      isInsert: true, // 是否插入名片\n      marketings: [], // 营销网页列表\n      province: province, // 地区\n      scrollHeight: null, // 滚动高度\n      myCoins: '获取中...', // 所有脉宝\n      areaText: '全国', // 推广地区名称\n      selectedProvince: null, // 当前选择的地区\n      selectedMarketing: null, // 当前选中的营销网页\n      showMarketings: false, // 是否显示营销网页选择\n      showProvinces: false, // 是否显示地区选择\n      myAD: {\n        title: '', // 广告标题\n        cover: '', // 广告封面\n        card_id: '', // 名片id\n        content: '', // 图文内容\n        maibao_num: '', // 脉宝总数\n        province_id: '', // 推广省的id\n        user_marketing_id: '', // 营销网页id\n        maibao_spend_num: '' // 每次分享花费脉宝数\n      }\n    }\n  },\n  beforeMount() {\n    try {\n      if (this.spreadAD) this.myAD = Object.assign({}, this.spreadAD)\n      this.graphics = JSON.parse(this.spreadAD.content)\n    } catch (err) {\n      this.graphics = []\n    }\n  },\n  async mounted() {\n    this.getCoins()\n    this.getMarketings()\n    this.$set(this.myAD, 'card_id', this.user.card_id)\n  },\n  methods: {\n    ...mapActions(['spread/updateSpreadAD']),\n    donothing() {\n      // nothing\n    },\n    // 获取脉宝余额\n    async getCoins() {\n      try {\n        let res = await coin.getBalance()\n        if (res.status !== 0) throw new Error(res.message)\n        this.myCoins = res.data.maibao\n      } catch (err) {\n        dialogService.alert(err.message)\n      }\n    },\n    // 获取营销网页列表\n    async getMarketings() {\n      try {\n        let res = await httpService.get('/front/user-marketing')\n        if (res.status !== 0) throw new Error(res.message)\n        this.marketings = res.data.data\n      } catch (err) {\n        dialogService.alert(err.message)\n      }\n    },\n    // slideTo\n    slideTo(index) {\n      this.index = index\n    },\n    // 输入的脉宝总数和单次花费\n    inputHandler(type) {\n      if (type === 'maibao_num') {\n        let val = parseInt(Math.abs(this.myAD.maibao_num))\n        if (isNaN(val) || val === 0) val = ''\n        this.myAD.maibao_num = val < this.myCoins ? val : this.myCoins\n      } else {\n        let val = parseInt(Math.abs(this.myAD.maibao_spend_num))\n        if (isNaN(val) || val === 0) val = ''\n        this.myAD.maibao_spend_num = val < 3 ? val : 3\n      }\n    },\n    // 插入营销网页\n    showMarketing() {\n      if (!this.marketings.length) {\n        dialogService.alert('您还没有制作营销网页哦')\n        console.error('跳转去添加营销网页是最优处理')\n        return false\n      }\n      this.showMarketings = true\n    },\n    // 选择营销网页\n    selectMarketing(index) {\n      this.marketings = this.marketings.map((item, _index) => {\n        item.selected = index === _index\n        if (item.selected) {\n          this.selectedMarketing = item\n        }\n        return item\n      })\n    },\n    // 确认营销网页\n    submitMarketing() {\n      this.$set(this.myAD, 'user_marketing_id', this.selectedMarketing.id || '')\n      this.showMarketings = false\n    },\n    closeMarketing() {\n      this.showMarketings = false\n    },\n    showAreaPicker() {\n      this.showProvinces = true\n    },\n    // 确认推广地区\n    submitProvince() {\n      this.areaText = this.selectedProvince.name\n      this.$set(this.myAD, 'province_id', this.selectedProvince.id || '')\n      this.showProvinces = false\n    },\n    closeProvince() {\n      this.showProvinces = false\n    },\n    // 选择推广地区\n    selectProvince(index) {\n      this.province = this.province.map((item, _index) => {\n        item.selected = index === _index\n        if (item.selected) {\n          this.selectedProvince = item\n        }\n        return item\n      })\n    },\n    // 删除营销网页\n    deleteMarketing() {\n      this.selectedMarketing = null\n      this.marketings = this.marketings.map((item, _index) => {\n        item.selected = false\n        return item\n      })\n      this.$set(this.myAD, 'user_marketing_id', '')\n    },\n    // 是否插入名片\n    insertCard(input) {\n      if (input === this.isInsert) return\n      this.isInsert = input\n      this.$set(this.myAD, 'card_id', input ? this.user.card_id : '')\n    },\n    // 预览\n    preview() {\n      this._saveTemp()\n      this.$router.push({\n        path: '/spread/preview'\n      })\n    },\n    // 保存[保存4,发布0]\n    async save(type) {\n      if (this._validate()) {\n        this.isSave = true\n        this.myAD.status = type\n        try {\n          let res = await httpService.post('/front/spread', this.myAD)\n          if (res.status !== 0) throw new Error(res.message)\n          // 发布、保存成功,删除暂存的广告并跳转到发布管理\n          this['spread/updateSpreadAD'](null)\n          this.$router.replace({\n            path: '/spread/manger'\n          })\n        } catch (err) {\n          dialogService.alert(err.message)\n        }\n      }\n    },\n    // 预览、充值时先将内容保存\n    _saveTemp() {\n      this.$set(this.myAD, 'cover', this.graphics[0].img)\n      let tempGraphics = this.graphics.filter(item => {\n        return item.img || item.txt\n      })\n      this.$set(this.myAD, 'content', JSON.stringify(tempGraphics))\n      this['spread/updateSpreadAD'](this.myAD)\n    },\n    // 数据校验\n    _validate() {\n      // 验证图文是否通过\n      let tempGraphics = this.graphics.filter(item => {\n        return !!(item.img || item.txt)\n      })\n      for (let i = 0; i < tempGraphics.length; i++) {\n        if (!tempGraphics[i].img) {\n          dialogService.alert(`图文中第${i + 1}项的图片还未上传`)\n          return false\n        }\n        if (!tempGraphics[i].txt) {\n          dialogService.alert(`图文中第${i + 1}项的文本还未填写`)\n          return false\n        }\n      }\n      // 如果没有任何图文\n      if (!tempGraphics.length) {\n        dialogService.alert(`您还没有填写任何图文内容`)\n        return false\n      }\n      // 总脉宝数\n      if (!this.myAD.maibao_num) {\n        dialogService.alert(`您还没有填写本次推广的总脉宝数`)\n        return false\n      }\n      // 总脉宝数至少300\n      if (parseInt(this.myAD.maibao_num) < 300) {\n        dialogService.alert(`推广脉宝总数最少不能少于300`)\n        return false\n      }\n      // 单次花费的脉宝数\n      if (!this.myAD.maibao_num) {\n        dialogService.alert(`您还没有填写单次分享广告的脉宝奖励`)\n        return false\n      }\n      if (this.myAD.maibao_num % this.myAD.maibao_num !== 0) {\n        dialogService.alert(`每次分享脉宝个数分配不均！请重新分配`)\n        return false\n      }\n      // 验证标题是否填写\n      if (!this.myAD.title) {\n        dialogService.alert(`广告标题还未填写`)\n        return false\n      }\n      this.$set(this.myAD, 'cover', tempGraphics[0].img)\n      this.$set(this.myAD, 'content', JSON.stringify(tempGraphics))\n      return true\n    }\n  },\n  components: {\n    Wrapper,\n    SlideShow\n  },\n  computed: {\n    ...mapState({\n      user: state => state.user.userInfo,\n      spreadAD: state => state.spread.spreadAD,\n      platform: state => state.system.platform\n    }),\n    paddingTop: function() {\n      return this.platform === 'wechat' ? '0px' : '100px'\n    }\n  },\n  beforeRouteLeave(to, from, next) {\n    let isEdit = false\n    for (let key in this.myAD) {\n      if (key !== 'card_id') {\n        if (key === 'content') {\n          if (this.myAD[key] !== '[]' && this.myAD[key] !== '') {\n            isEdit = true\n            break\n          }\n        } else if (this.myAD[key]) {\n          isEdit = true\n          break\n        }\n      }\n    }\n    const confirmLeave = () => {\n      dialogService.confirm('您还没保存，确定要离开？', function(val) {\n        if (val) next()\n      })\n    }\n\n    switch (to.path) {\n      // 预览\n      case '/spread/preview':\n        if (!isEdit) {\n          next(false)\n          dialogService.alert('您还没有编辑任何内容!')\n        } else {\n          next()\n        }\n        break\n      // 全民推广首页\n      case '/spread/index':\n        // 判断是否为返回\n        if (isEdit) {\n          next(false)\n          confirmLeave()\n        } else {\n          next()\n        }\n        break\n      // 脉宝充值\n      case '/user/veinCoin/recharge':\n        this._saveTemp()\n        next()\n        break\n      // 图片裁剪\n      case '/cropper':\n        next()\n        break\n      default:\n        if (isEdit && !this.isSave) {\n          next(false)\n          confirmLeave()\n        } else {\n          next()\n        }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.spread-ad {\n  width: 100%;\n  overflow: hidden;\n  min-height: 100vh;\n  position: relative;\n  background: #1b1b1b;\n}\nh3 {\n  font-size: 32px;\n  color: #d5d5d5;\n  margin-top: 48px;\n  margin-left: 20px;\n  font-family: 'PingFang SC Bold';\n}\n\n.tip {\n  font-size: 22px;\n  margin-top: 16px;\n  color: #bcbcbc;\n  text-align: right;\n  line-height: 24px;\n  margin-right: 20px;\n  font-family: 'PingFang SC Medium';\n  &::before {\n    clear: both;\n    content: '';\n  }\n}\n.spread-imgs {\n  height: 732px;\n}\n.my-coin,\n.row,\n.spread-title,\n.marketing,\n.spread-page,\n.spread-area,\n.spread-card {\n  height: 40px;\n  font-size: 28px;\n  margin-top: 52px;\n  line-height: 40px;\n  margin-left: 20px;\n  color: rgb(194, 194, 194);\n  font-size: 'PingFang SC Medium';\n  .iconfont {\n    float: left;\n    width: 40px;\n    height: 40px;\n    margin-right: 20px;\n    border-radius: 50%;\n    background-size: cover;\n    background-image: url('/static/coin.png');\n  }\n  .coin-charge {\n    width: 116px;\n    height: 40px;\n    font-size: 26px;\n    text-align: center;\n    border-radius: 4px;\n    display: inline-block;\n    background: #299cff;\n    color: rgb(252, 252, 252);\n  }\n}\n.row {\n  height: 50px;\n  line-height: 50px;\n  margin-top: 33px;\n  label {\n    width: 198px;\n    float: left;\n    line-height: 50px;\n    white-space: nowrap;\n  }\n  input {\n    float: left;\n    width: 126px;\n    height: 50px;\n    outline: none;\n    color: #fff;\n    display: block;\n    text-align: center;\n    border-radius: 4px;\n    background: #393939;\n    border: none;\n  }\n  small {\n    float: right;\n    font-size: 24px;\n    margin-right: 20px;\n  }\n}\n.spread-title {\n  height: 160px;\n  margin-top: 35px;\n  label {\n    float: left;\n    margin-top: 10px;\n  }\n  textarea {\n    width: 628px;\n    height: 60px;\n    resize: none;\n    border: none;\n    padding: 10px;\n    outline: none;\n    display: block;\n    font-size: 28px;\n    color: #cccccc;\n    border-radius: 8px;\n    background: #393939;\n    box-sizing: border-box;\n    font-size: 'PingFang SC Medium';\n  }\n}\n.marketing {\n  .chosePage {\n    color: rgb(41, 156, 255);\n  }\n}\n.spread-page {\n  height: 110px;\n  position: relative;\n  border-radius: 6px;\n  background: #393939;\n  box-sizing: border-box;\n  padding: 16px 20px 16px;\n  .marketing-title {\n    font-size: 28px;\n    color: #cccccc;\n    line-height: 28px;\n    font-family: 'PingFang SC Medium';\n  }\n  .marketing-date {\n    font-size: 24px;\n    color: #cccccc;\n    line-height: 24px;\n    margin: 20px 0 4px;\n    font-family: 'PingFang SC Medium';\n  }\n  .delete {\n    right: 0;\n    top: 35px;\n    font-size: 36px;\n    position: absolute;\n    background: transparent;\n  }\n}\n.spread-area {\n  height: 50px;\n  margin-top: 50px;\n  line-height: 50px;\n  label {\n    float: left;\n  }\n  .area {\n    float: left;\n    width: 180px;\n    height: 50px;\n    display: block;\n    line-height: 46px;\n    text-align: center;\n    border-radius: 4px;\n    color: rgb(78, 173, 255);\n    border: 2px solid rgb(78, 173, 255);\n  }\n}\n.spread-card {\n  height: 40px;\n  margin-top: 40px;\n  margin-bottom: 176px;\n  span {\n    margin-right: 60px;\n    display: inline-block;\n    &::before {\n      float: left;\n      content: '';\n      width: 40px;\n      height: 40px;\n      display: block;\n      margin-right: 20px;\n      border-radius: 50%;\n      background: #393939;\n    }\n    &.active {\n      &::before {\n        background: #299cff;\n        font-family: 'iconfont';\n        text-align: center;\n        content: '\\E660';\n        font-size: 36px;\n        color: #fff;\n      }\n    }\n  }\n}\n.spread-foot {\n  bottom: 0;\n  width: 100%;\n  height: 96px;\n  position: fixed;\n  font-size: 30px;\n  line-height: 96px;\n  border-top: 2px solid #373737;\n  font-family: 'PingFang SC Medium';\n  a {\n    float: left;\n    width: 250px;\n    display: block;\n    text-align: center;\n    background: #0d0d0d;\n    box-sizing: border-box;\n    color: rgb(194, 194, 194);\n  }\n  .hasborder {\n    border-left: 2px solid #373737;\n    border-right: 2px solid #373737;\n  }\n  .publish {\n    color: #4eadff;\n  }\n}\n.marketing-cover {\n  top: 0;\n  left: 0;\n  width: 100%;\n  z-index: -1;\n  height: 100%;\n  position: fixed;\n  &.show {\n    z-index: 1;\n  }\n}\n.marketing-wrapper {\n  bottom: 0;\n  width: 100%;\n  height: 0px;\n  display: flex;\n  overflow: hidden;\n  position: absolute;\n  background: #f2f2f2;\n  flex-direction: column;\n  transition: all 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28);\n  &.show {\n    height: 604px;\n  }\n  .marketing-header {\n    height: 88px;\n    display: flex;\n    padding: 0 30px;\n    font-size: 28px;\n    line-height: 88px;\n    background: #fff;\n    box-sizing: border-box;\n    justify-content: space-between;\n    font-family: 'PingFang SC Medium';\n  }\n  .title {\n    font-size: 30px;\n  }\n  .submit {\n    color: #299cff;\n  }\n  .marketing-container {\n    flex: 1;\n    overflow: auto;\n    -webkit-overflow-scrolling: touch;\n  }\n  .marketing-item {\n    width: 690px;\n    height: 110px;\n    padding: 20px;\n    position: relative;\n    border-radius: 6px;\n    background: #fff;\n    margin: 20px auto 0;\n    box-sizing: border-box;\n    box-shadow: 0 0 2px 2px rgba(0, 0, 0, 0.1);\n    .marketing-title {\n      font-size: 28px;\n      line-height: 28px;\n      color: rgb(17, 17, 17);\n      font-family: 'PingFang SC Medium';\n    }\n    .marketing-date {\n      font-size: 24px;\n      line-height: 24px;\n      margin: 20px 0 4px;\n      color: rgb(17, 17, 17);\n      font-family: 'PingFang SC Medium';\n    }\n    span {\n      right: 0;\n      top: 35px;\n      position: absolute;\n      &::before {\n        float: left;\n        content: '';\n        width: 40px;\n        height: 40px;\n        display: block;\n        margin-right: 20px;\n        border-radius: 50%;\n        background: #dcdcdc;\n      }\n      &.active {\n        &::before {\n          background: #299cff;\n          font-family: 'iconfont';\n          text-align: center;\n          content: '\\E660';\n          font-size: 36px;\n          color: #fff;\n        }\n      }\n    }\n  }\n}\n</style>\n"],"sourceRoot":"src/module/spread/create"}]}
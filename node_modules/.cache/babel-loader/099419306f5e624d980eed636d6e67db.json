{"remainingRequest":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/thread-loader/dist/cjs.js!/Users/qiang/work/hytx/hytx-rebuild/node_modules/babel-loader/lib/index.js!/Users/qiang/work/hytx/hytx-rebuild/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/qiang/work/hytx/hytx-rebuild/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/qiang/work/hytx/hytx-rebuild/src/module/spread/manger/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/qiang/work/hytx/hytx-rebuild/src/module/spread/manger/index.vue","mtime":1546400167097},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/qiang/work/hytx/hytx-rebuild/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"/Users/qiang/work/hytx/hytx-rebuild/node_modules/@babel/runtime/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport spread from '../../../api/spread';\nimport { mapState, mapActions } from 'vuex';\nimport dialogService from '../../../service/dialogService';\nexport default {\n  name: 'spreadManger',\n  data: function data() {\n    return {\n      page: 1,\n      list: [],\n      allPage: null,\n      loading: false\n    };\n  },\n  beforeMount: function beforeMount() {\n    this.init();\n  },\n  mounted: function mounted() {\n    window.addEventListener('scroll', this.loadMore, false);\n  },\n  destroyed: function destroyed() {\n    window.removeEventListener('scroll', this.loadMore, false);\n  },\n  methods: _objectSpread({}, mapActions(['spread/updateSpreadAD', 'spread/updateEditSpread']), {\n    init: function () {\n      var _init = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee() {\n        var res;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return spread.getPublishList(1);\n\n              case 3:\n                res = _context.sent;\n\n                if (!(res.status !== 0)) {\n                  _context.next = 6;\n                  break;\n                }\n\n                throw new Error(res.message);\n\n              case 6:\n                this.list = res.data.data;\n                this.page = res.data.current_page;\n                this.allPage = Math.ceil(res.data.total / res.data.per_page);\n                _context.next = 14;\n                break;\n\n              case 11:\n                _context.prev = 11;\n                _context.t0 = _context[\"catch\"](0);\n                dialogService.alert(_context.t0.message);\n\n              case 14:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[0, 11]]);\n      }));\n\n      function init() {\n        return _init.apply(this, arguments);\n      }\n\n      return init;\n    }(),\n    loadMore: function () {\n      var _loadMore = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2() {\n        var res;\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!this.loading) {\n                  _context2.next = 2;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\");\n\n              case 2:\n                if (!(this.page === this.allPage || !this.allPage)) {\n                  _context2.next = 4;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\");\n\n              case 4:\n                _context2.prev = 4;\n                this.loading = true;\n                _context2.next = 8;\n                return spread.getPublishList(this.page + 1);\n\n              case 8:\n                res = _context2.sent;\n\n                if (!(res.status !== 0)) {\n                  _context2.next = 11;\n                  break;\n                }\n\n                throw new Error(res.message);\n\n              case 11:\n                this.loading = false;\n                this.page = res.data.current_page;\n                this.list = this.list.concat(res.data.data);\n                _context2.next = 19;\n                break;\n\n              case 16:\n                _context2.prev = 16;\n                _context2.t0 = _context2[\"catch\"](4);\n                dialogService.alert(_context2.t0.message);\n\n              case 19:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[4, 16]]);\n      }));\n\n      function loadMore() {\n        return _loadMore.apply(this, arguments);\n      }\n\n      return loadMore;\n    }(),\n    // 广告预览\n    goDetail: function goDetail(index) {\n      this['spread/updateSpreadAD'](this.list[index]);\n      this.$router.push({\n        path: '/spread/detail'\n      });\n    },\n    // 删除广告\n    deleteAD: function deleteAD(index) {\n      var _this = this;\n\n      try {\n        var _self = this;\n\n        this.$createDialog({\n          title: '提示',\n          type: 'confirm',\n          icon: 'icon-tips-alert',\n          content: '你确定要删除!?',\n          onConfirm: function () {\n            var _onConfirm = _asyncToGenerator(\n            /*#__PURE__*/\n            regeneratorRuntime.mark(function _callee3() {\n              var res;\n              return regeneratorRuntime.wrap(function _callee3$(_context3) {\n                while (1) {\n                  switch (_context3.prev = _context3.next) {\n                    case 0:\n                      _context3.next = 2;\n                      return spread.deleteAD(_this.list[index].id);\n\n                    case 2:\n                      res = _context3.sent;\n\n                      if (!(res.status !== 0)) {\n                        _context3.next = 5;\n                        break;\n                      }\n\n                      throw new Error(err.message);\n\n                    case 5:\n                      dialogService.alert('删除成功', function () {\n                        _self.list.splice(index, 1);\n                      });\n\n                    case 6:\n                    case \"end\":\n                      return _context3.stop();\n                  }\n                }\n              }, _callee3, this);\n            }));\n\n            function onConfirm() {\n              return _onConfirm.apply(this, arguments);\n            }\n\n            return onConfirm;\n          }()\n        }).show();\n      } catch (err) {\n        dialogService.alert(err.message);\n      }\n    },\n    // 编辑广告\n    edit: function edit(index) {\n      this['spread/updateEditSpread'](this.list[index]);\n      this.$router.push({\n        path: \"/spread/edit\"\n      });\n    },\n    // 下架广告\n    down: function () {\n      var _down = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee4(index) {\n        var _self, newAD, res;\n\n        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.prev = 0;\n                _self = this;\n                newAD = JSON.parse(JSON.stringify(this.list[index]));\n                newAD.status = 3;\n                _context4.next = 6;\n                return spread.editAD(this.list[index].id, newAD);\n\n              case 6:\n                res = _context4.sent;\n\n                if (!(res.status !== 0)) {\n                  _context4.next = 9;\n                  break;\n                }\n\n                throw new Error(res.message);\n\n              case 9:\n                dialogService.alert('操作成功', function () {\n                  _self.$set(_self.list[index], 'status', 3);\n                });\n                _context4.next = 15;\n                break;\n\n              case 12:\n                _context4.prev = 12;\n                _context4.t0 = _context4[\"catch\"](0);\n                dialogService.alert(_context4.t0.message);\n\n              case 15:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this, [[0, 12]]);\n      }));\n\n      function down(_x) {\n        return _down.apply(this, arguments);\n      }\n\n      return down;\n    }(),\n    // 发布广告\n    publish: function () {\n      var _publish = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee5(index) {\n        var _self, newAD, res;\n\n        return regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _self = this;\n                _context5.prev = 1;\n                newAD = JSON.parse(JSON.stringify(this.list[index]));\n                newAD.status = 0;\n                _context5.next = 6;\n                return spread.editAD(this.list[index].id, newAD);\n\n              case 6:\n                res = _context5.sent;\n\n                if (!(res.status !== 0)) {\n                  _context5.next = 9;\n                  break;\n                }\n\n                throw new Error(res.message);\n\n              case 9:\n                dialogService.alert('操作成功', function () {\n                  _self.$set(_self.list[index], 'status', 0);\n                });\n                _context5.next = 15;\n                break;\n\n              case 12:\n                _context5.prev = 12;\n                _context5.t0 = _context5[\"catch\"](1);\n                this.$createDialog({\n                  title: '提示',\n                  type: 'confirm',\n                  icon: 'icon-tips-alert',\n                  content: '脉宝余额不足,去充值!',\n                  onConfirm: function onConfirm() {\n                    _self.$router.push({\n                      path: '/user/veinCoin/recharge'\n                    });\n                  }\n                }).show();\n\n              case 15:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this, [[1, 12]]);\n      }));\n\n      function publish(_x2) {\n        return _publish.apply(this, arguments);\n      }\n\n      return publish;\n    }()\n  }),\n  filters: {\n    statusText: function statusText(input) {\n      switch (input) {\n        case 0:\n          return '待审核';\n\n        case 1:\n          return '未通过';\n\n        case 2:\n          return '已上架';\n\n        case 3:\n          return '已下架';\n\n        case 4:\n          return '保存';\n      }\n    }\n  },\n  watch: {\n    $route: function $route(to, from) {\n      if (/^\\/spread\\/edit/.test(from.path)) {\n        this.init();\n      }\n    }\n  }\n};",{"version":3,"sources":["index.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"spread-manger\" :class=\"{'white': !list.length}\">\n    <div class=\"none\">\n      <img v-if=\"!list.length\" src=\"./none.jpg\" style=\"width: 100%;\" alt=\"\">\n    </div>\n    <div class=\"ad-item\" v-for=\"(item, index) in list\" :key=\"index\">\n      <div class=\"ad-date\">\n        <p>\n          <span>{{item.created_at | timeFormt('YYYY-MM-DD')}}</span>\n          <!-- 未通过(1)、已下架(3)、保存状态(4)可删除 -->\n          <span class=\"iconfont icon-cha\" v-if=\"item.status === 1 || item.status === 3 || item.status === 4\" @click=\"deleteAD(index)\"></span>\n        </p>\n      </div>\n      <div class=\"ad-dateil\" @click=\"goDetail(index)\">\n        <div class=\"ad-poster\" :style=\"{'background-image': 'url('+item.cover+')'}\">\n        </div>\n        <div class=\"ad-title\" v-text=\"item.title\"></div>\n      </div>\n      <div class=\"ad-info\">\n        <p>脉宝发布总数: <span v-text=\"item.maibao_num\"></span></p>\n        <p>脉宝当前剩余: <span v-text=\"item.maibao_num_surplus || item.maibao_num\"></span></p>\n        <p>发布状态: <span :class=\"'status_'+item.status\">{{item.status | statusText}}</span><span class=\"remark status_1\" v-text=\"item.remarks\"></span></p>\n        <!-- 未通过(1)、已下架(3)、保存状态(4)可修改 -->\n        <span class=\"operate\" v-if=\"item.status === 1 || item.status === 3 || item.status === 4\" @click=\"edit(index)\">修改</span>\n        <!-- 保存状态可发布(4) -->\n        <span class=\"operate\" v-if=\"item.status === 4\" @click=\"publish(index)\" style=\"top: 1.4rem;\">发布</span>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport spread from '../../../api/spread'\nimport { mapState, mapActions } from 'vuex'\nimport dialogService from '../../../service/dialogService'\nexport default {\n  name: 'spreadManger',\n  data() {\n    return {\n      page: 1,\n      list: [],\n      allPage: null,\n      loading: false\n    }\n  },\n  beforeMount() {\n    this.init()\n  },\n  mounted() {\n    window.addEventListener('scroll', this.loadMore, false)\n  },\n  destroyed() {\n    window.removeEventListener('scroll', this.loadMore, false)\n  },\n  methods: {\n    ...mapActions(['spread/updateSpreadAD', 'spread/updateEditSpread']),\n    async init() {\n      try {\n        let res = await spread.getPublishList(1)\n        if (res.status !== 0) throw new Error(res.message)\n        this.list = res.data.data\n        this.page = res.data.current_page\n        this.allPage = Math.ceil(res.data.total / res.data.per_page)\n      } catch (err) {\n        dialogService.alert(err.message)\n      }\n    },\n    async loadMore() {\n      if (this.loading) return\n      if (this.page === this.allPage || !this.allPage) return\n      try {\n        this.loading = true\n        let res = await spread.getPublishList(this.page + 1)\n        if (res.status !== 0) throw new Error(res.message)\n        this.loading = false\n        this.page = res.data.current_page\n        this.list = this.list.concat(res.data.data)\n      } catch (err) {\n        dialogService.alert(err.message)\n      }\n    },\n    // 广告预览\n    goDetail(index) {\n      this['spread/updateSpreadAD'](this.list[index])\n      this.$router.push({ path: '/spread/detail' })\n    },\n    // 删除广告\n    deleteAD(index) {\n      try {\n        let _self = this\n        this.$createDialog({\n          title: '提示',\n          type: 'confirm',\n          icon: 'icon-tips-alert',\n          content: '你确定要删除!?',\n          onConfirm: async () => {\n            let res = await spread.deleteAD(this.list[index].id)\n            if (res.status !== 0) throw new Error(err.message)\n            dialogService.alert('删除成功', function() {\n              _self.list.splice(index, 1)\n            })\n          }\n        }).show()\n      } catch (err) {\n        dialogService.alert(err.message)\n      }\n    },\n    // 编辑广告\n    edit(index) {\n      this['spread/updateEditSpread'](this.list[index])\n      this.$router.push({\n        path: `/spread/edit`\n      })\n    },\n    // 下架广告\n    async down(index) {\n      try {\n        let _self = this\n        let newAD = JSON.parse(JSON.stringify(this.list[index]))\n        newAD.status = 3\n        let res = await spread.editAD(this.list[index].id, newAD)\n        if (res.status !== 0) throw new Error(res.message)\n        dialogService.alert('操作成功', function() {\n          _self.$set(_self.list[index], 'status', 3)\n        })\n      } catch (err) {\n        dialogService.alert(err.message)\n      }\n    },\n    // 发布广告\n    async publish(index) {\n      let _self = this\n      try {\n        let newAD = JSON.parse(JSON.stringify(this.list[index]))\n        newAD.status = 0\n        let res = await spread.editAD(this.list[index].id, newAD)\n        if (res.status !== 0) throw new Error(res.message)\n        dialogService.alert('操作成功', function() {\n          _self.$set(_self.list[index], 'status', 0)\n        })\n      } catch (err) {\n        this.$createDialog({\n          title: '提示',\n          type: 'confirm',\n          icon: 'icon-tips-alert',\n          content: '脉宝余额不足,去充值!',\n          onConfirm: () => {\n            _self.$router.push({\n              path: '/user/veinCoin/recharge'\n            })\n          }\n        }).show()\n      }\n    }\n  },\n  filters: {\n    statusText: function(input) {\n      switch (input) {\n        case 0:\n          return '待审核'\n        case 1:\n          return '未通过'\n        case 2:\n          return '已上架'\n        case 3:\n          return '已下架'\n        case 4:\n          return '保存'\n      }\n    }\n  },\n  watch: {\n    $route(to, from) {\n      if (/^\\/spread\\/edit/.test(from.path)) {\n        this.init()\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.spread-manger {\n  width: 100%;\n  overflow: hidden;\n  min-height: 100vh;\n  background: #f2f2f2;\n  &.white {\n    background: #fff;\n  }\n}\n.ad-item {\n  width: 100%;\n  height: 460px;\n  padding: 30px;\n  overflow: hidden;\n  margin-top: 30px;\n  background: #fff;\n  box-sizing: border-box;\n}\n.ad-date {\n  width: 100%;\n  font-size: 28px;\n  color: #333333;\n  line-height: 28px;\n  margin-bottom: 30px;\n  font-family: 'PingFang SC Medium';\n  .iconfont {\n    float: right;\n  }\n}\n.ad-dateil,\n.ad-info {\n  width: 626px;\n  height: 188px;\n  margin: 0 auto;\n  overflow: hidden;\n  position: relative;\n  background: #f5f5f5;\n  box-sizing: border-box;\n  padding: 20px 30px 20px 20px;\n  .ad-poster {\n    float: left;\n    width: 114px;\n    height: 150px;\n    margin-right: 30px;\n    border-radius: 4px;\n    background-size: cover;\n    background-position: center;\n  }\n  /* img {\n    width: 100%;\n  } */\n  .ad-title {\n    float: left;\n    width: 414px;\n    height: 150px;\n    font-size: 28px;\n    overflow: hidden;\n    line-height: 48px;\n    padding-top: 34px;\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    box-sizing: border-box;\n    -webkit-box-orient: vertical;\n    font-family: 'PingFang SC Medium';\n  }\n}\n.ad-info {\n  padding: 0;\n  height: unset;\n  font-size: 24px;\n  overflow: hidden;\n  color: #333333;\n  background: #fff;\n  box-sizing: border-box;\n  font-family: 'PingFang SC Medium';\n  p {\n    margin-top: 30px;\n  }\n  .status_0,\n  .status_2,\n  .status_4 {\n    color: #299cff;\n  }\n  .status_1 {\n    color: #ff2d2d;\n  }\n  .status_3 {\n    color: #999999;\n  }\n  .operate {\n    right: 0;\n    top: 45px;\n    width: 106px;\n    height: 48px;\n    color: #299cff;\n    line-height: 48px;\n    position: absolute;\n    text-align: center;\n    border-radius: 24px;\n    box-sizing: border-box;\n    border: 2px solid #299cff;\n  }\n  .remark {\n    float: right;\n  }\n}\n</style>\n"],"sourceRoot":"src/module/spread/manger"}]}
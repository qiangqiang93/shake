{"remainingRequest":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/thread-loader/dist/cjs.js!/Users/qiang/work/hytx/hytx-rebuild/node_modules/babel-loader/lib/index.js!/Users/qiang/work/hytx/hytx-rebuild/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/qiang/work/hytx/hytx-rebuild/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/qiang/work/hytx/hytx-rebuild/src/module/card/edit/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/qiang/work/hytx/hytx-rebuild/src/module/card/edit/index.vue","mtime":1548810537498},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _regeneratorRuntime from \"/Users/qiang/work/hytx/hytx-rebuild/node_modules/@babel/runtime/regenerator\";\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapActions, mapState } from 'vuex';\nimport Area from './area.json';\nimport styles from './styles.json';\nimport user from '../../../api/user';\nimport card from '../../../api/card';\nimport eventBus from '../../../utils/eventBus';\nimport validate from '../../../utils/validate';\nimport dialogService from '../../../service/dialogService';\nimport Textarea from '../../../components/Textarea';\nimport Card from '../../../components/Card';\nimport Pickers from '../../../components/Pickers';\nimport Wrapper from '../../../components/Wrapper';\nimport AppUploadImg from '../../../components/AppUploadImg';\nimport AppHeader from '../../../components/AppHeader';\nimport AppLoading from '../../../components/AppLoading';\nexport default {\n  name: 'cardEdit',\n  data: function data() {\n    return {\n      firstIn: true,\n      //是否第一次进\n      Area: Area,\n      // 全部地区\n      profile: {},\n      // 名片信息\n      defaultArea: [],\n      // 默认选择的地区\n      paddingTop: null,\n      // paddingTop\n      photos: [],\n      // 相册\n      styles: styles,\n      // 名片样式\n      stylesWrapper: null // 名片样式列表长度\n\n    };\n  },\n  mounted: function mounted() {\n    var _self = this;\n\n    this.getProfile();\n    this.paddingTop = this.platform === 'wechat' ? '0px' : '80px';\n    this.stylesWrapper = {\n      width: this.styles.length * 200 + 'px'\n    };\n  },\n  methods: _objectSpread({}, mapActions(['user/setUserInfo', 'system/updateRouter', 'system/updateCropper']), {\n    // 获取名片信息\n    getProfile: function () {\n      var _getProfile = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        var res, profile;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return user.getDetailInfo();\n\n              case 3:\n                res = _context.sent;\n\n                if (!(res.status !== 0)) {\n                  _context.next = 6;\n                  break;\n                }\n\n                throw new Error(res.message);\n\n              case 6:\n                profile = res.data;\n\n                if (profile.province) {\n                  this.defaultArea = [profile.province, profile.city, profile.area];\n                }\n\n                profile.user_name = profile.user_name || this.user.name;\n                profile.introduce = profile.introduce || '';\n                profile.logo = profile.logo || this.user.portrait;\n                profile.address = profile.address || '';\n                this.profile = profile;\n                this.firstIn = false;\n                _context.prev = 14;\n\n                if (!(profile.album === null)) {\n                  _context.next = 17;\n                  break;\n                }\n\n                throw new Error('empty album');\n\n              case 17:\n                this.photos = JSON.parse(profile.album);\n                _context.next = 23;\n                break;\n\n              case 20:\n                _context.prev = 20;\n                _context.t0 = _context[\"catch\"](14);\n                this.photos = [];\n\n              case 23:\n                _context.next = 29;\n                break;\n\n              case 25:\n                _context.prev = 25;\n                _context.t1 = _context[\"catch\"](0);\n                this.firstIn = false;\n                dialogService.alert(_context.t1.message);\n\n              case 29:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[0, 25], [14, 20]]);\n      }));\n\n      function getProfile() {\n        return _getProfile.apply(this, arguments);\n      }\n\n      return getProfile;\n    }(),\n    // 选择名片样式\n    selectStyles: function selectStyles(style) {\n      if (style === this.profile.style) return;\n      this.$set(this.profile, 'style', style);\n    },\n    // 错误提示\n    showToastTime: function showToastTime(text) {\n      dialogService.toast(text);\n    },\n    // 上传\n    upload: function upload(type, path) {\n      switch (type) {\n        case 'logo':\n          this.$set(this.profile, 'logo', path);\n          break;\n\n        case 'photos':\n          this.$set(this.photos, this.photos.length, path);\n          break;\n\n        default: // nothing\n\n      }\n    },\n    // 删除相册图片\n    deletePhoto: function deletePhoto(index) {\n      this.photos.splice(index, 1);\n    },\n    // 保存名片信息\n    setProfile: function () {\n      var _setProfile = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2() {\n        var _self, phoneValidate, res;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _self = this;\n\n                if (this.profile.user_name) {\n                  _context2.next = 4;\n                  break;\n                }\n\n                dialogService.alert('姓名不能为空');\n                return _context2.abrupt(\"return\", false);\n\n              case 4:\n                phoneValidate = validate.phone(this.profile.mobile_phone);\n\n                if (phoneValidate.status) {\n                  _context2.next = 8;\n                  break;\n                }\n\n                dialogService.alert(phoneValidate.msg);\n                return _context2.abrupt(\"return\", false);\n\n              case 8:\n                if (this.profile.company) {\n                  _context2.next = 11;\n                  break;\n                }\n\n                dialogService.alert('公司名称不能为空');\n                return _context2.abrupt(\"return\", false);\n\n              case 11:\n                if (this.profile.profession) {\n                  _context2.next = 14;\n                  break;\n                }\n\n                dialogService.alert('职位不能为空');\n                return _context2.abrupt(\"return\", false);\n\n              case 14:\n                this.profile.province = this.defaultArea[0];\n                this.profile.city = this.defaultArea[1];\n                this.profile.area = this.defaultArea[2]; // this.profile.introduce = this.$refs.textarea.innerHTML\n\n                this.profile.album = JSON.stringify(this.photos);\n                _context2.prev = 18;\n                _context2.next = 21;\n                return card.saveCardInfo(this.profile);\n\n              case 21:\n                res = _context2.sent;\n\n                if (!(res.status !== 0)) {\n                  _context2.next = 24;\n                  break;\n                }\n\n                throw new Error(res.message);\n\n              case 24:\n                this.$router.back();\n                user.getProfile();\n                _context2.next = 31;\n                break;\n\n              case 28:\n                _context2.prev = 28;\n                _context2.t0 = _context2[\"catch\"](18);\n                dialogService.alert(_context2.t0.message);\n\n              case 31:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[18, 28]]);\n      }));\n\n      function setProfile() {\n        return _setProfile.apply(this, arguments);\n      }\n\n      return setProfile;\n    }()\n  }),\n  components: {\n    Card: Card,\n    Wrapper: Wrapper,\n    Pickers: Pickers,\n    Textarea: Textarea,\n    AppUploadImg: AppUploadImg,\n    AppHeader: AppHeader,\n    AppLoading: AppLoading\n  },\n  computed: _objectSpread({}, mapState({\n    user: function user(state) {\n      return state.user.userInfo;\n    },\n    platform: function platform(state) {\n      return state.system.platform;\n    }\n  }))\n};",{"version":3,"sources":["index.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <Wrapper :paddingTop=\"paddingTop\" class=\"card-wrapper\">\n    <AppHeader ref=\"header\" title=\"编辑名片\" iconColor=\"#fff\" fontColor=\"#fff\" background=\"#374ff3\"></AppHeader>\n    <AppLoading v-if=\"firstIn\"></AppLoading>\n    <div class=\"card-container\">\n      <!-- 名片预览 -->\n      <Card class=\"card-preview\" :item=\"profile\" edit=\"true\" @upload=\"upload('logo', $event)\"></Card>\n      <!-- 名片样式列表 -->\n      <div class=\"card-styles\">\n        <div class=\"styles-wrapper\" :style=\"stylesWrapper\">\n          <div class=\"style-item\" v-for=\"(item, index) in styles\" :key=\"index\" @click=\"selectStyles(item.id)\">\n            <div class=\"styles-cover\" :class=\"{'show': (profile.style === item.id)}\">\n              <span class=\"iconfont icon-success\"></span>\n            </div>\n            <img :src=\"item.poster\" alt=\"\" class=\"img\">\n          </div>\n        </div>\n      </div>\n      <!-- 基本信息 -->\n      <div class=\"card-info\">\n        <p class=\"card-title\">名片信息<span class=\"require\">＊为必填项</span></p>\n        <div class=\"base-info\">\n          <div class=\"base-info-row\">\n            <label for=\"\" class=\"require\">姓名:</label>\n            <input type=\"text\" v-model=\"profile.user_name\" maxlength=\"10\" class=\"input\">\n            <i class=\"icon-gantan1 iconfont\" v-if=\"!profile.user_name\" @click=\"showToastTime('姓名必须填写')\"></i>\n          </div>\n          <div class=\"base-info-row\">\n            <label for=\"\" class=\"require\">手机:</label>\n            <input type=\"text\" v-model=\"profile.mobile_phone\" class=\"input\">\n            <i class=\"icon-gantan1 iconfont\" v-if=\"!profile.mobile_phone\" @click=\"showToastTime('手机号必须填写')\"></i>\n          </div>\n          <div class=\"base-info-row\">\n            <label for=\"\" class=\"require\">公司:</label>\n            <input type=\"text\" v-model=\"profile.company\" class=\"input\" placeholder=\"请输入您的公司\">\n            <i class=\"icon-gantan1 iconfont\" v-if=\"!profile.company\" @click=\"showToastTime('公司必须填写')\"></i>\n          </div>\n          <div class=\"base-info-row\">\n            <label for=\"\" class=\"require\">职位:</label>\n            <input type=\"text\" v-model=\"profile.profession\" class=\"input\" placeholder=\"请输您的职业\">\n            <i class=\"icon-gantan1 iconfont\" v-if=\"!profile.profession\" @click=\"showToastTime('职业必须填写')\"></i>\n          </div>\n          <div class=\"base-info-row\">\n            <label for=\"\">微信:</label>\n            <input type=\"text\" v-model=\"profile.wechat_code\" class=\"input\" placeholder=\"请输入微信号\">\n          </div>\n          <div class=\"base-info-row\">\n            <label for=\"\">城市:</label>\n            <Pickers class=\"input area-picker\" :data=\"Area\" :msg=\"profile.address || '请选择地区'\" v-model=\"defaultArea\"></Pickers>\n          </div>\n          <div class=\"base-info-row\">\n            <label for=\"\">地址:</label>\n            <input type=\"text\" v-model=\"profile.address_detail\" class=\"input\" placeholder=\"请输您的详细地址\">\n          </div>\n        </div>\n      </div>\n      <!-- 个人简介 -->\n      <div class=\"cut-line\"></div>\n      <div class=\"profile\">\n        <p class=\"profile-title\">个人简介<span class=\"profile-title-desc\">(限140字)</span></p>\n        <!-- <div class=\"profile-textarea\"  v-html=\"profile.introduce\" contenteditable=\"true\" ref=\"textarea\"></div> -->\n        <Textarea class=\"profile-textarea\" :maxlength=\"140\" :canEdit=\"true\" placeholder=\"个人性格描述，让陌生客户更多的了解你\" v-model=\"profile.introduce\"></Textarea>\n      </div>\n      <div class=\"cut-line\"></div>\n      <!-- 名片相册 -->\n      <div class=\"ablum\">\n        <p class=\"profile-title\">相册<span class=\"profile-title-desc\">(最多6张)</span></p>\n        <p class=\"ablum-desc\">上传生活靓照，让陌生客户认识你增加对你的信赖感</p>\n        <div class=\"photos\">\n          <div class=\"photo\" v-for=\"(item,index) in photos\" :key=\"index\">\n            <div class=\"img-box\" :style=\"{'background-image': 'url(' + item + ')'}\">\n            </div>\n            <span class=\"delete\" @click=\"deletePhoto(index)\">×</span>\n          </div>\n          <div class=\"photo\" v-if=\"photos.length !== 6\">\n            <AppUploadImg class=\"upload-photo\" ratio=\"1\" @success=\"upload('photos', $event)\"></AppUploadImg>\n            <div class=\"img-box\">\n              <img class=\"photo-img\" src=\"./addPhoto.png\" alt=\"\">\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div ref=\"footer\" class=\"submit\">\n      <p @click=\"setProfile\">完成</p>\n    </div>\n  </Wrapper>\n</template>\n\n<script type='text/ecmascript-6'>\nimport { mapActions, mapState } from 'vuex'\n\nimport Area from './area.json'\nimport styles from './styles.json'\n\nimport user from '../../../api/user'\nimport card from '../../../api/card'\n\nimport eventBus from '../../../utils/eventBus'\nimport validate from '../../../utils/validate'\n\nimport dialogService from '../../../service/dialogService'\nimport Textarea from '../../../components/Textarea'\nimport Card from '../../../components/Card'\nimport Pickers from '../../../components/Pickers'\nimport Wrapper from '../../../components/Wrapper'\nimport AppUploadImg from '../../../components/AppUploadImg'\nimport AppHeader from '../../../components/AppHeader'\nimport AppLoading from '../../../components/AppLoading'\n\nexport default {\n  name: 'cardEdit',\n  data() {\n    return {\n      firstIn: true, //是否第一次进\n      Area: Area, // 全部地区\n      profile: {}, // 名片信息\n      defaultArea: [], // 默认选择的地区\n      paddingTop: null, // paddingTop\n      photos: [], // 相册\n      styles: styles, // 名片样式\n      stylesWrapper: null // 名片样式列表长度\n    }\n  },\n  mounted() {\n    let _self = this\n    this.getProfile()\n    this.paddingTop = this.platform === 'wechat' ? '0px' : '80px'\n    this.stylesWrapper = { width: this.styles.length * 200 + 'px' }\n  },\n  methods: {\n    ...mapActions([\n      'user/setUserInfo',\n      'system/updateRouter',\n      'system/updateCropper'\n    ]),\n    // 获取名片信息\n    async getProfile() {\n      try {\n        let res = await user.getDetailInfo()\n        if (res.status !== 0) throw new Error(res.message)\n        let profile = res.data\n        if (profile.province) {\n          this.defaultArea = [profile.province, profile.city, profile.area]\n        }\n        profile.user_name = profile.user_name || this.user.name\n        profile.introduce = profile.introduce || ''\n        profile.logo = profile.logo || this.user.portrait\n        profile.address = profile.address || ''\n        this.profile = profile\n        this.firstIn = false\n        try {\n          if (profile.album === null) {\n            throw new Error('empty album')\n          }\n          this.photos = JSON.parse(profile.album)\n        } catch (err) {\n          this.photos = []\n        }\n      } catch (err) {\n        this.firstIn = false\n        dialogService.alert(err.message)\n      }\n    },\n    // 选择名片样式\n    selectStyles(style) {\n      if (style === this.profile.style) return\n      this.$set(this.profile, 'style', style)\n    },\n    // 错误提示\n    showToastTime(text) {\n      dialogService.toast(text)\n    },\n    // 上传\n    upload(type, path) {\n      switch (type) {\n        case 'logo':\n          this.$set(this.profile, 'logo', path)\n          break\n        case 'photos':\n          this.$set(this.photos, this.photos.length, path)\n          break\n        default:\n        // nothing\n      }\n    },\n    // 删除相册图片\n    deletePhoto(index) {\n      this.photos.splice(index, 1)\n    },\n    // 保存名片信息\n    async setProfile() {\n      let _self = this\n      if (!this.profile.user_name) {\n        dialogService.alert('姓名不能为空')\n        return false\n      }\n      let phoneValidate = validate.phone(this.profile.mobile_phone)\n      if (!phoneValidate.status) {\n        dialogService.alert(phoneValidate.msg)\n        return false\n      }\n      if (!this.profile.company) {\n        dialogService.alert('公司名称不能为空')\n        return false\n      }\n      if (!this.profile.profession) {\n        dialogService.alert('职位不能为空')\n        return false\n      }\n      this.profile.province = this.defaultArea[0]\n      this.profile.city = this.defaultArea[1]\n      this.profile.area = this.defaultArea[2]\n      // this.profile.introduce = this.$refs.textarea.innerHTML\n      this.profile.album = JSON.stringify(this.photos)\n      try {\n        let res = await card.saveCardInfo(this.profile)\n        if (res.status !== 0) throw new Error(res.message)\n        this.$router.back()\n        user.getProfile()\n      } catch (err) {\n        dialogService.alert(err.message)\n      }\n    }\n  },\n  components: {\n    Card,\n    Wrapper,\n    Pickers,\n    Textarea,\n    AppUploadImg,\n    AppHeader,\n    AppLoading\n  },\n  computed: {\n    ...mapState({\n      user: state => state.user.userInfo,\n      platform: state => state.system.platform\n    })\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.card-wrapper {\n  padding-bottom: 120px;\n  box-sizing: border-box;\n}\n.card-container {\n  overflow: hidden;\n}\n.card-preview {\n  margin: 30px auto;\n}\n.card-styles {\n  height: 108px;\n  overflow-x: auto;\n  margin: 40px 20px;\n  overflow-y: hidden;\n  -webkit-overflow-scrolling: touch;\n  .styles-wrapper {\n    overflow: hidden;\n  }\n  .style-item {\n    width: 180px;\n    float: left;\n    height: 100px;\n    overflow: hidden;\n    position: relative;\n    margin-right: 20px;\n    border-radius: 4px;\n    box-shadow: 0 1px 1px 1px rgba(110, 110, 110, 0.16);\n  }\n  .styles-cover {\n    z-index: 2;\n    width: 100%;\n    height: 100%;\n    display: none;\n    overflow: hidden;\n    position: absolute;\n    align-items: center;\n    justify-content: center;\n    background: rgba(0, 0, 0, 0.5);\n    &.show {\n      display: flex;\n    }\n  }\n  .icon-success {\n    width: 50px;\n    height: 50px;\n    display: flex;\n    font-size: 80px;\n    color: #2f96ff;\n    background: #fff;\n    border-radius: 50%;\n    align-items: center;\n    justify-content: center;\n  }\n  .img {\n    width: 100%;\n    height: 100%;\n  }\n}\n.card-info {\n  overflow: hidden;\n  .card-title {\n    height: 70px;\n    padding: 0 20px;\n    font-size: 24px;\n    color: #444444;\n    line-height: 70px;\n    background: #f5f5f5;\n    font-family: 'PingFang SC Medium';\n    .require {\n      float: right;\n      font-size: 20px;\n      color: #999999;\n      font-family: 'PingFang SC Regular';\n    }\n  }\n  .base-info {\n    width: 100%;\n    position: relative;\n    margin: 0 auto 20px;\n  }\n  .base-info-row {\n    width: 710px;\n    height: 90px;\n    display: flex;\n    margin: 0 20px;\n    line-height: 90px;\n    position: relative;\n    align-items: center;\n    box-sizing: border-box;\n    border-bottom: 1px solid #f2f2f2;\n  }\n  label {\n    font-size: 30px;\n    padding: 0 20px;\n    color: #0a0a0a;\n    position: relative;\n    font-family: 'PingFang SC Regular';\n    &.require::before {\n      left: -5px;\n      color: #f00;\n      font-size: 24px;\n      content: '\\FF0A';\n      position: absolute;\n    }\n  }\n  .input {\n    flex: 1;\n    padding: 0;\n    height: 89px;\n    outline: none;\n    font-size: 28px;\n    color: #0a0a0a;\n    overflow: hidden;\n    line-height: 90px;\n    margin-left: 20px;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    font-family: 'PingFang SC Medium';\n  }\n  .input::-webkit-input-placeholder {\n    color: rgba(185, 185, 185, 1);\n  }\n  .iconfont {\n    color: #f00;\n    font-size: 30px;\n  }\n}\n.cut-line {\n  width: 100%;\n  height: 20px;\n  overflow: hidden;\n  background: #f5f5f5;\n}\n.profile {\n  width: 100%;\n  height: 300px;\n  overflow: hidden;\n  padding: 20px 24px;\n  box-sizing: border-box;\n  .profile-title {\n    font-size: 30px;\n    color: #0f0f0f;\n    line-height: 48px;\n    padding-left: 24px;\n  }\n  .profile-title-desc {\n    color: #acacac;\n  }\n  .profile-textarea {\n    width: 100%;\n    resize: none;\n    height: 212px;\n    outline: none;\n    overflow: scroll;\n    font-size: 30px;\n    line-height: 48px;\n    margin-left: 24px;\n    padding-right: 20px;\n    box-sizing: border-box;\n    -webkit-user-select: text;\n  }\n}\n.ablum {\n  width: 100%;\n  overflow: hidden;\n  padding: 20px 20px;\n  box-sizing: border-box;\n  .profile-title {\n    color: #0f0f0f;\n    font-size: 30px;\n    line-height: 48px;\n    padding-left: 24px;\n  }\n  .profile-title-desc {\n    color: #acacac;\n  }\n  .ablum-desc {\n    margin: 20px 0;\n    font-size: 24px;\n    color: #acacac;\n    line-height: 32px;\n    padding-left: 24px;\n    font-family: 'PingFang SC Regular';\n  }\n  .photos {\n    width: 100%;\n    margin: 20px 0;\n    overflow: hidden;\n    box-sizing: border-box;\n    padding: 20px 24px 20px 24px;\n  }\n  .photo {\n    float: left;\n    width: 160px;\n    height: 160px;\n    position: relative;\n    margin-right: 91px;\n    border-radius: 4px;\n    margin-bottom: 32px;\n    box-sizing: border-box;\n    &:nth-of-type(3n) {\n      margin-right: 0;\n    }\n  }\n  .img-box {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    overflow: hidden;\n    align-items: center;\n    justify-content: center;\n    background-size: cover;\n    background-position: center;\n  }\n  .delete {\n    top: -20px;\n    width: 40px;\n    right: -20px;\n    height: 40px;\n    color: #fff;\n    display: flex;\n    font-size: 32px;\n    background: red;\n    position: absolute;\n    border-radius: 50%;\n    justify-content: center;\n  }\n  .upload-photo {\n    top: 0;\n    left: 0;\n    z-index: 1;\n    opacity: 0;\n    width: 100%;\n    height: 100%;\n    display: block;\n    position: absolute;\n  }\n}\n.submit {\n  bottom: 0;\n  width: 100%;\n  height: 98px;\n  position: fixed;\n  background-color: #fff;\n  p {\n    width: 710px;\n    height: 80px;\n    color: #fff;\n    margin: 0 auto;\n    font-size: 36px;\n    line-height: 80px;\n    text-align: center;\n    border-radius: 4px;\n    background-color: #374ff3;\n  }\n}\n</style>\n"],"sourceRoot":"src/module/card/edit"}]}
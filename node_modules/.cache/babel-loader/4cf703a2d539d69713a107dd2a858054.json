{"remainingRequest":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/thread-loader/dist/cjs.js!/Users/qiang/work/hytx/hytx-rebuild/node_modules/babel-loader/lib/index.js!/Users/qiang/work/hytx/hytx-rebuild/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/qiang/work/hytx/hytx-rebuild/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/qiang/work/hytx/hytx-rebuild/src/module/circle/match/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/qiang/work/hytx/hytx-rebuild/src/module/circle/match/index.vue","mtime":1548810537513},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _regeneratorRuntime from \"/Users/qiang/work/hytx/hytx-rebuild/node_modules/@babel/runtime/regenerator\";\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { format } from 'date-fns';\nimport { mapState, mapActions } from 'vuex';\nimport card from '../../../api/card';\nimport circle from '../../../api/circle';\nimport webPage from '../../../api/webPage';\nimport Card from '../../../components/Card';\nimport marketing from '../../../api/marketing';\nimport Wrapper from '../../../components/Wrapper';\nimport AppLoading from '../../../components/AppLoading';\nimport sdkService from '../../../service/sdkService';\nimport shareService from '../../../service/shareService';\nimport dialogService from '../../../service/dialogService';\nimport AppHeader from '../../../components/AppHeader';\nimport CustomComponent from '../../../components/CustomComponent';\nimport state from '../../../store/modules/dialog/state';\nexport default {\n  name: 'circleMatch',\n  data: function data() {\n    return {\n      userId: null,\n      // 用户id\n      material: {},\n      // 素材内容\n      userInfo: {},\n      // 匹配的用户信息\n      loading: true,\n      // 是否加载名片信息\n      shareOptions: null,\n      // 分享配置\n      materialType: null // 素材类型[1,文章，2个人微网，3，营销网页，4，个人名片]\n\n    };\n  },\n  mounted: function mounted() {\n    this.userId = this.$route.params.id;\n    this.getMatchInfo();\n  },\n  methods: _objectSpread({}, mapActions(['circle/updateMatchInfo']), {\n    // 获取个人互推信息\n    getMatchInfo: function () {\n      var _getMatchInfo = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        var res, _self, userInfo, shareParams, material;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return circle.getMatchInfoById(this.userId);\n\n              case 3:\n                res = _context.sent;\n\n                if (!(res.status !== 0)) {\n                  _context.next = 6;\n                  break;\n                }\n\n                throw new Error(res.message);\n\n              case 6:\n                _self = this;\n                this.loading = false;\n                userInfo = res.data;\n                this.materialType = res.data.material_style;\n                shareParams = \"created_at=\".concat(format(new Date(), 'YYYY-MM-DD'), \"&interpush_id=\").concat(this.user.id, \"&target_interpush_id=\").concat(res.data.user_id);\n                material = res.data.interPushInfoMaterial;\n                userInfo.user_name = userInfo.user_name || '未命名';\n\n                if (!userInfo.head_picture) {\n                  userInfo.head_picture = '/static/img/default-header.png';\n                }\n\n                this.userInfo = userInfo;\n                _context.t0 = this.materialType;\n                _context.next = _context.t0 === 1 ? 18 : _context.t0 === 2 ? 22 : _context.t0 === 3 ? 27 : _context.t0 === 4 ? 31 : 35;\n                break;\n\n              case 18:\n                this.material = material;\n                this.shareOptions = sdkService.articleConfig(material, this.userId, function () {\n                  _self.shareMatchedInfo();\n                }, shareParams);\n                sdkService.share(this.shareOptions);\n                return _context.abrupt(\"break\", 36);\n\n              case 22:\n                this.shareOptions = sdkService.webPageConfig(material, function () {\n                  _self.shareMatchedInfo();\n                }, shareParams);\n                material.content = JSON.parse(material.content);\n                sdkService.share(this.shareOptions);\n                this.material = material;\n                return _context.abrupt(\"break\", 36);\n\n              case 27:\n                this.shareOptions = sdkService.marketingConfig(material, function () {\n                  _self.shareMatchedInfo();\n                }, shareParams);\n                this.material = JSON.parse(material.contents);\n                sdkService.share(this.shareOptions);\n                return _context.abrupt(\"break\", 36);\n\n              case 31:\n                this.material = material;\n                this.shareOptions = sdkService.cardConfig(material, this.userId, function () {\n                  _self.shareMatchedInfo();\n                }, shareParams);\n                sdkService.share(this.shareOptions);\n                return _context.abrupt(\"break\", 36);\n\n              case 35:\n                this.material = material;\n\n              case 36:\n                this.shareConfig();\n                _context.next = 42;\n                break;\n\n              case 39:\n                _context.prev = 39;\n                _context.t1 = _context[\"catch\"](0);\n                dialogService.alert(_context.t1.message);\n\n              case 42:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[0, 39]]);\n      }));\n\n      function getMatchInfo() {\n        return _getMatchInfo.apply(this, arguments);\n      }\n\n      return getMatchInfo;\n    }(),\n    // 分享配置\n    shareConfig: function shareConfig() {\n      sdkService.share(this.shareOptions);\n    },\n    // 点击分享\n    shareHandler: function shareHandler() {\n      if (!this.matchInfo.today_share_num) return;\n      shareService(this.shareOptions);\n    },\n    // 分享之后写入数据库\n    shareMatchedInfo: function () {\n      var _shareMatchedInfo = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2() {\n        var todayShareNum, res;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.prev = 0;\n                _context2.next = 3;\n                return circle.shareMatchedInfo({\n                  target_user_id: this.userId,\n                  user_id: this.matchInfo.user_id,\n                  target_material_id: this.material.id,\n                  material_id: this.matchInfo.material_id,\n                  target_material_style: this.materialType,\n                  material_style: this.matchInfo.material_style\n                });\n\n              case 3:\n                res = _context2.sent;\n\n                if (!(res.status !== 0)) {\n                  _context2.next = 6;\n                  break;\n                }\n\n                throw new Error(res.message);\n\n              case 6:\n                if (this.matchInfo.today_share_num > 0) {\n                  todayShareNum = this.matchInfo.today_share_num - 1;\n                } else {\n                  todayShareNum = 0;\n                }\n\n                this['circle/updateMatchInfo']({\n                  type: 'update',\n                  data: {\n                    today_share_num: todayShareNum\n                  }\n                });\n                _context2.next = 13;\n                break;\n\n              case 10:\n                _context2.prev = 10;\n                _context2.t0 = _context2[\"catch\"](0);\n                dialogService.alert(_context2.t0.message);\n\n              case 13:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[0, 10]]);\n      }));\n\n      function shareMatchedInfo() {\n        return _shareMatchedInfo.apply(this, arguments);\n      }\n\n      return shareMatchedInfo;\n    }()\n  }),\n  computed: _objectSpread({}, mapState({\n    user: function user(state) {\n      return state.user.userInfo;\n    },\n    platform: function platform(state) {\n      return state.system.platform;\n    },\n    matchInfo: function matchInfo(state) {\n      return state.circle.matchInfo;\n    }\n  }), {\n    paddingTop: function paddingTop() {\n      return this.platform === 'wechat' ? '0px' : '100px';\n    }\n  }),\n  components: {\n    Card: Card,\n    Wrapper: Wrapper,\n    AppLoading: AppLoading,\n    AppHeader: AppHeader,\n    CustomComponent: CustomComponent\n  }\n};",{"version":3,"sources":["index.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <Wrapper class=\"match-wrapper\" :paddingTop=\"paddingTop\">\n    <AppHeader ref=\"header\" title=\"\" iconColor=\"#fff\">\n      <p class=\"raiders-for-app\">\n        <i class=\"iconfont icon-fenxiang\"></i>\n      </p>\n    </AppHeader>\n    <div class=\"match-header\">\n      <router-link tag=\"div\" :to=\"'/card/detail/' + userInfo.user_id\" class=\"base-info\">\n        <div class=\"base-info-head\">\n          <img :src=\"userInfo.head_picture\" alt=\"\" class=\"head-img\">\n        </div>\n        <div class=\"base-info-content\">\n          <p class=\"name\" v-text=\"userInfo.name\"></p>\n          <p class=\"browse\" v-text=\"'为他人带来浏览' + (userInfo.others_browse_num || 0) + '次'\"></p>\n          <p class=\"use-count\" v-text=\"'使用互推圈'+(userInfo.use_num || 0)+'次'\"></p>\n        </div>\n        <div class=\"share-icon\">\n          <i class=\"iconfont icon-iconfontjiantou4\"></i>\n        </div>\n      </router-link>\n    </div>\n    <div class=\"match-title\">\n      <p class=\"big-title\">互推内容</p>\n      <template v-if=\"userInfo.name\">\n        <p class=\"small-title\" v-if=\"materialType === 1\" v-text=\"material.title\"></p>\n        <p class=\"small-title\" v-else-if=\"materialType === 2\" v-text=\"material.title\"></p>\n        <p class=\"small-title\" v-else-if=\"materialType === 3\" v-text=\"material.title\"></p>\n        <!-- <p class=\"small-title\" v-else v-text=\"userInfo.name + '的名片'\"></p> -->\n      </template>\n    </div>\n    <div class=\"material-wrapper\">\n      <!-- 文章 -->\n      <template v-if=\"materialType === 1\">\n        <div class=\"material-article\" v-html=\"material.content\"></div>\n      </template>\n      <!-- 个人微网 -->\n      <template v-else-if=\"materialType === 2\">\n        <div class=\"material-webPage\" :style=\"{'background': '#' + material.background}\">\n          <CustomComponent v-for=\"(item, index) in material.content\" :key=\"index\" :index=\"index\" :item=\"item\" :hots=\"material.popularity\" :canEdit=\"false\" v-show=\"item.isShow\"></CustomComponent>\n        </div>\n      </template>\n      <!-- 营销网页 -->\n      <template v-else-if=\"materialType === 3\">\n        <div class=\"material-marketing\">\n          <div class=\"row\" v-for=\"(item, index) in material.content\" :key=\"index\">\n            <template v-if=\"item.type === 'img'\">\n              <img class=\"img\" :src=\"item.src\" alt=\"\">\n            </template>\n            <template v-else>\n              <pre class=\"text\" v-html=\"item.text\"></pre>\n            </template>\n          </div>\n          <div class=\"contact\" v-if=\"material.contact.name && material.contact.phone\">\n            <p class=\"title\">联系方式</p>\n            <p class=\"contact-info\">\n              <span class=\"name\" v-text=\"material.contact.name\"></span>\n              <a class=\"tel\" :href=\"'tel:' + material.contact.phone\">\n                <span v-text=\"material.contact.phone\"></span>\n                <i class=\"iconfont icon-bodadianhua\"></i>\n              </a>\n            </p>\n          </div>\n          <p style=\"text-align:center\">\n            <a v-if=\"material.superLink.href && material.superLink.btnText\" class=\"superLink\" :href=\"material.superLink.href\" v-text=\"material.superLink.btnText\"></a>\n          </p>\n        </div>\n      </template>\n      <!-- 名片 -->\n      <template v-else>\n        <Card :item=\"material\" class=\"material-card\"></Card>\n      </template>\n    </div>\n    <div ref=\"footer\" class=\"match-footer\" :class=\"{'disabled': !matchInfo.today_share_num}\" @click=\"shareHandler()\">\n      <p v-if=\"matchInfo.today_share_num\">开始互推(今日剩余\n        <span v-text=\"matchInfo.today_share_num\"></span>次)</p>\n      <p v-else>开始互推（今日剩余0次）</p>\n    </div>\n    <AppLoading v-if=\"loading\" visible=\"true\"></AppLoading>\n  </Wrapper>\n</template>\n\n<script>\nimport { format } from 'date-fns'\nimport { mapState, mapActions } from 'vuex'\nimport card from '../../../api/card'\nimport circle from '../../../api/circle'\nimport webPage from '../../../api/webPage'\nimport Card from '../../../components/Card'\nimport marketing from '../../../api/marketing'\nimport Wrapper from '../../../components/Wrapper'\nimport AppLoading from '../../../components/AppLoading'\nimport sdkService from '../../../service/sdkService'\nimport shareService from '../../../service/shareService'\nimport dialogService from '../../../service/dialogService'\nimport AppHeader from '../../../components/AppHeader'\nimport CustomComponent from '../../../components/CustomComponent'\nimport state from '../../../store/modules/dialog/state'\nexport default {\n  name: 'circleMatch',\n  data() {\n    return {\n      userId: null, // 用户id\n      material: {}, // 素材内容\n      userInfo: {}, // 匹配的用户信息\n      loading: true, // 是否加载名片信息\n      shareOptions: null, // 分享配置\n      materialType: null // 素材类型[1,文章，2个人微网，3，营销网页，4，个人名片]\n    }\n  },\n  mounted() {\n    this.userId = this.$route.params.id\n    this.getMatchInfo()\n  },\n  methods: {\n    ...mapActions(['circle/updateMatchInfo']),\n    // 获取个人互推信息\n    async getMatchInfo() {\n      try {\n        let res = await circle.getMatchInfoById(this.userId)\n        if (res.status !== 0) throw new Error(res.message)\n        let _self = this\n        this.loading = false\n        let userInfo = res.data\n        this.materialType = res.data.material_style\n        let shareParams = `created_at=${format(\n          new Date(),\n          'YYYY-MM-DD'\n        )}&interpush_id=${this.user.id}&target_interpush_id=${res.data.user_id}`\n\n        let material = res.data.interPushInfoMaterial\n        userInfo.user_name = userInfo.user_name || '未命名'\n        if (!userInfo.head_picture) {\n          userInfo.head_picture = '/static/img/default-header.png'\n        }\n        this.userInfo = userInfo\n        switch (this.materialType) {\n          case 1:\n            this.material = material\n            this.shareOptions = sdkService.articleConfig(\n              material,\n              this.userId,\n              function() {\n                _self.shareMatchedInfo()\n              },\n              shareParams\n            )\n            sdkService.share(this.shareOptions)\n            break\n          case 2:\n            this.shareOptions = sdkService.webPageConfig(\n              material,\n              function() {\n                _self.shareMatchedInfo()\n              },\n              shareParams\n            )\n            material.content = JSON.parse(material.content)\n            sdkService.share(this.shareOptions)\n            this.material = material\n            break\n          case 3:\n            this.shareOptions = sdkService.marketingConfig(\n              material,\n              function() {\n                _self.shareMatchedInfo()\n              },\n              shareParams\n            )\n            this.material = JSON.parse(material.contents)\n            sdkService.share(this.shareOptions)\n            break\n          case 4:\n            this.material = material\n            this.shareOptions = sdkService.cardConfig(\n              material,\n              this.userId,\n              function() {\n                _self.shareMatchedInfo()\n              },\n              shareParams\n            )\n            sdkService.share(this.shareOptions)\n            break\n          default:\n            this.material = material\n        }\n        this.shareConfig()\n      } catch (err) {\n        dialogService.alert(err.message)\n      }\n    },\n    // 分享配置\n    shareConfig() {\n      sdkService.share(this.shareOptions)\n    },\n    // 点击分享\n    shareHandler() {\n      if (!this.matchInfo.today_share_num) return\n      shareService(this.shareOptions)\n    },\n    // 分享之后写入数据库\n    async shareMatchedInfo() {\n      try {\n        let todayShareNum\n        let res = await circle.shareMatchedInfo({\n          target_user_id: this.userId,\n          user_id: this.matchInfo.user_id,\n          target_material_id: this.material.id,\n          material_id: this.matchInfo.material_id,\n          target_material_style: this.materialType,\n          material_style: this.matchInfo.material_style\n        })\n        if (res.status !== 0) {\n          throw new Error(res.message)\n        }\n        if (this.matchInfo.today_share_num > 0) {\n          todayShareNum = this.matchInfo.today_share_num - 1\n        } else {\n          todayShareNum = 0\n        }\n        this['circle/updateMatchInfo']({\n          type: 'update',\n          data: {\n            today_share_num: todayShareNum\n          }\n        })\n      } catch (err) {\n        dialogService.alert(err.message)\n      }\n    }\n  },\n  computed: {\n    ...mapState({\n      user: state => state.user.userInfo,\n      platform: state => state.system.platform,\n      matchInfo: state => state.circle.matchInfo\n    }),\n    paddingTop: function() {\n      return this.platform === 'wechat' ? '0px' : '100px'\n    }\n  },\n  components: {\n    Card,\n    Wrapper,\n    AppLoading,\n    AppHeader,\n    CustomComponent\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.match-wrapper {\n  position: relative;\n  padding-bottom: 150px;\n}\n.raiders-for-app {\n  right: 30px;\n  color: #fff;\n  padding-left: 30px;\n  position: absolute;\n  .icon-fenxiang {\n    font-size: 32px;\n  }\n}\n.match-header {\n  width: 100%;\n  height: 440px;\n  overflow: hidden;\n  position: relative;\n  background-size: 100%;\n  background-position: top;\n  background-repeat: no-repeat;\n  background-image: url('./headBG.gif');\n}\n.base-info {\n  width: 690px;\n  height: 210px;\n  padding: 40px;\n  display: flex;\n  overflow: hidden;\n  position: relative;\n  background: #fff;\n  border-radius: 10px;\n  margin: 178px auto 0;\n  box-sizing: border-box;\n  box-shadow: 0px 0px 25px 0px rgba(0, 0, 0, 0.1);\n}\n.base-info-head {\n  width: 100px;\n  height: 130px;\n  display: flex;\n  overflow: hidden;\n  align-items: end;\n  margin-right: 24px;\n  .head-img {\n    width: 100px;\n    height: 100px;\n    border-radius: 50px;\n  }\n}\n.base-info-content {\n  flex: 1;\n  display: flex;\n  font-size: 22px;\n  color: #454545;\n  overflow: hidden;\n  white-space: nowrap;\n  flex-direction: column;\n  text-overflow: ellipsis;\n  justify-content: space-between;\n  font-family: 'PingFang SC Medium';\n  .name {\n    font-weight: bold;\n    font-size: 30px;\n    color: #000000;\n    font-family: 'PingFang SC Bold';\n  }\n  .cut-line {\n    margin: 0 20px;\n  }\n}\n.share-icon {\n  top: 80px;\n  right: 30px;\n  color: #454545;\n  position: absolute;\n  .icon-iconfontjiantou4 {\n    font-size: 30px;\n    color: rgb(181, 181, 181);\n  }\n}\n.match-title {\n  width: 100%;\n  /* height: 165px; */\n  padding: 0 30px;\n  overflow: hidden;\n  min-height: 65px;\n  box-sizing: border-box;\n  .big-title {\n    height: 40px;\n    font-size: 34px;\n    margin-bottom: 40px;\n    color: #000000;\n    line-height: 40px;\n    position: relative;\n    padding-left: 30px;\n    font-family: 'PingFang SC Bold';\n    &::before {\n      left: 0;\n      top: 5px;\n      content: '';\n      width: 10px;\n      height: 30px;\n      position: absolute;\n      background: #274ff3;\n    }\n  }\n  .small-title {\n    margin: 20px 0;\n    font-size: 34px;\n    color: #000000;\n    line-height: 1.5;\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    -webkit-box-orient: vertical;\n    font-family: 'PingFang SC Medium';\n  }\n}\n.material-article {\n  zoom: 2;\n  padding: 0 15px;\n  overflow: hidden;\n  box-sizing: border-box;\n  /deep/ img {\n    width: 100%;\n  }\n}\n.material-webPage {\n  overflow: auto;\n  position: relative;\n}\n/* marketing start */\n.row {\n  width: 100%;\n  margin-top: 20px;\n  .loading {\n    width: 74px;\n    height: 74px;\n  }\n  .img-box {\n    width: 100%;\n    height: 300px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n  .img {\n    width: 100%;\n    user-select: none;\n  }\n  .text {\n    margin: 0;\n    padding: 24px;\n    font-size: 30px;\n    color: #444444;\n    line-height: 48px;\n    box-sizing: border-box;\n  }\n}\n.superLink {\n  font-size: 36px;\n  padding: 0 20px;\n  color: #3b3b3b;\n  min-width: 240px;\n  overflow: hidden;\n  margin: 30px auto;\n  line-height: 80px;\n  text-align: center;\n  white-space: nowrap;\n  display: inline-block;\n  box-sizing: border-box;\n  background-size: 100% 100%;\n  background-position: center;\n  background-repeat: no-repeat;\n  background-image: url(./btnBg.png);\n  animation: scale 0.6s ease infinite;\n}\n.contact {\n  height: 210px;\n  padding: 0 24px;\n  overflow: hidden;\n  background: #f4f4f4;\n  .title {\n    font-size: 30px;\n    color: #a3a3a3;\n    line-height: 80px;\n  }\n  .contact-info {\n    width: 100%;\n    height: 98px;\n    display: block;\n    line-height: 98px;\n    background: #fff;\n    box-sizing: border-box;\n  }\n  .name {\n    float: left;\n    font-size: 36px;\n    color: #666666;\n    margin-left: 30px;\n  }\n  .tel {\n    float: right;\n    font-size: 32px;\n    color: #474747;\n    margin-right: 30px;\n    .iconfont {\n      color: #4389e1;\n      font-size: 40px;\n    }\n  }\n}\n@keyframes scale {\n  0% {\n    transform: scale(1);\n  }\n  50% {\n    transform: scale(1.2);\n  }\n  100% {\n    transform: scale(1);\n  }\n}\n/* marketing end */\n.material-card {\n  margin: 0 auto;\n  transform: scale(0.97);\n}\n.match-footer {\n  left: 50%;\n  transform: translateX(-50%);\n  width: 690px;\n  height: 88px;\n  bottom: 20px;\n  color: #fff;\n  position: fixed;\n  font-size: 28px;\n  line-height: 88px;\n  text-align: center;\n  border-radius: 44px;\n  background: #274ff3;\n  font-family: 'PingFang SC Medium';\n  box-shadow: 0px 0px 15px 0px rgba(0, 0, 0, 0.15);\n  &.disabled {\n    color: #999;\n    background: #ddd;\n  }\n}\n</style>\n"],"sourceRoot":"src/module/circle/match"}]}
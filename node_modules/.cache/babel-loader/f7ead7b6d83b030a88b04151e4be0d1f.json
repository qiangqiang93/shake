{"remainingRequest":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/thread-loader/dist/cjs.js!/Users/qiang/work/hytx/hytx-rebuild/node_modules/babel-loader/lib/index.js!/Users/qiang/work/hytx/hytx-rebuild/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/qiang/work/hytx/hytx-rebuild/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/qiang/work/hytx/hytx-rebuild/src/module/activity/invite/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/qiang/work/hytx/hytx-rebuild/src/module/activity/invite/index.vue","mtime":1548378818728},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _regeneratorRuntime from \"/Users/qiang/work/hytx/hytx-rebuild/node_modules/@babel/runtime/regenerator\";\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapState, mapActions } from 'vuex';\nimport card from '../../../api/card';\nimport Login from '../../../api/login';\nimport System from '../../../api/system';\nimport validate from '../../../utils/validate';\nimport { isIos, getParamsFromUrl } from '../../../utils';\nimport Wrapper from '../../../components/Wrapper';\nimport sdkService from '../../../service/sdkService';\nimport dialogService from '../../../service/dialogService';\nimport User from '../../../api/user';\nexport default {\n  name: 'mine-invite',\n  data: function data() {\n    return {\n      code: '',\n      // 验证码\n      phone: '',\n      // 电话\n      timer: '',\n      // 计时器\n      isIos: '',\n      //是否是ios\n      open_id: '',\n      // 用户标识\n      active: true,\n      // 是否可点击验证码\n      shareInfo: {},\n      //分享人信息\n      shareId: null,\n      // 分享人ID\n      subscribe: null,\n      // 是否关注微信公众号0 未关注 1 关注\n      tips: '获取验证码',\n      // 获取验证码\n      isRegister: false,\n      // 是否注册了\n      oldUsers: false // 是否是老用户\n\n    };\n  },\n  mounted: function mounted() {\n    this.init();\n  },\n  methods: {\n    // ...mapActions(['system/shareGuide']),\n    // 初始化\n    init: function () {\n      var _init = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        var _self, userId, res;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _self = this;\n                this.isIos = isIos();\n                this.shareId = getParamsFromUrl('user_id');\n                this.open_id = getParamsFromUrl('open_id');\n                this.subscribe = getParamsFromUrl('subscribe');\n                this.open_id = this.open_id ? this.open_id.trim() : '';\n                userId = this.userInfo ? this.userInfo.id : null;\n\n                if (!userId) {\n                  _context.next = 10;\n                  break;\n                }\n\n                dialogService.alert('您已登录，即将跳转到首页', function () {\n                  _self.$router.push('/index');\n                });\n                return _context.abrupt(\"return\", false);\n\n              case 10:\n                if (this.shareId) {\n                  _context.next = 13;\n                  break;\n                }\n\n                _self.$router.push('/login');\n\n                return _context.abrupt(\"return\", false);\n\n              case 13:\n                _context.prev = 13;\n                _context.next = 16;\n                return card.getCardByUserId(this.shareId);\n\n              case 16:\n                res = _context.sent;\n\n                if (!(res.status !== 0)) {\n                  _context.next = 19;\n                  break;\n                }\n\n                throw new Error(res.message);\n\n              case 19:\n                this.shareInfo = res.data;\n                this.shareConfig();\n                _context.next = 25;\n                break;\n\n              case 23:\n                _context.prev = 23;\n                _context.t0 = _context[\"catch\"](13);\n\n              case 25:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[13, 23]]);\n      }));\n\n      function init() {\n        return _init.apply(this, arguments);\n      }\n\n      return init;\n    }(),\n    // 分享配置\n    shareConfig: function shareConfig() {\n      var redirect = 'redirect=' + encodeURIComponent('/activity/invite');\n      var query = \"user_id=\".concat(this.shareId, \"&\").concat(redirect, \"&poster=1\");\n      var url = \"\".concat(window.api, \"/front/oauth?\").concat(query);\n      var options = {\n        link: url,\n        desc: \"\\u6C47\\u8109\\u5B9D\\u2014\\u5171\\u4EAB\\u6D41\\u91CF\\uFF0C\\u4E13\\u6CE8\\u8425\\u9500\",\n        imgUrl: \"\".concat(window.host, \"/static/hongbao.jpg\"),\n        title: \"\\u6211\\u662F\".concat(this.shareInfo.name, \"\\u9080\\u8BF7\\u60A8\\u53C2\\u52A0\\u4E92\\u63A8\\uFF0C\\u4E00\\u8D77\\u74DC\\u52061200W\"),\n        success: function success() {}\n      };\n      sdkService.share(options);\n    },\n    //  验证手机号是否已注册\n    validatePhone: function () {\n      var _validatePhone = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2() {\n        var ress;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!(this.phone.length !== 11)) {\n                  _context2.next = 3;\n                  break;\n                }\n\n                this.oldUsers = false;\n                return _context2.abrupt(\"return\", false);\n\n              case 3:\n                _context2.prev = 3;\n                _context2.next = 6;\n                return Login.phoneExist(this.phone);\n\n              case 6:\n                ress = _context2.sent;\n\n                if (!(ress.status !== 0)) {\n                  _context2.next = 9;\n                  break;\n                }\n\n                throw new Error(ress.message);\n\n              case 9:\n                if (ress.data.is_exist) this.oldUsers = true;\n                _context2.next = 15;\n                break;\n\n              case 12:\n                _context2.prev = 12;\n                _context2.t0 = _context2[\"catch\"](3);\n                dialogService.toast(_context2.t0.message);\n\n              case 15:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[3, 12]]);\n      }));\n\n      function validatePhone() {\n        return _validatePhone.apply(this, arguments);\n      }\n\n      return validatePhone;\n    }(),\n    // 倒计时\n    countdown: function countdown() {\n      var _this = this;\n\n      var second = 60;\n      this.active = false;\n      this.tips = second + 's';\n      this.timer = setInterval(function () {\n        second--;\n        _this.tips = second + 's';\n\n        if (second === 0) {\n          clearInterval(_this.timer);\n          _this.active = true;\n          _this.tips = '获取验证码';\n        }\n      }, 1000);\n    },\n    // 获取验证码 type发送验证码 1登录 2注册 3改密 4换绑 5设置支付密码\n    getCode: function () {\n      var _getCode = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3() {\n        var check, res;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!(!this.active || this.oldUsers)) {\n                  _context3.next = 2;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\");\n\n              case 2:\n                check = validate.phone(this.phone);\n\n                if (check.status) {\n                  _context3.next = 6;\n                  break;\n                }\n\n                dialogService.toast(check.msg);\n                return _context3.abrupt(\"return\", false);\n\n              case 6:\n                _context3.prev = 6;\n                _context3.next = 9;\n                return System.sendValidateCode(this.phone, 2);\n\n              case 9:\n                res = _context3.sent;\n\n                if (!(res.status !== 0)) {\n                  _context3.next = 12;\n                  break;\n                }\n\n                throw new Error(res.message);\n\n              case 12:\n                dialogService.toast('验证码发送成功,请注意查收');\n                this.countdown();\n                _context3.next = 19;\n                break;\n\n              case 16:\n                _context3.prev = 16;\n                _context3.t0 = _context3[\"catch\"](6);\n                dialogService.toast(_context3.t0.message);\n\n              case 19:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this, [[6, 16]]);\n      }));\n\n      function getCode() {\n        return _getCode.apply(this, arguments);\n      }\n\n      return getCode;\n    }(),\n    // 通过手机号注册\n    submit: function () {\n      var _submit = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4() {\n        var check, res;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                check = validate.phone(this.phone);\n\n                if (check.status) {\n                  _context4.next = 4;\n                  break;\n                }\n\n                dialogService.toast(check.msg);\n                return _context4.abrupt(\"return\", false);\n\n              case 4:\n                _context4.prev = 4;\n                _context4.next = 7;\n                return Login.register({\n                  code: this.code,\n                  phone: this.phone,\n                  open_id: this.open_id,\n                  user_id: this.shareId\n                });\n\n              case 7:\n                res = _context4.sent;\n\n                if (!(res.status == -1)) {\n                  _context4.next = 10;\n                  break;\n                }\n\n                throw new Error(res.message);\n\n              case 10:\n                dialogService.toast('注册成功');\n                this.isRegister = true;\n                User.getProfile();\n                _context4.next = 18;\n                break;\n\n              case 15:\n                _context4.prev = 15;\n                _context4.t0 = _context4[\"catch\"](4);\n                dialogService.toast(_context4.t0.message);\n\n              case 18:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this, [[4, 15]]);\n      }));\n\n      function submit() {\n        return _submit.apply(this, arguments);\n      }\n\n      return submit;\n    }(),\n    // 跳转到首页\n    goHome: function goHome() {\n      this.$router.replace('/information');\n    }\n  },\n  computed: _objectSpread({}, mapState({\n    userInfo: function userInfo(state) {\n      return state.user.userInfo;\n    },\n    redirect: function redirect(state) {\n      return state.system.redirect;\n    }\n  })),\n  components: {\n    Wrapper: Wrapper\n  }\n};",{"version":3,"sources":["index.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <Wrapper class=\"activity-invite\">\n    <div class=\"activity-invite-main\">\n      <div class=\"activity-invite-inviter\">\n        <img class=\"activity-invite-avatar\" :src=\"shareInfo.portrait\" />\n        <span class=\"activity-invite-name\">{{shareInfo.name||'小脉宝'}}</span>\n      </div>\n      <div class=\"activity-invite-box\">\n        <p class=\"activity-invite-title\">立即领取1元</p>\n        <div class=\"activity-invite-input-wrap\">\n          <input class=\"activity-invite-input\" maxlength=\"11\" @input=\"validatePhone\" placeholder=\"输入手机号\" type=\"number\" v-model=\"phone\" />\n          <span class=\"activity-invite-input-code activity-invite-input-info\" v-if=\"phone.length==11&&oldUsers\">手机号已注册</span>\n        </div>\n        <div class=\"activity-invite-input-wrap\">\n          <input class=\"activity-invite-input\" placeholder=\"输入验证码\" type=\"number\" v-model=\"code\" />\n          <span class=\"activity-invite-input-code\" @click=\"getCode\">{{tips}}</span>\n        </div>\n        <div class=\"activity-invite-button-box\">\n          <button class=\"activity-invite-button button-active\" :disabled=\"!(phone&&code)\" @click=\"submit\">注册领取</button>\n        </div>\n      </div>\n    </div>\n    <div ref=\"footer\" class=\"activity-invite-footer\" v-show=\"isRegister\">\n      <template v-if=\"isIos\">\n        <p class=\"activity-invite-download button-active\" @click=\"goHome\">进入汇脉宝首页</p>\n      </template>\n      <template v-else>\n        <router-link tag=\"p\" to=\"/app/download\" class=\"activity-invite-download button-active\">下载汇脉宝APP</router-link>\n        <!-- <a class=\"activity-invite-download button-active\" href=\"http://weixin.yuhongrocky.top/hmb.apk\">下载汇脉宝APP</a> -->\n        <p class=\"activity-invite-index button-active\" @click=\"goHome\">进入首页</p>\n      </template>\n    </div>\n  </Wrapper>\n</template>\n<script>\nimport { mapState, mapActions } from 'vuex'\n\nimport card from '../../../api/card'\nimport Login from '../../../api/login'\nimport System from '../../../api/system'\n\nimport validate from '../../../utils/validate'\nimport { isIos, getParamsFromUrl } from '../../../utils'\n\nimport Wrapper from '../../../components/Wrapper'\n\nimport sdkService from '../../../service/sdkService'\nimport dialogService from '../../../service/dialogService'\nimport User from '../../../api/user'\n\nexport default {\n  name: 'mine-invite',\n  data() {\n    return {\n      code: '', // 验证码\n      phone: '', // 电话\n      timer: '', // 计时器\n      isIos: '', //是否是ios\n      open_id: '', // 用户标识\n      active: true, // 是否可点击验证码\n      shareInfo: {}, //分享人信息\n      shareId: null, // 分享人ID\n      subscribe: null, // 是否关注微信公众号0 未关注 1 关注\n      tips: '获取验证码', // 获取验证码\n      isRegister: false, // 是否注册了\n      oldUsers: false // 是否是老用户\n    }\n  },\n  mounted() {\n    this.init()\n  },\n  methods: {\n    // ...mapActions(['system/shareGuide']),\n    // 初始化\n    async init() {\n      let _self = this\n      this.isIos = isIos()\n      this.shareId = getParamsFromUrl('user_id')\n      this.open_id = getParamsFromUrl('open_id')\n      this.subscribe = getParamsFromUrl('subscribe')\n      this.open_id = this.open_id ? this.open_id.trim() : ''\n      let userId = this.userInfo ? this.userInfo.id : null\n      if (userId) {\n        dialogService.alert('您已登录，即将跳转到首页', function() {\n          _self.$router.push('/index')\n        })\n        return false\n      }\n      if (!this.shareId) {\n        _self.$router.push('/login')\n        return false\n      }\n\n      try {\n        let res = await card.getCardByUserId(this.shareId)\n        if (res.status !== 0) throw new Error(res.message)\n        this.shareInfo = res.data\n        this.shareConfig()\n      } catch (error) {\n        // let redirect = 'redirect=' + encodeURIComponent('/activity/invite')\n        // location.href = `${window.api}/front/oauth?user_id=&${redirect}`\n      }\n    },\n    // 分享配置\n    shareConfig() {\n      let redirect = 'redirect=' + encodeURIComponent('/activity/invite')\n      let query = `user_id=${this.shareId}&${redirect}&poster=1`\n      let url = `${window.api}/front/oauth?${query}`\n      let options = {\n        link: url,\n        desc: `汇脉宝—共享流量，专注营销`,\n        imgUrl: `${window.host}/static/hongbao.jpg`,\n        title: `我是${this.shareInfo.name}邀请您参加互推，一起瓜分1200W`,\n        success: function() {}\n      }\n      sdkService.share(options)\n    },\n    //  验证手机号是否已注册\n    async validatePhone() {\n      if (this.phone.length !== 11) {\n        this.oldUsers = false\n        return false\n      }\n      try {\n        let ress = await Login.phoneExist(this.phone)\n        if (ress.status !== 0) throw new Error(ress.message)\n        if (ress.data.is_exist) this.oldUsers = true\n      } catch (err) {\n        dialogService.toast(err.message)\n      }\n    },\n    // 倒计时\n    countdown() {\n      let second = 60\n      this.active = false\n      this.tips = second + 's'\n      this.timer = setInterval(() => {\n        second--\n        this.tips = second + 's'\n        if (second === 0) {\n          clearInterval(this.timer)\n          this.active = true\n          this.tips = '获取验证码'\n        }\n      }, 1000)\n    },\n    // 获取验证码 type发送验证码 1登录 2注册 3改密 4换绑 5设置支付密码\n    async getCode() {\n      if (!this.active || this.oldUsers) return\n      let check = validate.phone(this.phone)\n      if (!check.status) {\n        dialogService.toast(check.msg)\n        return false\n      }\n      try {\n        let res = await System.sendValidateCode(this.phone, 2)\n        if (res.status !== 0) throw new Error(res.message)\n        dialogService.toast('验证码发送成功,请注意查收')\n        this.countdown()\n      } catch (err) {\n        dialogService.toast(err.message)\n      }\n    },\n    // 通过手机号注册\n    async submit() {\n      let check = validate.phone(this.phone)\n      if (!check.status) {\n        dialogService.toast(check.msg)\n        return false\n      }\n      try {\n        let res = await Login.register({\n          code: this.code,\n          phone: this.phone,\n          open_id: this.open_id,\n          user_id: this.shareId\n        })\n        if (res.status == -1) throw new Error(res.message)\n        dialogService.toast('注册成功')\n        this.isRegister = true\n        User.getProfile()\n      } catch (error) {\n        dialogService.toast(error.message)\n      }\n    },\n    // 跳转到首页\n    goHome() {\n      this.$router.replace('/information')\n    }\n  },\n  computed: {\n    ...mapState({\n      userInfo: state => state.user.userInfo,\n      redirect: state => state.system.redirect\n    })\n  },\n  components: {\n    Wrapper\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.activity-invite {\n  display: flex;\n  overflow: hidden;\n  background: #ffffff;\n  flex-direction: column;\n}\n.activity-invite-main {\n  width: 100%;\n  height: 3223px;\n  overflow: hidden;\n  position: relative;\n  box-sizing: border-box;\n  background-size: 100% 100%;\n  background-repeat: no-repeat;\n  background-image: url('./bg.jpg');\n}\n.activity-invite-inviter {\n  left: 27%;\n  top: 292px;\n  position: absolute;\n  .activity-invite-avatar {\n    width: 40px;\n    float: left;\n    height: 40px;\n    border-radius: 50%;\n    margin-right: 11px;\n  }\n  .activity-invite-name {\n    float: left;\n    font-size: 24px;\n    color: #ffffff;\n    line-height: 40px;\n  }\n}\n.activity-invite-box {\n  left: 50%;\n  top: 862px;\n  width: 710px;\n  height: 400px;\n  background: #fff;\n  position: absolute;\n  border-radius: 10px;\n  transform: translateX(-50%);\n  .activity-invite-title {\n    font-size: 32px;\n    color: #000000;\n    padding-top: 28px;\n    text-align: center;\n    margin-bottom: 35px;\n  }\n  .activity-invite-input-wrap {\n    width: 630px;\n    overflow: hidden;\n    margin: 45px auto 0;\n    padding-bottom: 14px;\n    border-bottom: 1px solid #d3d3d3;\n  }\n  .activity-invite-input {\n    width: 460px;\n    outline: none;\n    font-size: 28px;\n  }\n  .activity-invite-input-code {\n    font-size: 26px;\n    color: #274ff3;\n    float: right;\n  }\n  .activity-invite-input-info {\n    color: red;\n  }\n  .activity-invite-button-box {\n    display: flex;\n  }\n  .activity-invite-button {\n    height: 70px;\n    width: 279px;\n    color: #fff;\n    outline: none;\n    font-size: 32px;\n    line-height: 70px;\n    text-align: center;\n    margin: 45px auto 0;\n    border-radius: 10px;\n    background: #466afa;\n    &:disabled {\n      background: #999;\n    }\n  }\n}\n.activity-invite-footer {\n  left: 0;\n  bottom: 0;\n  width: 100%;\n  height: 128px;\n  display: flex;\n  padding: 0 20px;\n  position: fixed;\n  font-size: 32px;\n  overflow: hidden;\n  background: #fff;\n  align-items: center;\n  box-sizing: border-box;\n  justify-content: space-between;\n  .activity-invite-download {\n    flex: 1;\n    width: 345px;\n    height: 88px;\n    color: #fff;\n    line-height: 88px;\n    text-align: center;\n    border-radius: 8px;\n    background-color: #274ff3;\n    box-shadow: 0px 0px 3px 0px rgba(0, 0, 0, 0.1);\n  }\n  .activity-invite-index {\n    flex: 1;\n    height: 88px;\n    color: #274ff3;\n    margin-left: 20px;\n    line-height: 88px;\n    text-align: center;\n    border-radius: 8px;\n    border: solid 1px #274ff3;\n    box-shadow: 0px 0px 3px 0px rgba(0, 0, 0, 0.1);\n  }\n}\n</style>"],"sourceRoot":"src/module/activity/invite"}]}
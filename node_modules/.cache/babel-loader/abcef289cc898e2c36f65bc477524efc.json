{"remainingRequest":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/babel-loader/lib/index.js!/Users/qiang/work/hytx/hytx-rebuild/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/qiang/work/hytx/hytx-rebuild/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/qiang/work/hytx/hytx-rebuild/src/module/common/pay/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/qiang/work/hytx/hytx-rebuild/src/module/common/pay/index.vue","mtime":1547618571856},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _objectSpread from \"/Users/qiang/work/hytx/hytx-rebuild/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/es6.function.name\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/qiang/work/hytx/hytx-rebuild/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport sdkService from '@/service/sdkService';\nimport httpService from '@/service/httpService';\nimport ListItem from '../../../components/ListItem/index';\nimport AppLoading from '../../../components/AppLoading/index';\nimport List from '../../../components/List/index';\nimport sysApi from '../../../api/system/index';\nimport userApi from '../../../api/user/index';\nimport dialogService from '../../../service/dialogService';\nimport { mapState, mapActions } from 'vuex';\nexport default {\n  name: 'pay',\n  data: function data() {\n    return {\n      password: '',\n      //支付密码\n      pwd: false,\n      //支付密码弹窗\n      paying: false,\n      // 是否正在支付\n      biz_type: null,\n      // 传后台的type\n      qianbao: 0,\n      //钱包支付金额\n      memoryMoney: 0,\n      // 暂存的总额\n      type: 1,\n      // 支付方式，默认微信支付\n      lableName: '--',\n      // 产品名称\n      rest: '--',\n      //余额\n      money: '--',\n      // 实付款\n      seletid: null,\n      //选择id\n      selfMount: null,\n      // 自定义金额\n      maibao: [],\n      //脉宝列表\n      chargeType: null,\n      ischeck: false // 是否用余额\n\n    };\n  },\n  mounted: function () {\n    var _mounted = _asyncToGenerator(\n    /*#__PURE__*/\n    regeneratorRuntime.mark(function _callee() {\n      var res, _res;\n\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              this.chargeType = this.$route.query.type || '';\n\n              if (!(this.chargeType == 'maibao')) {\n                _context.next = 9;\n                break;\n              }\n\n              this.biz_type = 3;\n              _context.next = 5;\n              return sysApi.getMaibao();\n\n            case 5:\n              res = _context.sent;\n              this.maibao = res.data;\n              _context.next = 26;\n              break;\n\n            case 9:\n              if (!(this.chargeType == 'vip')) {\n                _context.next = 16;\n                break;\n              }\n\n              this.biz_type = 1;\n              this.lableName = this.payInfo.name;\n              this.money = this.payInfo.money;\n              this.memoryMoney = this.payInfo.money;\n              _context.next = 26;\n              break;\n\n            case 16:\n              if (!(this.chargeType == 'clone')) {\n                _context.next = 23;\n                break;\n              }\n\n              this.biz_type = 2;\n              this.lableName = '克隆网页:' + this.clonePage.title;\n              this.money = this.clonePage.clone_price;\n              this.memoryMoney = this.clonePage.clone_price;\n              _context.next = 26;\n              break;\n\n            case 23:\n              this.$router.replace('/');\n              dialogService.toast('参数出了点错误哟,请重新发起支付');\n              return _context.abrupt(\"return\");\n\n            case 26:\n              _context.prev = 26;\n              _context.next = 29;\n              return sysApi.getRestMoney();\n\n            case 29:\n              _res = _context.sent;\n              this.rest = parseFloat(_res.data.money);\n              _context.next = 36;\n              break;\n\n            case 33:\n              _context.prev = 33;\n              _context.t0 = _context[\"catch\"](26);\n              dialogService.alert(_context.t0);\n\n            case 36:\n              sdkService.config('pay');\n\n            case 37:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this, [[26, 33]]);\n    }));\n\n    function mounted() {\n      return _mounted.apply(this, arguments);\n    }\n\n    return mounted;\n  }(),\n  computed: _objectSpread({}, mapState({\n    userInfo: function userInfo(state) {\n      return state.user.userInfo;\n    },\n    payInfo: function payInfo(state) {\n      return state.system.payInfo;\n    },\n    beVipPath: function beVipPath(state) {\n      return state.system.beVipPath;\n    },\n    clonePage: function clonePage(state) {\n      return state.webPage.clonePage;\n    },\n    cloneId: function cloneId(state) {\n      return state.webPage.cloneId;\n    }\n  })),\n  components: {\n    ListItem: ListItem,\n    List: List,\n    AppLoading: AppLoading\n  },\n  methods: _objectSpread({}, mapActions(['user/setUserInfo', 'system/updateBeVipPath', 'webPage/updateClonePage', 'system/updatepayType']), {\n    // 支付密码聚焦\n    focus: function focus() {\n      this.$refs.pwd.focus();\n    },\n    //输入支付密码\n    inputHandler: function inputHandler() {\n      if (this.password.length === 6) {\n        this.pay();\n      }\n    },\n    //余额支付\n    useRest: function useRest() {\n      var _this = this;\n\n      var that = this;\n\n      if (this.rest > 0) {\n        if (!this.userInfo.payment_pwd) {\n          dialogService.confirm('还未设置支付密码，是否去设置？', function (ok) {\n            if (ok) {\n              that['system/updatepayType'](_this.chargeType);\n              that.$router.replace('/setting/payManage/step1');\n            }\n          });\n          return;\n        }\n\n        this.ischeck = !this.ischeck;\n\n        if (this.ischeck) {\n          if (this.rest > this.money) {\n            this.qianbao = this.money;\n            this.type = 0;\n            this.money = 0;\n          } else {\n            this.qianbao = this.rest;\n            this.money = Math.round((this.money - this.rest) * 100) / 100;\n            this.type = 1;\n          }\n        } else {\n          this.type = 1;\n          this.money = this.memoryMoney;\n        }\n      } else {\n        dialogService.toast('余额为0');\n      }\n    },\n    // 确认支付\n    pay: function () {\n      var _pay = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee3() {\n        var _self, target_i, res, options;\n\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                console.log(this.chargeType);\n\n                if (!this.paying) {\n                  _context3.next = 3;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\");\n\n              case 3:\n                if (!(this.money == 0 && this.ischeck && !this.pwd)) {\n                  _context3.next = 6;\n                  break;\n                }\n\n                this.pwd = true;\n                return _context3.abrupt(\"return\");\n\n              case 6:\n                this.paying = true;\n                _self = this;\n                target_i = 0;\n\n                if (this.chargeType == 'maibao') {\n                  target_i = this.memoryMoney;\n                } else if (this.chargeType == 'clone') {\n                  target_i = this.cloneId;\n                } else {\n                  target_i = this.payInfo.id;\n                }\n\n                _context3.next = 12;\n                return httpService.post('/front/pay', {\n                  biz_type: this.biz_type,\n                  money: this.money + '',\n                  wallet: this.ischeck,\n                  pay_type: this.type,\n                  target_id: target_i,\n                  pwd: this.password\n                });\n\n              case 12:\n                res = _context3.sent;\n\n                if (res.status === -1) {\n                  _self.paying = false;\n                  dialogService.alert(res.message);\n                } else {\n                  if (!res.data.pay_type) {\n                    _self.afterPay();\n\n                    dialogService.toast('支付成功');\n                  } else {\n                    options = res.data.params;\n\n                    options.success =\n                    /*#__PURE__*/\n                    function () {\n                      var _ref = _asyncToGenerator(\n                      /*#__PURE__*/\n                      regeneratorRuntime.mark(function _callee2(result) {\n                        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n                          while (1) {\n                            switch (_context2.prev = _context2.next) {\n                              case 0:\n                                _self.afterPay();\n\n                                dialogService.toast('支付成功');\n\n                              case 2:\n                              case \"end\":\n                                return _context2.stop();\n                            }\n                          }\n                        }, _callee2, this);\n                      }));\n\n                      return function (_x) {\n                        return _ref.apply(this, arguments);\n                      };\n                    }();\n\n                    sdkService.pay(options);\n                  }\n\n                  _self.paying = false;\n                }\n\n              case 14:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function pay() {\n        return _pay.apply(this, arguments);\n      }\n\n      return pay;\n    }(),\n    // 支付成功操作\n    afterPay: function () {\n      var _afterPay = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee4() {\n        var _self;\n\n        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _self = this;\n                userApi.getProfile();\n\n                if (_self.chargeType == 'clone') {\n                  this.$router.replace('/webPage/edit');\n                } else if (_self.chargeType == 'vip') {\n                  if (_self.beVipPath) {\n                    _self.$router.replace({\n                      path: _self.beVipPath\n                    });\n                  } else {\n                    _self.$router.replace('/mine');\n                  }\n                } else {\n                  _self.$router.replace('/maibao');\n                }\n\n              case 3:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function afterPay() {\n        return _afterPay.apply(this, arguments);\n      }\n\n      return afterPay;\n    }(),\n    // 自定义输入脉宝操作\n    moneyChange: function moneyChange() {\n      this.ischeck = false;\n      this.selfMount = this.selfMount.replace(/[^\\d]/g, '');\n      this.money = this.selfMount;\n      this.memoryMoney = this.selfMount;\n    },\n    // 选择充值脉宝金额\n    selectMb: function selectMb(item) {\n      this.ischeck = false;\n      this.selfMount = '';\n      this.money = parseFloat(item.amount);\n      this.memoryMoney = parseFloat(item.amount);\n      this.seletid = item.id;\n    }\n  }),\n  beforeRouteLeave: function beforeRouteLeave(to, from, next) {\n    if (to.path !== '/webPage/edit' || to.path !== '/setting/payManage/step1') {\n      this['webPage/updateClonePage']({\n        type: 'clean',\n        data: {}\n      });\n    }\n\n    if (to.path !== '/setting/payManage/step1') {\n      this['system/updateBeVipPath'](null);\n      this['system/updatepayType'](null);\n    }\n\n    next();\n  }\n};",{"version":3,"sources":["index.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"warpper\">\n    <AppLoading v-show=\"!maibao.length&&chargeType==='maibao'\" style=\"background:transparent;\" type=\"list\"></AppLoading>\n    <div class=\"maibao\" v-if=\"chargeType=='maibao'&&maibao.length\">\n      <div class=\"price\" @click=\"selectMb(item)\" :class=\"{active:seletid == item.id&&!selfMount}\" v-for=\"(item,index) in maibao\" :key=\"index\">{{item.amount}}脉宝</div>\n      <div class=\"price\" :class=\"{active:selfMount>0}\"><input class=\"personal\" @input=\"moneyChange\" v-model=\"selfMount\" placeholder=\"其他数额\" type=\"number\" /></div>\n      <div class=\"item\"></div>\n      <div class=\"item\"></div>\n      <div class=\"item\"></div>\n    </div>\n    <p class=\"rule\" v-if=\"chargeType=='maibao'\">规则：1元=1脉宝</p>\n    <List class=\"mine-list\" v-if=\"chargeType!=='maibao'\">\n      <ListItem :label=\"lableName\">\n        <span class=\"money\">{{memoryMoney}}元</span>\n      </ListItem>\n    </List>\n    <List class=\"mine-list\">\n      <ListItem icon=\"icon-qianbao\" label=\"钱包\">\n        <div style=\"flex:4\">\n          <span class=\"tips\">账户余额共￥{{rest}}\n            <span v-show=\"ischeck\">,抵{{qianbao}}元</span>\n          </span>\n          <div class=\"switch\">\n            <input type=\"checkbox\" value=\"666\" v-model=\"ischeck\" id=\"chk\">\n            <label @click=\"useRest\"></label>\n          </div>\n        </div>\n      </ListItem>\n    </List>\n    <List class=\"mine-list\">\n      <ListItem icon=\"icon-weixin2\" label=\"微信支付\">\n        <input type=\"radio\" name=\"type\" value=\"1\" :checked=\"type==1\" hidden />\n        <label class=\"advice\">\n          <i class=\"iconfont icon-dagou1\"></i>\n        </label>\n      </ListItem>\n      <!-- <ListItem icon=\"icon-weixin2\" label=\"支付宝\">\n        <input type=\"radio\" name=\"type\" value=\"2\" :checked=\"type===2\" hidden />\n        <label class=\"advice\" @click=\"type=2\">\n          <i class=\"iconfont icon-dagou1\"></i>\n        </label>\n      </ListItem> -->\n    </List>\n    <div class=\"submit\" v-show=\"!paying\" @click=\"pay()\">{{`实付款${money}元`}}</div>\n    <div class=\"submit\" v-show=\"paying\">正在支付,请稍等...</div>\n    <p class=\"xuzhi\">充值须知：充值的金额不能提现</p>\n    <div class=\"pwd\" v-if=\"pwd\">\n      <div class=\"box\" @click.stop=\"\">\n        <div class=\"title\">\n          <i class=\"iconfont icon-cuo3\" @click.stop=\"pwd=false\"></i>输入支付密码</div>\n        <div class=\"revise-pay-pwd\">\n          <input ref=\"pwd\" type=\"number\" class=\"input\" autofocus maxlength=\"6\" v-model=\"password\" @input=\"inputHandler()\" />\n          <ul class=\"pwd-wrap\" @click=\"focus\">\n            <li>\n              <i v-if=\"password.length > 0\" class=\"iconfont icon-jiufuqianbaoicon14\"></i>\n            </li>\n            <li>\n              <i v-if=\"password.length > 1\" class=\"iconfont icon-jiufuqianbaoicon14\"></i>\n            </li>\n            <li>\n              <i v-if=\"password.length > 2\" class=\"iconfont icon-jiufuqianbaoicon14\"></i>\n            </li>\n            <li>\n              <i v-if=\"password.length > 3\" class=\"iconfont icon-jiufuqianbaoicon14\"></i>\n            </li>\n            <li>\n              <i v-if=\"password.length > 4\" class=\"iconfont icon-jiufuqianbaoicon14\"></i>\n            </li>\n            <li>\n              <i v-if=\"password.length > 5\" class=\"iconfont icon-jiufuqianbaoicon14\"></i>\n            </li>\n          </ul>\n          <router-link tag=\"p\" to=\"/setting/payManage/step1\" class=\"foget\">忘记密码?</router-link>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n<script>\nimport sdkService from '@/service/sdkService'\nimport httpService from '@/service/httpService'\nimport ListItem from '../../../components/ListItem/index'\nimport AppLoading from '../../../components/AppLoading/index'\nimport List from '../../../components/List/index'\nimport sysApi from '../../../api/system/index'\nimport userApi from '../../../api/user/index'\nimport dialogService from '../../../service/dialogService'\nimport { mapState, mapActions } from 'vuex'\n\nexport default {\n  name: 'pay',\n  data() {\n    return {\n      password: '', //支付密码\n      pwd: false, //支付密码弹窗\n      paying: false, // 是否正在支付\n      biz_type: null, // 传后台的type\n      qianbao: 0, //钱包支付金额\n      memoryMoney: 0, // 暂存的总额\n      type: 1, // 支付方式，默认微信支付\n      lableName: '--', // 产品名称\n      rest: '--', //余额\n      money: '--', // 实付款\n      seletid: null, //选择id\n      selfMount: null, // 自定义金额\n      maibao: [], //脉宝列表\n      chargeType: null,\n      ischeck: false // 是否用余额\n    }\n  },\n  async mounted() {\n    this.chargeType = this.$route.query.type || ''\n    if (this.chargeType == 'maibao') {\n      this.biz_type = 3\n      let res = await sysApi.getMaibao()\n      this.maibao = res.data\n    } else if (this.chargeType == 'vip') {\n      this.biz_type = 1\n      this.lableName = this.payInfo.name\n      this.money = this.payInfo.money\n      this.memoryMoney = this.payInfo.money\n    } else if (this.chargeType == 'clone') {\n      this.biz_type = 2\n      this.lableName = '克隆网页:' + this.clonePage.title\n      this.money = this.clonePage.clone_price\n      this.memoryMoney = this.clonePage.clone_price\n    } else {\n      this.$router.replace('/')\n      dialogService.toast('参数出了点错误哟,请重新发起支付')\n      return\n    }\n    try {\n      let res = await sysApi.getRestMoney()\n      this.rest = parseFloat(res.data.money)\n    } catch (err) {\n      dialogService.alert(err)\n    }\n    sdkService.config('pay')\n  },\n  computed: {\n    ...mapState({\n      userInfo: state => state.user.userInfo,\n      payInfo: state => state.system.payInfo,\n      beVipPath: state => state.system.beVipPath,\n      clonePage: state => state.webPage.clonePage,\n      cloneId: state => state.webPage.cloneId\n    })\n  },\n  components: {\n    ListItem,\n    List,\n    AppLoading\n  },\n  methods: {\n    ...mapActions([\n      'user/setUserInfo',\n      'system/updateBeVipPath',\n      'webPage/updateClonePage',\n      'system/updatepayType'\n    ]),\n    // 支付密码聚焦\n    focus() {\n      this.$refs.pwd.focus()\n    },\n    //输入支付密码\n    inputHandler() {\n      if (this.password.length === 6) {\n        this.pay()\n      }\n    },\n    //余额支付\n    useRest() {\n      let that = this\n      if (this.rest > 0) {\n        if (!this.userInfo.payment_pwd) {\n          dialogService.confirm('还未设置支付密码，是否去设置？', ok => {\n            if (ok) {\n              that['system/updatepayType'](this.chargeType)\n              that.$router.replace('/setting/payManage/step1')\n            }\n          })\n          return\n        }\n        this.ischeck = !this.ischeck\n        if (this.ischeck) {\n          if (this.rest > this.money) {\n            this.qianbao = this.money\n            this.type = 0\n            this.money = 0\n          } else {\n            this.qianbao = this.rest\n            this.money = Math.round((this.money - this.rest) * 100) / 100\n            this.type = 1\n          }\n        } else {\n          this.type = 1\n          this.money = this.memoryMoney\n        }\n      } else {\n        dialogService.toast('余额为0')\n      }\n    },\n    // 确认支付\n    async pay() {\n      console.log(this.chargeType)\n      if (this.paying) return\n      if (this.money == 0 && this.ischeck && !this.pwd) {\n        this.pwd = true\n        return\n      }\n      this.paying = true\n      let _self = this\n      let target_i = 0\n      if (this.chargeType == 'maibao') {\n        target_i = this.memoryMoney\n      } else if (this.chargeType == 'clone') {\n        target_i = this.cloneId\n      } else {\n        target_i = this.payInfo.id\n      }\n      let res = await httpService.post('/front/pay', {\n        biz_type: this.biz_type,\n        money: this.money + '',\n        wallet: this.ischeck,\n        pay_type: this.type,\n        target_id: target_i,\n        pwd: this.password\n      })\n      if (res.status === -1) {\n        _self.paying = false\n        dialogService.alert(res.message)\n      } else {\n        if (!res.data.pay_type) {\n          _self.afterPay()\n          dialogService.toast('支付成功')\n        } else {\n          let options = res.data.params\n          options.success = async function(result) {\n            _self.afterPay()\n            dialogService.toast('支付成功')\n          }\n          sdkService.pay(options)\n        }\n        _self.paying = false\n      }\n    },\n    // 支付成功操作\n    async afterPay() {\n      let _self = this\n      userApi.getProfile()\n      if (_self.chargeType == 'clone') {\n        this.$router.replace('/webPage/edit')\n      } else if (_self.chargeType == 'vip') {\n        if (_self.beVipPath) {\n          _self.$router.replace({\n            path: _self.beVipPath\n          })\n        } else {\n          _self.$router.replace('/mine')\n        }\n      } else {\n        _self.$router.replace('/maibao')\n      }\n    },\n    // 自定义输入脉宝操作\n    moneyChange() {\n      this.ischeck = false\n      this.selfMount = this.selfMount.replace(/[^\\d]/g, '')\n      this.money = this.selfMount\n      this.memoryMoney = this.selfMount\n    },\n    // 选择充值脉宝金额\n    selectMb(item) {\n      this.ischeck = false\n      this.selfMount = ''\n      this.money = parseFloat(item.amount)\n      this.memoryMoney = parseFloat(item.amount)\n      this.seletid = item.id\n    }\n  },\n  beforeRouteLeave(to, from, next) {\n    if (to.path !== '/webPage/edit' || to.path !== '/setting/payManage/step1') {\n      this['webPage/updateClonePage']({\n        type: 'clean',\n        data: {}\n      })\n    }\n    if (to.path !== '/setting/payManage/step1') {\n      this['system/updateBeVipPath'](null)\n      this['system/updatepayType'](null)\n    }\n    next()\n  }\n}\n</script>\n<style lang=\"scss\" scoped>\n.warpper {\n  width: 100%;\n  min-height: 100vh;\n  background: #efeff4;\n  overflow: hidden;\n  box-sizing: border-box;\n  position: relative;\n  .pwd {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba($color: #000000, $alpha: 0.4);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    .box {\n      width: 690px;\n      height: 455px;\n      background: #f6f6f6;\n      .title {\n        background: #fff;\n        width: 100%;\n        height: 86px;\n        line-height: 86px;\n        border-bottom: 1px solid #d8d8d8;\n        text-align: center;\n        font-size: 28px;\n        color: #000000;\n        box-sizing: border-box;\n        padding: 0 30px;\n        .icon-cuo3 {\n          font-size: 36px;\n          float: left;\n        }\n      }\n    }\n    .revise-pay-pwd {\n      width: 100%;\n      margin-top: 101px;\n      .title {\n        padding: 44px 30px;\n        font-size: 26px;\n        color: #555555;\n        box-sizing: border-box;\n      }\n      .input {\n        left: 5%;\n        top: 0;\n        width: 90%;\n        opacity: 0;\n        position: absolute;\n        padding: 0;\n        height: 0;\n        outline: none;\n      }\n      .foget {\n        color: #274ff3;\n        font-size: 26px;\n        text-align: right;\n        margin-right: 30px;\n        margin-top: 25px;\n      }\n      .pwd-wrap {\n        width: 90%;\n        display: flex;\n        margin: 0 auto;\n        padding-bottom: 1px;\n        justify-content: space-between;\n        border: 1px solid #aeaeae;\n        li {\n          width: 100px;\n          height: 100px;\n          line-height: 100px;\n          text-align: center;\n          border: 1px solid #ddd;\n          background: #fff;\n          i {\n            font-size: 26px;\n          }\n        }\n      }\n    }\n  }\n  .xuzhi {\n    color: #999999;\n    font-size: 22px;\n    margin-left: 30px;\n  }\n  .rule {\n    color: #888888;\n    font-size: 22px;\n    margin-left: 30px;\n  }\n  .maibao {\n    margin-top: 40px;\n    width: 100%;\n    box-sizing: border-box;\n    padding: 0 30px;\n    display: flex;\n    flex-wrap: wrap;\n    justify-content: space-between;\n    .item {\n      width: 213px;\n    }\n    .price {\n      .personal {\n        width: 180px;\n        height: 60px;\n        background: transparent;\n        outline: none;\n        text-align: center;\n      }\n      &.active {\n        border: 2px solid #274ff3;\n      }\n      background: #fff;\n      font-size: 28px;\n      margin-bottom: 28px;\n      width: 213px;\n      height: 80px;\n      border: 2px solid #d1d1d1;\n      border-radius: 8px;\n      text-align: center;\n      line-height: 80px;\n    }\n  }\n  .submit {\n    width: 690px;\n    height: 88px;\n    border-radius: 10px;\n    background: #274ff3;\n    line-height: 88px;\n    color: #fff;\n    text-align: center;\n    margin: 40px auto;\n    overflow: hidden;\n    font-size: 32px;\n  }\n  #chk {\n    display: none; /* 将原生的checkbox隐藏 */\n  }\n  /* label 模拟 “划动条” */\n  #chk + label {\n    display: inline-block;\n    position: relative;\n    width: 80px;\n    height: 44px;\n    border-radius: 40px;\n    background-color: #dddddd;\n    box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.1),\n      0 0 10px rgba(146, 196, 245, 0.4);\n  }\n\n  /* “label::before伪元素 模拟 “划块” */\n  #chk + label:before {\n    content: '';\n    cursor: pointer;\n    position: absolute;\n    top: 4px;\n    left: 2px;\n    z-index: 2;\n    width: 36px;\n    height: 36px;\n    border-radius: 50%;\n    background: #fff;\n    box-shadow: 0 0 1px rgba(0, 0, 0, 0.6);\n  }\n\n  /* “label::after伪元素 模拟 “OFF/ON文字” */\n  #chk + label:after {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 30px;\n    width: 50%;\n    text-align: left;\n    font-size: 24px;\n    line-height: 44px;\n    color: #000;\n  }\n\n  /* checkbox选中状态时，“划动条”的样式 */\n  #chk:checked + label {\n    background-color: #274ff3;\n  }\n\n  /* checkbox选中状态时，“划块”的样式 */\n  #chk:checked + label:before {\n    content: '';\n    position: absolute;\n    left: 42px;\n  }\n\n  /* checkbox选中状态时，“OFF/ON文字”的样式 */\n  #chk:checked + label:after {\n    content: '';\n    left: 0;\n    color: #fff;\n    text-align: right;\n  }\n\n  /* 点击时，缓动动画过渡 */\n  #chk + label:before,\n  #chk + label:after,\n  #chk + label {\n    -webkit-transition: all 0.1s ease-in;\n    transition: all 0.1s ease-in;\n  }\n  .mine-list {\n    .advice {\n      height: 40px;\n      width: 40px;\n      line-height: 40px;\n      text-align: center;\n      display: block;\n      background: #fff;\n      color: #fff;\n      border-radius: 50%;\n      box-sizing: border-box;\n      border: 1px solid #9a9a9f;\n      vertical-align: middle;\n      .icon-dagou1 {\n        font-size: 32px;\n      }\n    }\n    input[type='radio']:checked + .advice {\n      border: 0;\n      background: #274ff3;\n    }\n    .money {\n      color: #000000;\n      font-size: 36px;\n    }\n    .tips {\n      font-size: 26px;\n      color: #333;\n      float: left;\n      line-height: 54px;\n      margin-left: -34px;\n    }\n    .switch {\n      float: right;\n      margin-top: 5px;\n    }\n    /deep/ .icon-qianbao {\n      font-size: 28px;\n      text-align: center;\n      color: #fff;\n      background: #2b9dfe;\n      border-radius: 4px;\n      line-height: 40px;\n      display: block;\n      width: 40px;\n      height: 40px;\n      -webkit-box-sizing: border-box;\n      box-sizing: border-box;\n    }\n    /deep/ .icon-weixin2 {\n      font-size: 30px;\n      text-align: center;\n      color: #fff;\n      background: #00bb0c;\n      border-radius: 4px;\n      line-height: 40px;\n      display: block;\n      width: 40px;\n      height: 40px;\n      -webkit-box-sizing: border-box;\n      box-sizing: border-box;\n    }\n  }\n}\n</style>\n \n "],"sourceRoot":"src/module/common/pay"}]}
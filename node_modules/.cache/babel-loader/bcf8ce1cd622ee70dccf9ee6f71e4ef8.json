{"remainingRequest":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/babel-loader/lib/index.js!/Users/qiang/work/hytx/hytx-rebuild/node_modules/eslint-loader/index.js??ref--13-0!/Users/qiang/work/hytx/hytx-rebuild/src/service/httpService.js","dependencies":[{"path":"/Users/qiang/work/hytx/hytx-rebuild/src/service/httpService.js","mtime":1547004851852},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/qiang/work/hytx/hytx-rebuild/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _Promise from \"/Users/qiang/work/hytx/hytx-rebuild/node_modules/@babel/runtime-corejs2/core-js/promise\";\nimport _Object$assign from \"/Users/qiang/work/hytx/hytx-rebuild/node_modules/@babel/runtime-corejs2/core-js/object/assign\";\nimport axios from 'axios';\nimport store from '../store/index.js';\nimport dialogService from './dialogService';\n\nvar generateHeaders = function generateHeaders() {\n  var Authorization = 'Bearer ';\n  var token = store.state.system.token || '';\n  return {\n    'Content-Type': 'application/json',\n    Authorization: Authorization + token\n  };\n};\n\nvar httpService = function httpService(input) {\n  if (input.loading !== undefined) {\n    store.commit('system/updateHttpLoading', input.loading);\n  } else {\n    if (input.method !== 'get' && input.method !== undefined) {\n      store.commit('system/updateHttpLoading', true);\n    }\n  }\n\n  input.url = /^http:\\/\\/|^https:\\/\\//.test(input.url) ? input.url : (window.api || '') + input.url; // 构建 headers\n\n  input.headers = _Object$assign(generateHeaders(), input.headers);\n  return new _Promise(function (resolve) {\n    axios({\n      url: input.url,\n      timeout: 30000,\n      data: input.body,\n      params: input.params,\n      headers: input.headers,\n      method: input.method || 'get'\n    }).then(function (res) {\n      store.commit('system/updateHttpLoading', false);\n      resolve(res.data);\n    }).catch(function (err) {\n      store.commit('system/updateHttpLoading', false);\n\n      if (err.code === 'ECONNABORTED') {\n        dialogService.alert('请求超时，请检查您的网络');\n      } else if (err.response.status === 401) {\n        // 跳转到登录\n        dialogService.alert('您的登陆凭证已过期,请重新登陆', function () {\n          // store.commit('user/setUserInfo', null)\n          store.commit('system/setToken', null);\n          location.href = window.host + '/#/login';\n        });\n      } else if (err.response.status === 500) {\n        dialogService.alert('服务器内部错误,请稍后再试');\n      } else {\n        resolve(err.data);\n      }\n    });\n  });\n};\n\nhttpService.get = function (url, params) {\n  return httpService({\n    url: url,\n    params: params\n  });\n};\n\nhttpService.post = function (url, params) {\n  return httpService({\n    url: url,\n    body: params,\n    method: 'post'\n  });\n};\n\nhttpService.delete = function (url, params) {\n  return httpService({\n    url: url,\n    body: params,\n    method: 'delete'\n  });\n};\n\nhttpService.put = function (url, params) {\n  return httpService({\n    url: url,\n    body: params,\n    method: 'put'\n  });\n};\n\nexport default httpService;",{"version":3,"sources":["/Users/qiang/work/hytx/hytx-rebuild/src/service/httpService.js"],"names":["axios","store","dialogService","generateHeaders","Authorization","token","state","system","httpService","input","loading","undefined","commit","method","url","test","window","api","headers","resolve","timeout","data","body","params","then","res","catch","err","code","alert","response","status","location","href","host","get","post","delete","put"],"mappings":"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","sourcesContent":["import axios from 'axios'\nimport store from '../store/index.js'\nimport dialogService from './dialogService'\n\nconst generateHeaders = () => {\n  let Authorization = 'Bearer '\n  let token = store.state.system.token || ''\n  return {\n    'Content-Type': 'application/json',\n    Authorization: Authorization + token\n  }\n}\nconst httpService = input => {\n  if (input.loading !== undefined) {\n    store.commit('system/updateHttpLoading', input.loading)\n  } else {\n    if (input.method !== 'get' && input.method !== undefined) {\n      store.commit('system/updateHttpLoading', true)\n    }\n  }\n\n  input.url = /^http:\\/\\/|^https:\\/\\//.test(input.url) ?\n    input.url :\n    (window.api || '') + input.url\n  // 构建 headers\n  input.headers = Object.assign(generateHeaders(), input.headers)\n\n  return new Promise(resolve => {\n    axios({\n        url: input.url,\n        timeout: 30000,\n        data: input.body,\n        params: input.params,\n        headers: input.headers,\n        method: input.method || 'get'\n      })\n      .then(res => {\n        store.commit('system/updateHttpLoading', false)\n        resolve(res.data)\n      })\n      .catch(err => {\n        store.commit('system/updateHttpLoading', false)\n        if (err.code === 'ECONNABORTED') {\n          dialogService.alert('请求超时，请检查您的网络')\n        } else if (err.response.status === 401) {\n          // 跳转到登录\n          dialogService.alert('您的登陆凭证已过期,请重新登陆', function () {\n            // store.commit('user/setUserInfo', null)\n            store.commit('system/setToken', null)\n            location.href = window.host + '/#/login'\n          })\n        } else if (err.response.status === 500) {\n          dialogService.alert('服务器内部错误,请稍后再试')\n        } else {\n          resolve(err.data)\n        }\n      })\n  })\n}\nhttpService.get = (url, params) => {\n  return httpService({\n    url,\n    params\n  })\n}\n\nhttpService.post = (url, params) => {\n  return httpService({\n    url,\n    body: params,\n    method: 'post'\n  })\n}\n\nhttpService.delete = (url, params) => {\n  return httpService({\n    url,\n    body: params,\n    method: 'delete'\n  })\n}\n\nhttpService.put = (url, params) => {\n  return httpService({\n    url,\n    body: params,\n    method: 'put'\n  })\n}\nexport default httpService"]}]}